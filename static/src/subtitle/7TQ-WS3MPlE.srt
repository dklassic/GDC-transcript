1
00:00:06,464 --> 00:00:11,247
Hi, my name is Tobias Carlsen, and I'm an AI programmer at Sony Bend Studio.

2
00:00:11,968 --> 00:00:16,591
And today I'm going to talk about score coordination in Days Gone with a focus on combat.

3
00:00:17,712 --> 00:00:19,493
First of all, what is Days Gone?

4
00:00:19,693 --> 00:00:22,275
Well, for those of you not familiar with the game,

5
00:00:22,715 --> 00:00:26,898
Days Gone is an open-world game set in a post-apocalyptic world

6
00:00:27,438 --> 00:00:30,840
where a virus outbreak has turned the majority of the world's population

7
00:00:31,020 --> 00:00:35,503
into these rabid creatures called Freakers that just attack anyone on sight.

8
00:00:36,555 --> 00:00:40,259
As a natural consequence of this, civilization has collapsed,

9
00:00:40,900 --> 00:00:43,142
and the few survivors have fled the cities

10
00:00:43,382 --> 00:00:46,305
and fractured into various factions

11
00:00:46,325 --> 00:00:47,827
that are all hostile to each other.

12
00:00:49,268 --> 00:00:51,050
In the game, we follow Deacon St. John,

13
00:00:51,070 --> 00:00:54,453
a veteran biker, and his best friend Boozer,

14
00:00:55,014 --> 00:00:57,376
as they're trying to survive this hostile world,

15
00:00:57,856 --> 00:01:00,219
while at the same time deal with their emotional scars.

16
00:01:01,085 --> 00:01:03,866
Days Gone is currently available on the PlayStation 4

17
00:01:04,006 --> 00:01:07,047
and the PlayStation 5 platform, as well as on the PC.

18
00:01:08,268 --> 00:01:11,269
So we are mostly famous for our freakers,

19
00:01:12,249 --> 00:01:15,030
or rather, our hordes of freakers.

20
00:01:15,950 --> 00:01:18,631
However, this talk is not about our freakers.

21
00:01:18,691 --> 00:01:21,192
Instead, it is about our human AIs.

22
00:01:21,372 --> 00:01:24,653
And we've got plenty of human AIs in our game.

23
00:01:25,154 --> 00:01:28,335
And they end up fighting both each other and the player

24
00:01:28,495 --> 00:01:30,255
and the various freakers in real life.

25
00:01:31,659 --> 00:01:40,066
So that means we will have groups of AI fighting together in combat.

26
00:01:40,786 --> 00:01:47,212
And as with any human endeavor, when a group of humans come together and try to achieve a shared

27
00:01:47,252 --> 00:01:53,177
goal, they will strive to cooperate and coordinate their actions. So if we want to make our AI look

28
00:01:53,217 --> 00:01:58,201
believable, then our AI need to be able to cooperate effectively.

29
00:01:59,044 --> 00:02:06,070
Also, it's much more difficult to fight an enemy that is coordinated, that attacks in unison,

30
00:02:06,490 --> 00:02:12,676
rather than attacking piecemeal one by one. So this is a much better way to improving

31
00:02:12,696 --> 00:02:18,301
our AI's difficulty than, say, increasing hit points or hit accuracy.

32
00:02:19,706 --> 00:02:22,027
The thing is, though, coordination is hard.

33
00:02:22,647 --> 00:02:26,409
And coordination is particularly hard in an open world game,

34
00:02:26,810 --> 00:02:30,431
as anyone who has tried to write AI coordination

35
00:02:30,972 --> 00:02:32,272
is probably well aware of.

36
00:02:33,213 --> 00:02:35,354
The thing is, in our open world game,

37
00:02:35,534 --> 00:02:38,575
our enemy can come from any direction at any time.

38
00:02:38,595 --> 00:02:41,817
And we don't even know what kind of enemy might be coming.

39
00:02:42,861 --> 00:02:50,211
So this makes it difficult, if not impossible, to script for any possible scenario.

40
00:02:50,271 --> 00:02:55,739
What we need to come up with is a more systemic approach, which in our case means AI for group

41
00:02:55,779 --> 00:02:56,360
coordination.

42
00:02:57,752 --> 00:03:01,332
And our solution, we feel, is a comparatively simple solution,

43
00:03:01,773 --> 00:03:05,073
yet very powerful, which allowed us to solve all the problems

44
00:03:05,133 --> 00:03:06,134
that we came across.

45
00:03:06,734 --> 00:03:09,114
We also think that it is a solution that

46
00:03:09,194 --> 00:03:13,115
should be easily transferable to many different kinds of games

47
00:03:13,455 --> 00:03:15,336
that face the same kind of problems.

48
00:03:16,976 --> 00:03:18,616
So the things we need to solve is

49
00:03:19,818 --> 00:03:24,480
First of all, the group needs to figure out a goal that the group is trying to achieve.

50
00:03:25,180 --> 00:03:30,743
And then, on a group level, the group needs to exhibit the behavior that furthers that goal.

51
00:03:32,424 --> 00:03:42,108
Individual group members will be playing roles within that group behavior that will further this behavior.

52
00:03:42,728 --> 00:03:48,371
And these roles need to be assigned to the right character or the right group member at the right time.

53
00:03:49,413 --> 00:03:50,995
We also need to deal with positioning,

54
00:03:51,395 --> 00:03:53,097
both relative to the enemy,

55
00:03:54,117 --> 00:03:56,640
relative to our friends within the squad,

56
00:03:57,580 --> 00:04:00,183
and also appropriate for the role.

57
00:04:01,203 --> 00:04:03,746
And finally, we also need to deal with timing.

58
00:04:03,846 --> 00:04:05,607
So if we have a group member

59
00:04:06,408 --> 00:04:09,050
who is assigned to provide covering fire

60
00:04:09,490 --> 00:04:10,852
for another group member

61
00:04:10,952 --> 00:04:12,953
so that other group member can do this thing,

62
00:04:13,818 --> 00:04:17,141
then that's no good if that group member jumps out of cover,

63
00:04:17,642 --> 00:04:22,166
empties his gun, and then dives back down to reload

64
00:04:22,667 --> 00:04:26,491
just in time for the group member that he is covering for

65
00:04:26,811 --> 00:04:29,133
to be ready to actually make his move.

66
00:04:30,797 --> 00:04:37,600
So for the rest of this talk, I will use these blue circles to symbolize the squad

67
00:04:37,660 --> 00:04:45,003
he's best depicted I'm talking from, and these red circles will be the enemies of our blue circles.

68
00:04:46,673 --> 00:04:51,637
So when we started working on Days Gone and the human AIs in Days Gone,

69
00:04:52,278 --> 00:04:55,780
we started working on individual AIs and their behaviors.

70
00:04:56,181 --> 00:05:01,385
So we made sure that the AIs could fire their guns and actually hit their targets,

71
00:05:01,765 --> 00:05:07,549
reload those guns when they're out of ammo, get around the level and get into cover when need be.

72
00:05:08,430 --> 00:05:08,510
And

73
00:05:09,387 --> 00:05:15,050
This kind of looked good if we spawned in a single AI in a level and fought that AI.

74
00:05:15,350 --> 00:05:19,232
The AI knew what to do and was a reasonably good opponent.

75
00:05:19,332 --> 00:05:27,696
But as soon as we added more AIs, particularly if we had two groups of AIs that were enemies of each other,

76
00:05:28,417 --> 00:05:30,358
things didn't look as good anymore.

77
00:05:31,278 --> 00:05:34,219
And the obvious reason for that was that we had no coordination.

78
00:05:35,307 --> 00:05:40,231
So the biggest problem was combat was very difficult to read without coordination.

79
00:05:41,091 --> 00:05:45,915
And what we would have would be that our two sides would intermingle with each other.

80
00:05:46,015 --> 00:05:49,838
So we would just have a mix of enemies trying to attack each other.

81
00:05:50,338 --> 00:05:55,102
And this was something that was exasperated by the relatively short distances that

82
00:05:55,202 --> 00:05:58,964
firefights in Dastkhan happen at.

83
00:05:59,064 --> 00:06:04,248
Firefights in Dastkhan are very close and personal, even with our longer range weapons.

84
00:06:05,621 --> 00:06:11,189
And one thing that also happened here was that because DayZone is a cover shooter,

85
00:06:11,209 --> 00:06:19,201
any AI that is in cover needs to have a cover that is valid. And with valid we mean that

86
00:06:20,008 --> 00:06:26,293
that cover provides cover against all enemies. So if there's an enemy that's in a position that

87
00:06:26,333 --> 00:06:31,537
the current cover is not valid for, well that AI will have to move and get to a new cover.

88
00:06:32,158 --> 00:06:38,683
So what we would see is that when our AI just got mixed up like this, at least one of these AI's

89
00:06:38,723 --> 00:06:45,048
covers would invariably be invalidated and that would force that AI to move. And as that AI moved,

90
00:06:45,862 --> 00:06:49,023
Well, that AI would invalidate at least another AI's cover.

91
00:06:49,484 --> 00:06:52,525
And what we would end up with was these cascading

92
00:06:52,566 --> 00:06:57,749
cover validations where each AI would just

93
00:06:57,809 --> 00:07:00,370
get a cover invalidated over and over again.

94
00:07:00,570 --> 00:07:02,952
And the whole group would just be milling around.

95
00:07:03,712 --> 00:07:07,594
So obviously, if you want to be in a firefight

96
00:07:07,754 --> 00:07:11,837
and be an effective combatant, you

97
00:07:11,877 --> 00:07:13,478
want to be shooting at the enemy.

98
00:07:14,457 --> 00:07:16,258
And when you're moving to a new cover,

99
00:07:16,518 --> 00:07:17,739
you're not shooting at the enemy.

100
00:07:18,440 --> 00:07:21,661
And even worse, when you're moving, you're not in cover,

101
00:07:21,761 --> 00:07:23,282
so you get very exposed.

102
00:07:23,943 --> 00:07:28,125
And our AIs turned out to be very ineffective opponents

103
00:07:28,625 --> 00:07:30,366
when putting groups without coordination.

104
00:07:31,507 --> 00:07:34,469
On top of that, our combat kind of lacked direction.

105
00:07:34,989 --> 00:07:39,031
It was hard for us to tell what was going on.

106
00:07:39,091 --> 00:07:41,192
Like, are the blue enemy?

107
00:07:42,829 --> 00:07:46,330
attacking from the top, or the red ones coming from the bottom left here.

108
00:07:47,451 --> 00:07:53,153
If you weren't there for the beginning of the combat, it was unclear what exactly

109
00:07:53,993 --> 00:07:56,734
they were fighting about. On top of that,

110
00:07:57,674 --> 00:08:01,657
Our AIs weren't red and blue circles. Instead, they kind of looked like this.

111
00:08:02,277 --> 00:08:06,420
So they were mostly in green, grays, and brown.

112
00:08:07,080 --> 00:08:10,543
And they were in an environment that was predominantly green,

113
00:08:10,783 --> 00:08:13,805
gray, and brown. So instead of having this,

114
00:08:14,245 --> 00:08:19,569
we had something more akin to this. And it was impossible to just look at what

115
00:08:19,609 --> 00:08:22,691
was going on at a glance and see who was fighting who.

116
00:08:24,071 --> 00:08:27,793
So the first thing we realized we needed to do was to separate the two sides.

117
00:08:28,494 --> 00:08:34,297
And as soon as we did that, it became very obvious what was going on.

118
00:08:34,477 --> 00:08:37,559
Here we see that the blues are on the left and the reds are on the right.

119
00:08:38,080 --> 00:08:44,624
There might be environmental clues that will help us understand if the blues are defending or the reds are attacking or not.

120
00:08:46,572 --> 00:08:50,133
And also, when we turn our guys all back to green,

121
00:08:51,053 --> 00:08:52,934
it's still fairly easy to distinguish the two

122
00:08:52,974 --> 00:08:53,814
sides from each other.

123
00:08:53,834 --> 00:08:59,136
And on top of that, this separated sides also

124
00:08:59,176 --> 00:09:01,497
give the player more tactical options.

125
00:09:02,718 --> 00:09:06,119
Because now, there's a front here between the two sides,

126
00:09:06,659 --> 00:09:10,341
and each side has a flank, or two flanks, and a rear.

127
00:09:11,935 --> 00:09:15,598
And that means if the player happens upon this altercation in the world

128
00:09:16,038 --> 00:09:19,861
and decides to support one side over the other,

129
00:09:19,941 --> 00:09:23,264
the player can now attack his enemy in the rear

130
00:09:23,444 --> 00:09:26,547
or decide to shore up a weak flank

131
00:09:27,067 --> 00:09:29,609
and decide the player is supporting.

132
00:09:31,210 --> 00:09:33,812
So we needed to start organizing.

133
00:09:35,093 --> 00:09:38,937
And in our games, we organize our AIs into something called squads,

134
00:09:39,037 --> 00:09:40,818
which is just our name of our groups.

135
00:09:41,999 --> 00:09:44,904
And all AIs are organized in a squad.

136
00:09:44,944 --> 00:09:49,172
So when an AI spawns, we create a squad for that AI

137
00:09:49,312 --> 00:09:50,835
and put that AI on that squad.

138
00:09:51,507 --> 00:09:56,829
Now, obviously, having a score with just one AI in isn't all that interesting.

139
00:09:57,409 --> 00:09:59,830
There's not a whole lot of cooperation that's going to happen.

140
00:09:59,930 --> 00:10:06,813
So what we do is that if two squads get close to each other, or so that we have two members of

141
00:10:07,593 --> 00:10:12,015
the squads, one from each squad that are within a certain distance, well then these squads will

142
00:10:12,055 --> 00:10:17,237
merge together. And now there are one squad and they will operate and cooperate as one.

143
00:10:18,588 --> 00:10:20,250
So for instance, when we spawn our AIs,

144
00:10:20,630 --> 00:10:23,154
they tend to be spawned next to each other.

145
00:10:23,534 --> 00:10:26,117
So any AI on the same team will naturally

146
00:10:27,079 --> 00:10:28,821
merge into a single squad.

147
00:10:29,882 --> 00:10:34,648
Similarly, if squads break up, we also split up the squads

148
00:10:34,809 --> 00:10:36,911
into two or more squads.

149
00:10:38,189 --> 00:10:41,530
And this means that we don't need to figure out

150
00:10:41,870 --> 00:10:45,791
which AIs are going to be cooperating with other AIs.

151
00:10:46,172 --> 00:10:48,952
We know that because we have this automatic system,

152
00:10:49,553 --> 00:10:52,654
two AIs on the same team that are close enough to each other,

153
00:10:52,934 --> 00:10:54,354
they will always cooperate.

154
00:10:55,194 --> 00:10:59,036
And while two AIs that are too far away from each other

155
00:10:59,116 --> 00:11:01,636
to effectively be cooperating, will not.

156
00:11:03,782 --> 00:11:07,783
So squads in Days Gone are full AI entities,

157
00:11:07,903 --> 00:11:11,144
which means that they run our equivalent of a brain

158
00:11:11,364 --> 00:11:12,744
and they run actual behaviors.

159
00:11:13,805 --> 00:11:15,925
The squad's behaviors are primarily

160
00:11:17,026 --> 00:11:20,506
concerned with assigning roles to the individual squad

161
00:11:20,526 --> 00:11:20,967
members.

162
00:11:21,927 --> 00:11:25,228
And examples of roles is providing cover fire,

163
00:11:25,908 --> 00:11:28,248
being a grenadier, or flying to enemy.

164
00:11:29,615 --> 00:11:36,540
Individual AIs' responsibility vis-a-vis the squad is to perform those roles to the best of their ability.

165
00:11:38,061 --> 00:11:39,963
So roles in Days Gone

166
00:11:41,204 --> 00:11:47,709
are self-contained behaviors that are added to pre-determined slots in the AI's behavior hierarchy.

167
00:11:48,589 --> 00:11:50,991
This has a number of benefits. First of all,

168
00:11:51,672 --> 00:11:55,695
because the roles are self-contained, that means that if we want to write a new role,

169
00:11:56,075 --> 00:11:58,577
we don't need to touch any of the existing roles.

170
00:11:59,709 --> 00:12:02,891
Also, because we put the role in the AI's behavior hierarchy,

171
00:12:03,391 --> 00:12:06,253
that means that there are behaviors

172
00:12:06,453 --> 00:12:09,935
that AI has that are higher priority than the role.

173
00:12:11,336 --> 00:12:16,679
So for instance, if the AI is attacked by a grenade,

174
00:12:17,119 --> 00:12:19,701
the AI has a behavior for trying to avoid that grenade.

175
00:12:20,241 --> 00:12:23,723
And because that one will have a higher priority than roles,

176
00:12:23,763 --> 00:12:25,765
that means that no roles actually

177
00:12:25,805 --> 00:12:28,886
need to deal with the problem of being attacked by a grenade.

178
00:12:30,270 --> 00:12:34,793
Also, we have other behaviors that just have lower priority

179
00:12:34,833 --> 00:12:38,315
than a role, and these behaviors will never

180
00:12:38,376 --> 00:12:42,038
be performed as long as we have a valid role assigned to us.

181
00:12:44,400 --> 00:12:47,062
We also need to understand the tactical situation.

182
00:12:47,242 --> 00:12:49,744
And for that, we have something called the front line.

183
00:12:51,085 --> 00:12:54,587
The front line defines the spatial relationship

184
00:12:54,647 --> 00:12:56,408
between the squad and its enemies.

185
00:12:57,449 --> 00:12:59,651
And it consists of a directional combat.

186
00:13:00,995 --> 00:13:07,076
a width of the front, a neutral area, and an area controlled by the enemy.

187
00:13:08,437 --> 00:13:13,598
So to calculate the direction of combat, we find the center of gravity of our squad.

188
00:13:14,218 --> 00:13:17,359
And this is simply just the average position of our squad members.

189
00:13:18,459 --> 00:13:23,541
And then we find the center of gravity of our enemies, and the direction of combat

190
00:13:23,561 --> 00:13:25,821
is simply the direction between those two points.

191
00:13:30,510 --> 00:13:32,672
Next we had to figure out the width of the front.

192
00:13:33,673 --> 00:13:37,696
And this is either the width that the enemy is presenting

193
00:13:37,916 --> 00:13:42,980
to us, so if the enemy is spread out, well then our front line is going to be

194
00:13:43,480 --> 00:13:46,243
wide so that we can come spread out and meet the enemy.

195
00:13:47,130 --> 00:13:53,815
or a minimum width if the enemy is not that spread out, which is defined as the width that the

196
00:13:53,915 --> 00:13:59,980
squad would have if it's lined up abreast on the front line with a specific distance between them

197
00:14:00,000 --> 00:14:07,745
each other. Now we do this to make sure that there's enough room behind the front line for a

198
00:14:07,765 --> 00:14:15,992
squad to be able to fight effectively because the squad is not allowed to move outside the width of

199
00:14:16,012 --> 00:14:16,572
the front line.

200
00:14:18,307 --> 00:14:23,332
As for the neutral area, the front line can be operated either in a close or a far mode.

201
00:14:24,553 --> 00:14:30,099
In a close mode, the neutral area extends a fixed distance from the nearest enemy.

202
00:14:30,990 --> 00:14:34,392
So this means that the neutral area will move with the enemy,

203
00:14:34,952 --> 00:14:38,154
and the score is not allowed to enter the neutral area,

204
00:14:38,514 --> 00:14:42,216
which means that if the enemy is pushing in on the score,

205
00:14:42,456 --> 00:14:44,017
well, that would push the score backwards.

206
00:14:44,497 --> 00:14:47,318
But if the enemy moves away from the score,

207
00:14:47,418 --> 00:14:51,060
well, then the score can follow the enemy.

208
00:14:52,796 --> 00:14:57,961
In FAR mode, which is used a lot less frequently,

209
00:14:58,121 --> 00:15:01,764
the neutral area extends all the way to the closest squad

210
00:15:01,784 --> 00:15:02,084
member.

211
00:15:02,945 --> 00:15:05,267
And we use this in special scenarios

212
00:15:05,367 --> 00:15:07,949
when we want the squad to stay in place.

213
00:15:08,030 --> 00:15:11,032
For instance, if the squad is set

214
00:15:11,052 --> 00:15:17,198
to guard a particular object or a place or something like that.

215
00:15:18,429 --> 00:15:21,734
And because the neutral area extends all the way to the squad,

216
00:15:22,155 --> 00:15:25,540
it doesn't matter how far away the enemy moves.

217
00:15:25,920 --> 00:15:28,244
The squad is not allowed to enter the neutral area,

218
00:15:28,344 --> 00:15:31,629
so it will stay in place and continue guarding whatever it's guarding.

219
00:15:33,292 --> 00:15:39,677
And the enemy control area is simply the area that contains the enemy, plus a little bit of

220
00:15:39,697 --> 00:15:45,582
an additional depth behind. And the reason we add this additional depth is that, as we'll see later

221
00:15:45,602 --> 00:15:51,667
with flanking, it's good to have a little bit of depth to the enemy control area, because particularly

222
00:15:51,887 --> 00:15:57,211
if we were just fighting a single enemy, the enemy control area would otherwise have nearly no depth.

223
00:15:59,632 --> 00:16:00,932
On the other side of the front line,

224
00:16:01,373 --> 00:16:03,514
that space is divided into lanes.

225
00:16:03,814 --> 00:16:06,716
And we have one lane for each squad member.

226
00:16:07,637 --> 00:16:09,798
And each squad member is assigned a lane

227
00:16:09,899 --> 00:16:13,181
in such a way as to minimize overhaul movement.

228
00:16:14,201 --> 00:16:17,864
And the reason we have the lanes is to ensure

229
00:16:17,884 --> 00:16:21,546
that all the squad members are appropriately spread out

230
00:16:21,686 --> 00:16:25,049
along the front line and don't get into each other's way,

231
00:16:26,029 --> 00:16:27,971
and particularly each other's line of fire.

232
00:16:29,054 --> 00:16:35,337
So when a squad member is assigned a lane, that squad member will attempt to perform its role

233
00:16:35,477 --> 00:16:41,280
inside that lane if at all possible. Now it's worth noting that lane assignment is not just

234
00:16:41,320 --> 00:16:47,984
a one-off because as the front line moves around, what is the optimal lane assignment can change,

235
00:16:48,424 --> 00:16:55,607
particularly if the front line rotates. This can change the optimal lane assignment quite

236
00:16:55,828 --> 00:16:58,529
drastically even with small rotations.

237
00:17:01,121 --> 00:17:03,243
But we also need some motivation for our scores.

238
00:17:03,843 --> 00:17:06,346
And for that, we have something we call confidence.

239
00:17:08,167 --> 00:17:12,431
And confidence is a measure of how confident the AI is

240
00:17:12,832 --> 00:17:16,315
that it will win its current encounter.

241
00:17:16,555 --> 00:17:20,819
So a confident AI thinks that it's likely on the winning side,

242
00:17:21,159 --> 00:17:23,441
while an unconfident AI suspects it's

243
00:17:23,521 --> 00:17:24,602
betting on the wrong horse.

244
00:17:25,768 --> 00:17:31,652
Confidence is a major factor in decision making, both for individual AIs that have several behaviors

245
00:17:32,033 --> 00:17:39,038
that are fully or in part driven by confidence, but also for the squad which in combat is almost

246
00:17:39,098 --> 00:17:46,423
exclusively driven by confidence. Squads however do not have a confidence value of their own,

247
00:17:46,763 --> 00:17:51,667
instead they use the average confidence of the squad members rounded towards neutral.

248
00:17:53,944 --> 00:17:56,226
Our confidence is not an analog value.

249
00:17:56,286 --> 00:17:58,007
Instead, we use discrete levels.

250
00:17:58,587 --> 00:18:00,869
And we do this because it's much easier for the player

251
00:18:00,949 --> 00:18:05,872
to read distinct state changes rather than a subtle increase

252
00:18:05,972 --> 00:18:07,793
or decrease in a particular behavior.

253
00:18:09,314 --> 00:18:11,456
Our confidence levels are heroic,

254
00:18:11,676 --> 00:18:13,777
which is super confident.

255
00:18:13,797 --> 00:18:15,578
The AI don't think anything will touch it.

256
00:18:16,279 --> 00:18:18,620
Confident, the AI thinks it's on the winning side.

257
00:18:19,341 --> 00:18:21,622
Neutral, we don't really know how things are going.

258
00:18:22,283 --> 00:18:23,223
Weren't, were.

259
00:18:23,824 --> 00:18:31,231
definitely not probably not winning this and panicked which is I'm out of here. So to calculate

260
00:18:31,371 --> 00:18:38,018
an AI's confidence we calculate the total strength of each side and when I say side

261
00:18:39,202 --> 00:18:47,808
I mean for the friendly side, it's the squad members and any other friendly units that are

262
00:18:47,908 --> 00:18:54,071
fighting on the squad side. And for the enemy side, similarly, all the perceived enemies that

263
00:18:54,111 --> 00:18:59,555
we are aware of. And when we calculate the total strength, what we do is we sum up all the

264
00:18:59,615 --> 00:19:04,378
individual strengths of each enemy or each friendly that we found.

265
00:19:05,114 --> 00:19:10,359
and then we take the quotient between the friendly and the enemy side and compare that to threshold

266
00:19:10,419 --> 00:19:20,729
values to get our actual confidence level. So the way we calculate confidence or the strength of a

267
00:19:21,149 --> 00:19:28,116
single character is that we first get a starting strength and this starting strength is dependent

268
00:19:28,376 --> 00:19:29,457
on both the

269
00:19:30,696 --> 00:19:38,082
faction of the character whose strength we're calculating, but also the strength of the faction

270
00:19:38,202 --> 00:19:43,887
of the character viewing this faction. So we have something looking like this, a matrix of how

271
00:19:44,168 --> 00:19:50,513
various factions view each other. So for instance, we have certain factions like our militia faction

272
00:19:51,014 --> 00:19:55,638
that everyone kind of agrees that they are stronger than your average

273
00:19:57,742 --> 00:20:05,268
enemy and they are hence well respected. We also have something like our crazy

274
00:20:05,629 --> 00:20:11,234
Celtic faction called the Rippers who think they are just superior to everyone

275
00:20:11,254 --> 00:20:17,500
and we all know those kind of people and hence they think that everybody else's

276
00:20:18,020 --> 00:20:20,262
starting strength is pretty low.

277
00:20:21,248 --> 00:20:26,291
Normally, though, most factions kind of agree on which faction is the stronger,

278
00:20:26,371 --> 00:20:27,291
which one is the weaker.

279
00:20:27,931 --> 00:20:32,414
But we can have situations where both factions think the other one is superior,

280
00:20:32,834 --> 00:20:38,097
which will cause them both to have lower confidence and be more careful in

281
00:20:38,137 --> 00:20:43,119
combat. Or perhaps we could have two sides that think the other side is

282
00:20:43,179 --> 00:20:46,661
inferior, which will make them more aggressive and more confident fighting

283
00:20:46,701 --> 00:20:47,042
each other.

284
00:20:48,768 --> 00:20:50,168
So once we have this starting strength,

285
00:20:50,769 --> 00:20:54,530
we modify this strength with various multipliers.

286
00:20:55,070 --> 00:20:57,631
The most important multipliers is what kind of weapon

287
00:20:57,791 --> 00:20:58,812
the AI is carrying.

288
00:20:59,512 --> 00:21:03,634
So for instance, a machine gun is much scarier than a pistol.

289
00:21:04,694 --> 00:21:08,236
If the AI is armored or not, the health of the AI.

290
00:21:08,436 --> 00:21:10,757
And here again, we have a distinct level.

291
00:21:10,857 --> 00:21:14,338
So we only check if the AI is severely wounded or not.

292
00:21:15,238 --> 00:21:16,899
And finally, the confidence of the AI.

293
00:21:18,025 --> 00:21:22,769
So a confident AI will lift up its squad's confidence,

294
00:21:22,949 --> 00:21:25,951
while an unconfident AI will bring its squad down.

295
00:21:26,892 --> 00:21:32,536
And panicked AI here has a specific effect

296
00:21:32,857 --> 00:21:33,917
and is a special case.

297
00:21:34,338 --> 00:21:37,981
So if you're fighting an enemy squad

298
00:21:38,081 --> 00:21:39,742
and you see one of the squad members

299
00:21:39,802 --> 00:21:42,945
just freak out and run off, we want that squad

300
00:21:42,985 --> 00:21:44,506
to be close to breaking.

301
00:21:45,026 --> 00:21:46,688
And in order to emphasize that...

302
00:21:47,715 --> 00:21:51,300
We add panic AI strength not to the friendly side,

303
00:21:51,640 --> 00:21:52,862
but to the enemy side.

304
00:21:54,584 --> 00:21:57,367
We also add the strength of casualties,

305
00:21:57,407 --> 00:22:00,471
so not just the strength of the living, to the total strength.

306
00:22:01,561 --> 00:22:09,723
And the reason we do that is if we have a squad that manages to deal out a disproportionate

307
00:22:09,783 --> 00:22:15,904
number of casualties to the enemies, we want that squad to become extra confident and extra

308
00:22:15,924 --> 00:22:22,926
aggressive. And likewise, if your side is taking an unnecessarily or unreasonable number of casualties

309
00:22:23,506 --> 00:22:25,486
that will negatively affect your confidence.

310
00:22:26,930 --> 00:22:29,452
Cacophony is something that degrades over time,

311
00:22:29,472 --> 00:22:33,095
and this is a timescale that is much longer

312
00:22:33,115 --> 00:22:34,777
than your typical combat encounter.

313
00:22:35,217 --> 00:22:37,560
And the reason we do this is to make sure

314
00:22:37,880 --> 00:22:39,942
that if the player follows a squad

315
00:22:39,982 --> 00:22:41,263
for an extended period of time,

316
00:22:42,184 --> 00:22:45,387
well, that that squad isn't permanently elated

317
00:22:45,587 --> 00:22:47,729
or permanently depressed for something

318
00:22:47,769 --> 00:22:49,391
that happened way back then,

319
00:22:49,811 --> 00:22:52,433
maybe even before the player started following that squad.

320
00:22:54,405 --> 00:22:58,427
So it turns out that confidence is a good predictor of outcome in our game.

321
00:22:58,907 --> 00:23:02,189
A confident AI is very likely to be on the winning side,

322
00:23:02,669 --> 00:23:06,070
and an unconfident AI is very likely to be losing.

323
00:23:06,890 --> 00:23:07,571
And this is great.

324
00:23:08,091 --> 00:23:16,955
This is just like a receipt that what we're doing with confidence is what we want to.

325
00:23:16,975 --> 00:23:18,075
It's working.

326
00:23:18,755 --> 00:23:21,757
But when it comes to the player, we want something more.

327
00:23:22,257 --> 00:23:22,517
Because...

328
00:23:23,558 --> 00:23:30,320
We want to use confidence in a way to encourage the player to play with a certain play style.

329
00:23:30,760 --> 00:23:38,722
And the way this works is a confident AI, as we will see, will become more aggressive,

330
00:23:38,903 --> 00:23:41,683
while an unconfident AI becomes more passive.

331
00:23:42,340 --> 00:23:50,183
So if we're noticing that the player is not really engaging with the AI, instead trying to hide behind

332
00:23:50,203 --> 00:23:57,766
a car, far away, and take potshots, well, then we start increasing the confidence of the AI

333
00:23:59,807 --> 00:24:04,349
in order to make the AI more aggressive and force the player to do something else.

334
00:24:05,049 --> 00:24:06,589
Well, if the player is

335
00:24:07,764 --> 00:24:15,066
himself being aggressive and doing flanking and invalidating cover, going to melee and just using

336
00:24:15,106 --> 00:24:19,908
all the tools available to the player, well then we start decreasing the confidence of the AI,

337
00:24:20,948 --> 00:24:26,110
which will make the AI a little bit less aggressive and this will give the player a better

338
00:24:26,130 --> 00:24:31,672
chance of pulling these behaviors off and hopefully make the player more likely to try this in the future.

339
00:24:33,765 --> 00:24:37,807
So now that we have both the confidence to tell us

340
00:24:38,348 --> 00:24:41,289
how we're feeling about things and the front line to tell us

341
00:24:41,509 --> 00:24:45,872
about how things are looking for us, where everyone are,

342
00:24:46,652 --> 00:24:49,653
well, we're ready to create some behaviors.

343
00:24:50,934 --> 00:24:53,295
So in combat, the squad can either

344
00:24:53,335 --> 00:24:57,578
be forming up in normal combat, retreating,

345
00:24:58,118 --> 00:24:59,278
or pushing the attack.

346
00:25:00,739 --> 00:25:02,300
Forming up happens when.

347
00:25:03,745 --> 00:25:08,629
one or more squad members are out of position, and this is either

348
00:25:08,669 --> 00:25:14,575
the squad member is too far forward, so the squad member is in the neutral area or maybe in the enemy control area,

349
00:25:15,176 --> 00:25:21,162
too far to the side, so the squad member is outside the width of the front line, or too far behind,

350
00:25:21,583 --> 00:25:26,487
so the squad member is outside its weapons effective range.

351
00:25:27,694 --> 00:25:33,717
this happen, any squad member that's already in position will just hold that position and engage

352
00:25:33,757 --> 00:25:41,562
the enemy to try to keep the enemy occupied. AIs that are far away from the front line and the

353
00:25:41,623 --> 00:25:48,167
enemy will just run in a straight line towards the front line to try and get into position. However,

354
00:25:48,427 --> 00:25:51,369
if we are close enough to the enemy that that is not safe,

355
00:25:52,315 --> 00:25:55,636
the AI will instead move from cover to cover

356
00:25:56,497 --> 00:25:59,158
until it makes it back to a good position.

357
00:26:00,658 --> 00:26:03,979
Once everyone is there, we are ready to go back

358
00:26:04,019 --> 00:26:05,120
to normal combat.

359
00:26:06,180 --> 00:26:08,301
So during normal combat, which happens

360
00:26:08,541 --> 00:26:13,523
when confidence is neutral, we're focusing on the basics.

361
00:26:13,563 --> 00:26:15,844
So we're trying to maintain good spacing

362
00:26:15,884 --> 00:26:18,825
within the squad, which is what the lanes are there for.

363
00:26:19,839 --> 00:26:24,186
We make sure we have a clear direction of combat, which is what the front line gives us.

364
00:26:25,348 --> 00:26:31,258
And we also make sure that our sides are well separated, which is what the neutral area is there to do.

365
00:26:32,372 --> 00:26:34,834
And this creates a very good-looking and interesting

366
00:26:34,954 --> 00:26:35,935
dynamic combat.

367
00:26:36,335 --> 00:26:40,117
Because as the squad and the enemy moves,

368
00:26:40,317 --> 00:26:43,739
the front line will move and rotate with that.

369
00:26:44,200 --> 00:26:49,683
And that will cause the squad to counter any enemy moves, which

370
00:26:50,264 --> 00:26:52,645
look quite impressive when you look at it.

371
00:26:52,665 --> 00:26:57,128
However, if the AI's confidence is low,

372
00:26:57,408 --> 00:26:59,810
the AI will go and try to retreat.

373
00:27:00,070 --> 00:27:00,870
And when retreating...

374
00:27:01,607 --> 00:27:06,229
The best direction to retreat in is obviously away from the enemy,

375
00:27:06,669 --> 00:27:11,311
and that happens to be the exact opposite of the direction of combat in the front line.

376
00:27:12,552 --> 00:27:17,174
So, when we're retreating, we select half of the squad members to retreat,

377
00:27:17,454 --> 00:27:19,955
and we prioritize those squad members that have no cover,

378
00:27:20,035 --> 00:27:24,377
but otherwise we take those squad members that are the closest to the front line.

379
00:27:26,335 --> 00:27:31,579
Any AI that is not selected to retreat will provide cover fire for the retreating AIs.

380
00:27:32,580 --> 00:27:37,703
The retreating AIs only move a short distance back because when you're retreating you're

381
00:27:37,763 --> 00:27:41,186
at your most vulnerable because you have to turn your back on your enemy.

382
00:27:42,458 --> 00:27:44,159
And then this behavior repeats.

383
00:27:44,759 --> 00:27:48,560
And the interesting thing is that because the AIs that

384
00:27:48,600 --> 00:27:51,180
were closer to the front line now move back,

385
00:27:52,041 --> 00:27:54,541
in the next iteration of the retreating,

386
00:27:55,141 --> 00:27:57,562
the AIs that were providing cover and fire

387
00:27:57,722 --> 00:27:59,322
will probably be the ones retreating,

388
00:27:59,462 --> 00:28:01,563
while the ones that were treated previously now

389
00:28:01,603 --> 00:28:02,523
provides cover fire.

390
00:28:03,003 --> 00:28:05,243
So what we get is two groups of AIs

391
00:28:05,303 --> 00:28:10,384
that are changing up between retreating and providing

392
00:28:10,404 --> 00:28:11,085
cover and fire.

393
00:28:11,105 --> 00:28:11,485
Thank you.

394
00:28:11,805 --> 00:28:13,926
creates a very nice looking leapfrogging effect.

395
00:28:15,466 --> 00:28:16,927
The score will continue to retreat

396
00:28:17,147 --> 00:28:18,268
until either it's blocked,

397
00:28:18,908 --> 00:28:21,169
it managed to break contact with the enemy,

398
00:28:21,869 --> 00:28:23,930
or for whatever reason,

399
00:28:24,591 --> 00:28:27,012
it managed to regain its confidence.

400
00:28:28,892 --> 00:28:32,814
If the score has high confidence on the other hand,

401
00:28:33,274 --> 00:28:37,896
the AI will go on the offensive and try to press the attack.

402
00:28:39,060 --> 00:28:42,542
First thing the AI will do is try to move closer to the enemy.

403
00:28:43,142 --> 00:28:45,784
And this is a behavior that is very similar to retreat

404
00:28:45,804 --> 00:28:47,905
behavior, only it goes in reverse.

405
00:28:48,385 --> 00:28:50,486
So the AS that are first for the front line

406
00:28:50,586 --> 00:28:53,047
are selected to move forward, while the remaining

407
00:28:53,207 --> 00:28:54,628
AS will provide cover fire.

408
00:28:55,688 --> 00:28:58,590
And we continue doing this until the squad gets close enough

409
00:28:59,010 --> 00:29:02,912
to the enemy, at which point we will try to flank the enemy.

410
00:29:03,924 --> 00:29:09,966
Flankers are picked among the squad members as those that are already in a good flanking position,

411
00:29:10,426 --> 00:29:14,848
which means that they are either on the extreme left or right of the front line.

412
00:29:15,868 --> 00:29:23,971
So when we're flanking, the flanker will try and find a position in an area perpendicular to the

413
00:29:24,491 --> 00:29:31,333
enemy control area. And this is where it really comes in handy to have a little bit more depth

414
00:29:31,693 --> 00:29:32,993
to the enemy control area.

415
00:29:34,629 --> 00:29:40,479
And the reason for that is that the squad member has more opportunities to find a good position

416
00:29:41,400 --> 00:29:46,489
to attack from in here and also if you're a little bit behind the enemy.

417
00:29:47,613 --> 00:29:53,078
that makes for a better flanking position than if you're perfectly in alignment with them.

418
00:29:53,378 --> 00:29:58,362
As some of you may have realized by now, the quality of the front line is really key to

419
00:29:59,383 --> 00:30:04,367
the quality of our behavior. So if our front line is bad, so is our behavior.

420
00:30:06,360 --> 00:30:10,822
Particularly the front line determines if an AI's position is valid.

421
00:30:11,522 --> 00:30:19,025
So repeated small changes in the front line can cause the AI's position to be invalidated

422
00:30:19,185 --> 00:30:20,126
over and over again.

423
00:30:20,146 --> 00:30:26,208
And obviously this causes the same kind of problem that we talked about before, moving

424
00:30:26,248 --> 00:30:26,948
instead of shooting.

425
00:30:26,968 --> 00:30:33,711
And also it makes the AI look very indecisive, which generally speaking does not make for

426
00:30:33,751 --> 00:30:34,531
a good-looking AI.

427
00:30:36,142 --> 00:30:40,885
So what we realized was that there are a number of things that caused the frontline to move

428
00:30:41,225 --> 00:30:46,889
when it didn't need to. So we spent a fair bit of effort finding and addressing a lot of these.

429
00:30:48,235 --> 00:30:53,800
One of the first things we realized was that certain AI archetypes just did not play very

430
00:30:53,860 --> 00:30:55,141
well with the frontline.

431
00:30:55,942 --> 00:31:01,967
The first such one was our snipers, who, as their name implies, are snipers and want to

432
00:31:02,007 --> 00:31:04,549
engage their enemy at extreme distances.

433
00:31:05,350 --> 00:31:10,094
And they live in these little areas called sniper nests that they are not allowed to

434
00:31:10,154 --> 00:31:10,374
leave.

435
00:31:11,380 --> 00:31:18,148
So if they would be part of a squad, then because the sniper can't move with the squad,

436
00:31:18,489 --> 00:31:22,393
the squad's center of gravity would be pulled towards the sniper all the time,

437
00:31:22,774 --> 00:31:26,478
and the squad would not be able to properly move with its enemy.

438
00:31:27,539 --> 00:31:30,502
And hence, we just don't add snipers to our squads.

439
00:31:31,621 --> 00:31:36,642
On the other extreme, we have an archetype we call rushes.

440
00:31:37,382 --> 00:31:40,703
And the rushes are armed with shotguns

441
00:31:41,063 --> 00:31:43,184
that have very short range or melee weapons.

442
00:31:43,744 --> 00:31:48,465
So their tactics is to run straight up to the enemy

443
00:31:48,505 --> 00:31:50,566
and attack at really close distance.

444
00:31:51,958 --> 00:31:56,819
Obviously, this means that they run straight through the neutral area and well into the enemy controlled area.

445
00:31:57,559 --> 00:32:03,081
And this would cause problems with our frontline calculations, both for friendly and enemy rushes.

446
00:32:04,261 --> 00:32:08,321
And again, we just ignore them and don't add them to the frontline calculation.

447
00:32:08,942 --> 00:32:12,482
And the squad doesn't need to deal with rushes specifically anyway,

448
00:32:12,802 --> 00:32:18,603
because we have high priority behaviors that will kick in if a rusher gets really close to an AI.

449
00:32:21,148 --> 00:32:23,590
DayZGon is, as I mentioned, a cover shooter,

450
00:32:23,770 --> 00:32:28,894
which means that almost all our combat happens in or around cover.

451
00:32:30,095 --> 00:32:34,339
The way AI uses cover in DayZGon is that we have something called a cover slot,

452
00:32:34,880 --> 00:32:39,584
which gives the position where the AI is supposed to go in order to use the cover,

453
00:32:40,244 --> 00:32:44,908
and it also has some additional information on the details of how to use that cover.

454
00:32:46,492 --> 00:32:48,414
But when the AI gets to the cover slot,

455
00:32:48,614 --> 00:32:51,976
its position doesn't stay right on top of the slot.

456
00:32:52,317 --> 00:32:54,839
There's a number of behaviors and animations

457
00:32:54,879 --> 00:32:58,701
that cause the AI to move.

458
00:32:58,782 --> 00:33:00,823
For instance, our reload animation

459
00:33:00,843 --> 00:33:03,825
has the AI take a step back away from its cover

460
00:33:03,885 --> 00:33:05,847
to make sure that its weapon doesn't

461
00:33:05,947 --> 00:33:07,808
intersect with the cover when it's

462
00:33:07,868 --> 00:33:09,209
playing the reload animation.

463
00:33:10,310 --> 00:33:11,911
And even more extreme.

464
00:33:12,847 --> 00:33:21,413
When attacking an enemy from cover, particularly high cover, the AI may need to step out of that cover in order to get a clear line of sight to the enemy.

465
00:33:21,933 --> 00:33:24,975
And this movement can be as far as two meters.

466
00:33:26,396 --> 00:33:31,820
So the AI's moving around while in cover caused a lot of jitter in the front line.

467
00:33:32,638 --> 00:33:37,702
And what we realized was that it didn't really matter exactly where the AI was as long as

468
00:33:37,842 --> 00:33:39,483
it was using a cover slot.

469
00:33:40,043 --> 00:33:46,528
So what we ended up doing was using the position of the AI's cover slot rather than the AI

470
00:33:47,029 --> 00:33:48,870
whenever the AI was in cover.

471
00:33:49,330 --> 00:33:52,413
And this had settled down the front line quite a bit.

472
00:33:54,437 --> 00:33:58,380
We also calculate the front line as a sliding window average.

473
00:33:58,440 --> 00:34:01,202
So that means that its position and direction

474
00:34:01,222 --> 00:34:06,345
is calculated as the average in a certain time window.

475
00:34:07,906 --> 00:34:11,308
And this moves out the movement of the front line

476
00:34:11,708 --> 00:34:13,569
and leaves us with the general trend

477
00:34:13,730 --> 00:34:15,090
while removing a lot of noise.

478
00:34:16,191 --> 00:34:19,493
But using the average over time makes the AI kind of

479
00:34:19,513 --> 00:34:21,014
slow to react to big changes.

480
00:34:21,899 --> 00:34:24,023
And so what we do is that if.

481
00:34:25,864 --> 00:34:31,930
the change becomes significant, then they are adopted at a higher rate than small changes.

482
00:34:32,390 --> 00:34:39,216
And if the change is large enough, well then we just take that new position and rotation and start working from there.

483
00:34:39,236 --> 00:34:45,402
And this is to deal with situations where we might be fighting a small group of enemies over here,

484
00:34:45,682 --> 00:34:51,807
and then a massive enemy force show up from the other side, and we need to pivot to deal with them.

485
00:34:54,475 --> 00:34:55,856
Flankers are great.

486
00:34:55,896 --> 00:34:57,858
That's one of the coolest behaviors

487
00:34:57,898 --> 00:34:59,639
that AI does in combat.

488
00:34:59,959 --> 00:35:02,061
But they also cause a bit of problem.

489
00:35:02,621 --> 00:35:06,404
So if we were to have flankers and treat them

490
00:35:06,604 --> 00:35:09,406
as normal members of the squad during combat,

491
00:35:09,787 --> 00:35:11,828
that would be an issue.

492
00:35:11,908 --> 00:35:14,090
Because as the flanker flanks,

493
00:35:16,071 --> 00:35:19,834
the center of gravity would have to move with the flanker.

494
00:35:20,595 --> 00:35:22,116
And when the center of gravity moves,

495
00:35:22,216 --> 00:35:23,697
that means that the front line moves.

496
00:35:24,803 --> 00:35:31,490
And as you can see in this example, when the front flank moves like this, the flanker is no longer in a valid flanking position.

497
00:35:32,010 --> 00:35:42,160
And even worse, the two AIs that stayed behind to support that flanker's flanking move are now out of position, and the score would have to go back to forming up.

498
00:35:43,520 --> 00:35:47,801
So fortunately for us, identifying friendly flankers is easy.

499
00:35:47,821 --> 00:35:53,283
It's just the people that the squad has told to be a flanker

500
00:35:54,143 --> 00:35:57,143
and who has started performing the flanking role.

501
00:35:58,604 --> 00:36:01,184
So we don't need to add them to the center of gravity.

502
00:36:01,204 --> 00:36:06,086
However, if we do that, that also comes with a bit of a problem. So again, if the

503
00:36:06,126 --> 00:36:09,286
flanker flanks and the flanker no longer

504
00:36:11,035 --> 00:36:14,197
contributes to the center of gravity? Well, the center of gravity is going to move again,

505
00:36:14,217 --> 00:36:20,080
which will cause the front line to move. And again, the flanker's position is now invalid.

506
00:36:20,100 --> 00:36:26,263
Admittedly, this is not quite as bad as the previous example, but it's still not good.

507
00:36:27,564 --> 00:36:35,888
So what we do is that a flanker on the flank leaves a ghost behind in the front line. Now the ghost

508
00:36:37,360 --> 00:36:42,567
is just the position the flanker had before the flanker started flanking.

509
00:36:43,027 --> 00:36:49,155
So whenever we now need to calculate the squads position and center of gravity,

510
00:36:49,536 --> 00:36:55,583
we use the ghost position rather than that of the flanker, and this greatly stabilizes the front line.

511
00:36:56,934 --> 00:37:00,017
The ghost is removed if the front line moves far enough.

512
00:37:00,578 --> 00:37:02,960
And this is because the ghost cannot move, it's just a position.

513
00:37:03,841 --> 00:37:06,824
And the whole point of adding the ghost is to stabilize the front line

514
00:37:07,165 --> 00:37:08,546
when the flanker flanks.

515
00:37:09,187 --> 00:37:11,289
And if the front line needs to move,

516
00:37:11,669 --> 00:37:15,093
well, then there's no point in trying to stabilize the front line,

517
00:37:15,133 --> 00:37:17,335
because if it needs to move, it should move.

518
00:37:18,858 --> 00:37:25,206
The ghost is also removed if the flanker rejoins the front line,

519
00:37:25,226 --> 00:37:27,730
that is, it's no longer a flanker,

520
00:37:28,371 --> 00:37:31,956
or the flanker is no longer part of the squad for whatever reason.

521
00:37:33,738 --> 00:37:36,141
Enemy flankers are a lot more complicated.

522
00:37:37,252 --> 00:37:46,442
And the reason for this is that our front line may not necessarily be the opposite of the enemy's front line.

523
00:37:46,462 --> 00:37:49,925
So we may not have a mirror image front line.

524
00:37:50,506 --> 00:37:57,774
First of all, we might be fighting multiple enemy squads, in which case their front lines will look very different from our front line.

525
00:37:58,459 --> 00:38:03,222
or the enemy might be fighting our squad and another friendly squad.

526
00:38:03,262 --> 00:38:07,465
So then, in that case, the enemy's frontline will be different.

527
00:38:08,626 --> 00:38:14,450
And also, there's nothing guaranteeing that there's only two sides involved in a particular encounter.

528
00:38:14,850 --> 00:38:18,412
There may be three or more factions battling it out at the same time.

529
00:38:19,625 --> 00:38:22,468
And finally, the flanker, or the potential flanker,

530
00:38:22,568 --> 00:38:25,191
could be the player, and the player doesn't have a score

531
00:38:25,231 --> 00:38:28,896
that lets the player know whether the player is assigned

532
00:38:29,016 --> 00:38:30,037
a flanking role or not.

533
00:38:31,239 --> 00:38:35,804
So the way we deal with enemy flankers and...

534
00:38:36,994 --> 00:38:43,898
enemy-centric gravity calculation is a little bit more complicated compared to the friendly ones.

535
00:38:44,799 --> 00:38:51,963
So first we identify all clusters of enemies and this is just a simple clustering algorithm

536
00:38:52,323 --> 00:38:59,808
that runs on distances. Once we have these clusters we find the largest such cluster

537
00:39:00,768 --> 00:39:06,091
and then add any cluster that's within a given faction of the size of that largest cluster.

538
00:39:07,766 --> 00:39:10,867
This allows us to calculate a tentative front line,

539
00:39:11,948 --> 00:39:14,469
and then we can add any cluster that

540
00:39:14,589 --> 00:39:19,231
is covered by that front line, which then allows us

541
00:39:19,271 --> 00:39:21,633
to calculate the final front line.

542
00:39:22,653 --> 00:39:26,055
This may leave us with one or more clusters

543
00:39:26,095 --> 00:39:28,036
that are not covered by the front line,

544
00:39:28,156 --> 00:39:29,696
and these are our flankers.

545
00:39:31,319 --> 00:39:42,982
So, we like flanking, as I said, but the tactically sound option for a squad that is being flanked

546
00:39:43,442 --> 00:39:45,803
is to try to do something about it.

547
00:39:46,323 --> 00:39:51,824
You should really not just stay being flanked, but that wouldn't be fun because that would

548
00:39:51,844 --> 00:39:56,866
mean that the flanking would pretty much just fail because the enemy would move every time.

549
00:39:57,586 --> 00:40:04,298
So what we do is we let the flanker flank us for a given amount of time.

550
00:40:04,719 --> 00:40:09,027
So whenever we see a flanker, then we give the flanker a timestamp.

551
00:40:10,316 --> 00:40:16,618
and as long as that timestamp hasn't expired, we let the flanker be, but as soon as it expires,

552
00:40:17,279 --> 00:40:26,322
then the flanker is put back on the center of gravity calculation and with the rest of the

553
00:40:26,362 --> 00:40:32,885
enemies, and this will cause the front line to move, and that will cause in turn the score to

554
00:40:33,045 --> 00:40:34,465
and deal with the hit.

555
00:40:35,266 --> 00:40:40,389
And if that flanker wants to continue flanking us, well that flanker will have to make another

556
00:40:40,429 --> 00:40:41,029
flanking move.

557
00:40:43,050 --> 00:40:51,155
Now another thing we noticed was that the player is able to move a lot more than a simple

558
00:40:51,175 --> 00:40:51,295
AI.

559
00:40:52,697 --> 00:40:57,562
And part of that is that the AI doesn't have the weight for all its friends to be ready

560
00:40:57,682 --> 00:41:00,765
and in position to make a move like AI is in the score.

561
00:41:01,225 --> 00:41:08,753
But also the player has this sprinting ability that makes the player by far the fastest human

562
00:41:08,953 --> 00:41:09,774
in the entire game.

563
00:41:10,750 --> 00:41:15,931
And we would see the player run in wide circles around the AI,

564
00:41:16,332 --> 00:41:19,733
which would cause the AI to perpetually have

565
00:41:19,793 --> 00:41:24,494
to rearrange itself to meet the player's new position.

566
00:41:25,975 --> 00:41:29,316
And we did a lot of work on trying to make the AI be

567
00:41:29,456 --> 00:41:30,997
faster at repositioning.

568
00:41:31,397 --> 00:41:35,318
But all the things that we did were simply just not enough.

569
00:41:35,358 --> 00:41:36,378
There was not even close.

570
00:41:38,009 --> 00:41:45,293
What we eventually realized was that when the player is running fast like this,

571
00:41:45,734 --> 00:41:48,936
the player has no chance of hitting anything with his gun.

572
00:41:49,806 --> 00:41:55,469
But the AI, on the other hand, doesn't have a big problem hitting moving targets.

573
00:41:56,049 --> 00:42:00,052
So what we do is that when we identify that the player is starting to move

574
00:42:00,492 --> 00:42:05,975
at a very high speed, the AI just waits for the player to settle down.

575
00:42:06,575 --> 00:42:11,218
And the player will settle down sooner or later, or rather sooner than later.

576
00:42:11,718 --> 00:42:15,662
because the AI will start building accuracy on the player relatively quickly

577
00:42:16,302 --> 00:42:20,486
and the player will be forced to get into cover or close into melee distance.

578
00:42:20,987 --> 00:42:24,150
And when that happens, that gives us a little bit of a pause

579
00:42:24,630 --> 00:42:29,935
that allows the AI to rearrange itself and meet the player at the player's new position.

580
00:42:31,617 --> 00:42:33,118
Now so far the

581
00:42:34,784 --> 00:42:41,791
front line that we use is only looking at the enemy's position relative to our own position,

582
00:42:42,192 --> 00:42:47,517
but it doesn't have any environmental information. And the thing is environmental information and

583
00:42:47,938 --> 00:42:51,642
environmental analysis is quite a lot of work.

584
00:42:52,592 --> 00:42:56,233
We're a bit lazy, so we realized that we were very fortunate

585
00:42:56,253 --> 00:42:59,195
that we knew some people who had an intimate knowledge

586
00:42:59,355 --> 00:43:02,897
of the environment in which the AI was going to operate in.

587
00:43:03,357 --> 00:43:04,718
And that's our level designers.

588
00:43:05,718 --> 00:43:09,720
So our level designers can provide context

589
00:43:10,300 --> 00:43:13,322
and identify features and defensive opportunities

590
00:43:13,742 --> 00:43:18,004
within our levels by adding a number of markups.

591
00:43:18,504 --> 00:43:21,026
The most important ones of these are our defense zones.

592
00:43:22,283 --> 00:43:24,785
our home areas and our fortification zones.

593
00:43:26,627 --> 00:43:32,513
Defense zones are large areas in which the AI operates and you can kind of think of them as the AI's

594
00:43:33,474 --> 00:43:34,394
sort of territory.

595
00:43:36,023 --> 00:43:40,165
Each score is bound to its defense zone with a given strength.

596
00:43:40,365 --> 00:43:43,186
And all but the strongest binding strength

597
00:43:43,326 --> 00:43:46,287
allows the AI to temporarily leave its defense zone.

598
00:43:47,048 --> 00:43:51,670
And the reason why we want the AI to be able to leave the defense zone is that

599
00:43:51,770 --> 00:43:54,851
if you have arbitrary invisible lines in the world,

600
00:43:55,411 --> 00:43:59,433
that has a tendency to create weird behavioral artifacts. And on the team

601
00:43:59,753 --> 00:44:02,074
we call that the Mime in a Box problem.

602
00:44:02,094 --> 00:44:02,134
So...

603
00:44:05,844 --> 00:44:12,651
The way we ensure that the AI doesn't just permanently want us off from the defense zone is that we use confidence.

604
00:44:13,172 --> 00:44:22,041
So a confidence call is allowed to press the attack and go outside of its defense zone if the enemy was outside the defense zone.

605
00:44:23,117 --> 00:44:29,301
As the squad leaves the defense zone, it starts including a confidence penalty.

606
00:44:30,022 --> 00:44:37,226
And as the squad moves further out, the squad's confidence will eventually drop to the point of

607
00:44:37,266 --> 00:44:44,671
neutral, which will force the squad to stop. And the squad will then hold its position and

608
00:44:44,811 --> 00:44:50,635
eventually the squad's confidence will drop even further and therefore cause the squad to move

609
00:44:50,675 --> 00:44:51,616
back to its defense zone.

610
00:44:52,855 --> 00:44:58,338
Once back in this defense zone, the score will slowly recover its confidence.

611
00:44:58,938 --> 00:45:04,681
And the reason why we do this slowly rather than immediately recover the confidence is

612
00:45:05,141 --> 00:45:10,923
that if the score's real confidence was, say, confident, and we immediately gave back its

613
00:45:11,104 --> 00:45:15,385
full confidence when it came back in the defense zone, the score would immediately leave again,

614
00:45:15,846 --> 00:45:17,907
and we don't want that kind of flip-flopping behavior.

615
00:45:20,011 --> 00:45:25,214
The home area can be used in conjunction with the defense zone or on its own.

616
00:45:25,714 --> 00:45:31,377
And this is a much smaller area that marks up where the AI is anchored.

617
00:45:31,817 --> 00:45:36,160
So this could be the AI's base or camp or maybe a resources guarding.

618
00:45:36,180 --> 00:45:41,703
And when a squad is assigned to a home area, a number of things happen.

619
00:45:41,883 --> 00:45:45,244
First of all, the squad will always retreat towards its home area.

620
00:45:46,339 --> 00:45:51,262
And once it reaches the home area, it will never retreat any further, so effectively,

621
00:45:51,282 --> 00:45:55,305
it makes a last stand inside its home area.

622
00:45:56,866 --> 00:46:02,791
And if an enemy manages to get in between the squad and its home area, the squad gets

623
00:46:02,851 --> 00:46:07,014
really upset and is allowed to press its attack, even if neutral.

624
00:46:08,382 --> 00:46:11,324
So I said that the score always retreats to the home area,

625
00:46:11,484 --> 00:46:14,667
but if we take two arbitrary points in the world

626
00:46:15,127 --> 00:46:17,549
representing two central gravities for a score

627
00:46:17,569 --> 00:46:21,652
or enemy and with the corresponding front line,

628
00:46:22,032 --> 00:46:24,534
it's very unlikely that the retreat direction

629
00:46:24,574 --> 00:46:26,416
will be towards the home area.

630
00:46:27,637 --> 00:46:31,400
So the way we deal with this is that we

631
00:46:31,800 --> 00:46:35,122
bias the score's center of gravity

632
00:46:35,243 --> 00:46:36,864
towards the home area's position.

633
00:46:38,284 --> 00:46:40,425
And the closer the squirt gets to the home area,

634
00:46:40,765 --> 00:46:42,686
the stronger the home area's influence is,

635
00:46:43,206 --> 00:46:45,507
until, if the squirt gets close enough,

636
00:46:45,907 --> 00:46:47,888
the home area's position completely

637
00:46:47,908 --> 00:46:50,149
overrides that of the squirt's center of gravity.

638
00:46:51,270 --> 00:46:55,291
And regardless of how far away the squirt is from the home

639
00:46:55,351 --> 00:46:59,173
area, we ensure that the front line is never

640
00:46:59,253 --> 00:47:01,014
rotated 90 degrees or more.

641
00:47:01,414 --> 00:47:04,575
And that way, always, when the squirt retreats,

642
00:47:04,895 --> 00:47:06,396
it will get closer to the home area.

643
00:47:08,676 --> 00:47:16,041
So the score also needs to take advantage of strong points and short points and other good defensive opportunities.

644
00:47:16,802 --> 00:47:20,164
And for that, our level designers place fortification zones.

645
00:47:21,385 --> 00:47:25,168
A fortification zone consists of an area to fight from,

646
00:47:26,562 --> 00:47:28,984
and a kill zone in which we're going to attack.

647
00:47:29,444 --> 00:47:32,847
So the area to fight from is where we're defending from,

648
00:47:33,087 --> 00:47:35,208
and the kill zone is where our enemy is coming.

649
00:47:35,849 --> 00:47:39,111
And it's worth noting that the kill zone is a frustum,

650
00:47:40,392 --> 00:47:42,933
because generally speaking,

651
00:47:43,073 --> 00:47:44,234
if you're defending from position,

652
00:47:44,554 --> 00:47:47,757
you will be defending in like a frustum in front of you.

653
00:47:48,717 --> 00:47:51,659
And that the kill zone isn't necessarily attached

654
00:47:52,079 --> 00:47:53,881
to the area to fight from.

655
00:47:54,879 --> 00:48:00,961
And for instance, this is useful if you're on an elevated position and defending the

656
00:48:01,001 --> 00:48:06,963
ground below, while then you want to kill someone down below, rather than up where your

657
00:48:07,143 --> 00:48:08,123
area to fight from is.

658
00:48:08,784 --> 00:48:14,326
And also, if you're in a fortification and your enemy managed to get right up to that

659
00:48:14,346 --> 00:48:20,588
fortification, that probably means that your fortification is about to be overrun and you

660
00:48:20,628 --> 00:48:23,109
should have abandoned it a little bit earlier.

661
00:48:24,431 --> 00:48:31,359
So the way the kill zone works, or the fortification zone works, is that normally it doesn't really do

662
00:48:31,379 --> 00:48:37,987
much for the AI, but if the AI's target moves into the kill zone, then the fortification zone

663
00:48:38,047 --> 00:48:43,553
becomes active. And as soon as that happens, the AI will move into the area to fight from

664
00:48:43,974 --> 00:48:45,355
and attack the enemy from there.

665
00:48:47,415 --> 00:48:53,637
So the way this all comes together is if we look at this example AI stronghold.

666
00:48:54,297 --> 00:48:59,939
So this is a good stronghold because it is surrounded by a bunch of natural obstacles.

667
00:49:01,140 --> 00:49:07,822
It has this nice little house in the middle that the AI can sleep in and be safe from the elements.

668
00:49:09,142 --> 00:49:12,624
It has two entrances that the AI will have to guard against intrusion.

669
00:49:13,384 --> 00:49:16,945
And of course, since we're a cover fighter, there's plenty of cover around.

670
00:49:19,291 --> 00:49:24,457
First, we place a defense zone, and you can see that the defense zone is covering the

671
00:49:24,477 --> 00:49:27,900
entire stronghold, and that it is an irregular shape.

672
00:49:28,901 --> 00:49:34,547
Also, the defense zone extends outside the entrances for a bit, and this is to allow

673
00:49:34,647 --> 00:49:38,652
us to be able to gauge someone who's just hiding around the corner.

674
00:49:40,454 --> 00:49:41,575
We also add a home area.

675
00:49:42,737 --> 00:49:43,838
And we put that in the house.

676
00:49:44,278 --> 00:49:49,382
So this is what the AI is really concerned about.

677
00:49:49,422 --> 00:49:50,703
And this is where they feel safe.

678
00:49:52,104 --> 00:49:54,466
And finally, we identify a couple

679
00:49:54,666 --> 00:49:58,469
of good defensive opportunities and add some fortification

680
00:49:58,489 --> 00:49:58,990
zones there.

681
00:50:00,511 --> 00:50:05,334
So if an AI or an enemy were to attack from the south,

682
00:50:06,055 --> 00:50:08,417
well, first, they would go into the kill zone

683
00:50:08,437 --> 00:50:11,019
of this fortification zone, which would activate

684
00:50:11,099 --> 00:50:12,199
this fortification zone.

685
00:50:13,167 --> 00:50:15,488
Now most fortification zones have a limit

686
00:50:15,849 --> 00:50:20,051
to how many AIs can be and fight in that fortification zone.

687
00:50:20,391 --> 00:50:23,352
And this is generally just based on the size of the area

688
00:50:23,372 --> 00:50:23,952
to fight from.

689
00:50:25,273 --> 00:50:27,894
So any AI that's assigned to a fortification zone

690
00:50:28,395 --> 00:50:30,936
that the fortification zone can accommodate

691
00:50:31,296 --> 00:50:32,837
will immediately move to the area

692
00:50:32,857 --> 00:50:35,418
to fight from when the enemy comes in here.

693
00:50:36,258 --> 00:50:40,781
Remaining AIs will be fighting as a squad using cover

694
00:50:40,901 --> 00:50:42,502
and the front line just like normal.

695
00:50:44,264 --> 00:50:49,127
If the enemy manages to push through the kill zone,

696
00:50:49,647 --> 00:50:52,129
well then the AI is assigned to the kill zone

697
00:50:52,589 --> 00:50:53,650
or the fortification zone,

698
00:50:54,191 --> 00:50:56,472
will leave that fortification zone

699
00:50:56,512 --> 00:50:57,973
because it's no longer valid

700
00:50:58,494 --> 00:51:01,816
and rejoin the rest of the squad and fight like normal.

701
00:51:03,477 --> 00:51:05,198
As the enemy pushes further in,

702
00:51:05,851 --> 00:51:08,713
the squirrel will be retreating towards the home area.

703
00:51:09,394 --> 00:51:13,016
And if the enemy pushes the squirrel all the way back,

704
00:51:13,537 --> 00:51:15,598
the squirrel will get into that house

705
00:51:15,818 --> 00:51:17,159
and make a last stand there.

706
00:51:19,561 --> 00:51:22,904
Now, this solution worked really well for us.

707
00:51:23,364 --> 00:51:26,586
But it's worth noting that the front line is inherently

708
00:51:26,626 --> 00:51:27,307
two-dimensional.

709
00:51:28,412 --> 00:51:33,156
It works on a slope, so you can pitch it and rotate it,

710
00:51:33,457 --> 00:51:35,418
but you can't twist it or turn it.

711
00:51:36,059 --> 00:51:38,501
So a worst-case scenario would be

712
00:51:38,621 --> 00:51:40,482
fighting on a spiral staircase.

713
00:51:41,243 --> 00:51:44,305
Fortunately for us, there are very few of those in our game.

714
00:51:46,148 --> 00:51:49,410
We also have special behaviors for fighting in and around buildings.

715
00:51:49,970 --> 00:51:54,272
And the reason for that is the front line does quite a good job

716
00:51:54,712 --> 00:51:58,994
to describe what's important in a constrained space

717
00:51:59,374 --> 00:52:00,455
and where you want to be.

718
00:52:00,915 --> 00:52:02,976
In those scenarios, it's much more important

719
00:52:03,016 --> 00:52:05,577
to look at openings between the different rooms,

720
00:52:05,957 --> 00:52:07,998
but it's windows and doors.

721
00:52:09,248 --> 00:52:13,491
And for that, we have special behaviors for fighting from room to room,

722
00:52:14,111 --> 00:52:18,174
from inside a building against enemies that are outside,

723
00:52:18,714 --> 00:52:23,238
and also if we're outside a building and try to fight away inside a building.

724
00:52:24,959 --> 00:52:31,864
The frontline is also not really good at fighting animals and

725
00:52:32,124 --> 00:52:35,946
freakers. It's primarily there for our human opponents that are

726
00:52:36,927 --> 00:52:37,647
ranged opponents.

727
00:52:38,579 --> 00:52:42,344
But even when fighting the wildlife and the freakers,

728
00:52:42,704 --> 00:52:45,107
the front line gives us a good start

729
00:52:45,467 --> 00:52:48,070
to organize and position our squad,

730
00:52:48,471 --> 00:52:51,535
even if other high-priority behaviors will take over

731
00:52:51,955 --> 00:52:55,019
when those enemies close in to the distance.

732
00:52:56,686 --> 00:53:02,487
Finally, it's kind of interesting to note that the player sort of intuitively respects the front line.

733
00:53:03,147 --> 00:53:08,189
The player may not know exactly where the neutral area is or what the width of the front line is,

734
00:53:08,709 --> 00:53:13,330
but when the AI is well lined up along the front line,

735
00:53:13,750 --> 00:53:19,411
it becomes obvious to the player that this is the area where the AI is in control

736
00:53:19,951 --> 00:53:25,753
and this is over here where I am, so I shouldn't get too close if I'm in range combat.

737
00:53:26,413 --> 00:53:35,055
and they kind of fight like our AIs in many ways. And this is all I have on this topic.

738
00:53:35,555 --> 00:53:40,996
I would like to thank the rest of the Dayskarns AI team who contribute a lot of the behavior

739
00:53:42,056 --> 00:53:48,938
for our AI, as well as to the people at Benstudio who helped me prepare this presentation.

740
00:53:50,577 --> 00:53:53,699
Speaking of Ben Studio, Ben is a great place to live,

741
00:53:53,719 --> 00:53:57,122
and Ben Studio is a great place to work.

742
00:53:57,762 --> 00:54:00,424
We're always looking for new talent,

743
00:54:00,764 --> 00:54:04,087
and you should check us out at our homepage

744
00:54:04,567 --> 00:54:07,369
to see if there's something there for you.

745
00:54:08,610 --> 00:54:11,412
So I will be in the live Q&A session

746
00:54:11,712 --> 00:54:13,593
after this talk finished streaming.

747
00:54:14,254 --> 00:54:17,076
Thank you all for watching, and have a great rest of your GDC.

