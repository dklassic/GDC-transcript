1
00:00:15,020 --> 00:00:18,842
Good morning, and welcome to Blending Autonomy and Control,

2
00:00:18,842 --> 00:00:24,225
Creating NPCs for Tom Clancy's The Division.

3
00:00:24,225 --> 00:00:26,667
My name is Drew Reckner, and I'm a game designer

4
00:00:26,667 --> 00:00:29,288
at Massive Entertainment, which is a Ubisoft studio.

5
00:00:29,288 --> 00:00:31,810
And I designed and implemented the behaviors

6
00:00:31,810 --> 00:00:35,572
for most of the combat NPCs in The Division.

7
00:00:35,572 --> 00:00:38,213
I'm here with Phil Dunstan, senior AI programmer,

8
00:00:38,213 --> 00:00:39,474
and we'll be sharing this talk.

9
00:00:41,791 --> 00:00:44,233
In the first half, I'm going to be discussing

10
00:00:44,233 --> 00:00:46,514
some of the high-level behavioral intentions

11
00:00:46,514 --> 00:00:49,016
for our NPCs and kind of the design philosophy behind them.

12
00:00:49,016 --> 00:00:51,038
And then in the second half, Philip's

13
00:00:51,038 --> 00:00:54,080
going to talk about more of the low-level behavioral systems

14
00:00:54,080 --> 00:00:55,841
and the scripted control that we gave to level design.

15
00:00:55,841 --> 00:01:03,687
So we're going to start with just a brief overview

16
00:01:03,687 --> 00:01:05,988
of the division, and then we're going

17
00:01:05,988 --> 00:01:07,870
to also give a brief overview of the combat

18
00:01:07,870 --> 00:01:08,910
NPCs in the division.

19
00:01:09,931 --> 00:01:12,173
Then we're going to move on to the design philosophy,

20
00:01:12,173 --> 00:01:14,355
kind of what drove our decisions behind making the NPCs.

21
00:01:14,355 --> 00:01:18,759
And then we'll briefly explore the different archetypes

22
00:01:18,759 --> 00:01:19,460
and factions.

23
00:01:19,460 --> 00:01:22,583
Then we're going to move on to what

24
00:01:22,583 --> 00:01:24,724
I think is a pretty important topic, which is challenge

25
00:01:24,724 --> 00:01:28,948
scaling, before finally concluding

26
00:01:28,948 --> 00:01:31,090
the first half with the structure of the behavior tree.

27
00:01:36,816 --> 00:01:45,002
For those of you who aren't already aware, Tom Clancy's The Division is an online and multiplayer open world shooter RPG.

28
00:01:45,002 --> 00:01:47,444
We just released on March 8th.

29
00:01:47,444 --> 00:01:55,030
Since we're specifically going to be looking at NPCs though, here's a brief video of the different factions in our game.

30
00:02:08,825 --> 00:02:15,068
There should be some audio.

31
00:02:15,068 --> 00:02:15,448
Yeah.

32
00:02:15,448 --> 00:02:19,790
There was an audio cable up here, too.

33
00:02:19,790 --> 00:02:22,391
It's plugged in.

34
00:02:22,391 --> 00:02:24,092
OK.

35
00:02:24,092 --> 00:02:24,592
Yep.

36
00:02:24,592 --> 00:02:25,873
Good to go?

37
00:02:25,873 --> 00:02:26,153
Yep.

38
00:02:26,153 --> 00:02:26,953
All right.

39
00:02:26,953 --> 00:02:29,334
Sorry about that.

40
00:02:29,334 --> 00:02:32,035
We'll continue.

41
00:02:32,035 --> 00:02:34,056
It's a bit loud.

42
00:02:34,056 --> 00:02:35,077
Good.

43
00:02:35,077 --> 00:02:36,017
Yep.

44
00:02:36,017 --> 00:02:38,258
You guys are good to go?

45
00:02:38,258 --> 00:02:38,398
OK.

46
00:02:39,034 --> 00:02:39,194
Great.

47
00:02:39,194 --> 00:02:43,678
So, here's the video of the factions.

48
00:02:43,678 --> 00:02:44,059
Take two.

49
00:02:44,059 --> 00:02:45,700
When our city started to collapse,

50
00:02:45,700 --> 00:02:48,603
the dark side of humanity took control of the streets.

51
00:02:48,603 --> 00:02:50,525
No, no, no!

52
00:02:50,525 --> 00:02:50,765
No!

53
00:02:50,765 --> 00:02:50,825
No!

54
00:02:50,825 --> 00:02:51,065
No!

55
00:02:51,065 --> 00:02:51,306
No!

56
00:02:51,306 --> 00:02:51,626
No!

57
00:02:51,626 --> 00:02:52,226
No!

58
00:02:52,226 --> 00:02:52,887
No!

59
00:02:52,887 --> 00:02:53,107
No!

60
00:02:53,107 --> 00:03:03,717
This city fell apart.

61
00:03:04,710 --> 00:03:10,536
It's crazy out here every man for himself

62
00:03:10,536 --> 00:03:13,278
Survival of the fittest

63
00:03:13,278 --> 00:03:17,962
You got to take what you need in this world

64
00:03:17,962 --> 00:03:24,949
This world is our playground now and no one's here to stop us

65
00:03:24,949 --> 00:03:26,950
We got out of Rikers jail

66
00:03:26,950 --> 00:03:30,373
And we ain't ever going back in that cage

67
00:03:32,462 --> 00:03:34,603
It's all ours now.

68
00:03:34,603 --> 00:03:42,847
We're the new kings of these streets.

69
00:03:42,847 --> 00:03:45,388
These streets must be cleansed.

70
00:03:45,388 --> 00:03:49,530
To save our city, we must burn away this disease.

71
00:03:49,530 --> 00:03:50,411
Every trace of it.

72
00:03:50,411 --> 00:03:55,153
Only through the power of fire can we be free.

73
00:03:55,153 --> 00:03:59,395
Freedom is not a right.

74
00:03:59,395 --> 00:04:01,856
Liberty is not a given.

75
00:04:02,932 --> 00:04:08,537
This city needs an iron fist to restore order.

76
00:04:08,537 --> 00:04:11,379
There shall be no resistance.

77
00:04:11,379 --> 00:04:13,901
It is the only solution.

78
00:04:13,901 --> 00:04:19,085
This is not our solution.

79
00:04:19,085 --> 00:04:24,870
Our mission is to save what remains.

80
00:04:24,870 --> 00:04:28,233
To save what's left of our city.

81
00:04:40,077 --> 00:04:51,862
We are The Division.

82
00:05:05,391 --> 00:05:08,892
And we do have one friendly combat faction.

83
00:05:08,892 --> 00:05:11,353
We'll briefly mention it, but we won't really talk about it much today.

84
00:05:11,353 --> 00:05:18,635
Our NPCs feature a suite of different features, such as a detection system, a threat system,

85
00:05:18,635 --> 00:05:22,276
scripted controls that level design can use to control our NPCs,

86
00:05:22,276 --> 00:05:25,536
reaction to the player's vast array of abilities,

87
00:05:25,536 --> 00:05:31,478
dynamic objective handling, reactions to civilians and wildlife, and various idle activities,

88
00:05:31,478 --> 00:05:34,819
the majority of which Philip will talk about in more detail in the second half.

89
00:05:36,657 --> 00:05:41,100
Our NPCs were both used in what we call the open world, which

90
00:05:41,100 --> 00:05:44,742
is a less scripted, more systemic gameplay space,

91
00:05:44,742 --> 00:05:47,904
and a more highly scripted story missions, which

92
00:05:47,904 --> 00:05:50,946
are a bit more like your typical third person shooter missions.

93
00:05:50,946 --> 00:05:57,590
As I alluded to earlier, we used a behavior tree architecture

94
00:05:57,590 --> 00:06:01,312
in our Snowdrop engine, which is a brand new proprietary engine

95
00:06:01,312 --> 00:06:02,273
developed by Massive.

96
00:06:04,530 --> 00:06:06,051
One other thing before moving on,

97
00:06:06,051 --> 00:06:08,652
I think it's just important to note that our AI was completely

98
00:06:08,652 --> 00:06:08,912
server side.

99
00:06:08,912 --> 00:06:10,813
Next we'll look at the four design pillars

100
00:06:10,813 --> 00:06:12,594
that we had for creating our combat NPCs.

101
00:06:12,594 --> 00:06:16,676
The first pillar is that our NPCs

102
00:06:16,676 --> 00:06:18,617
had to support the idea that our game was

103
00:06:18,617 --> 00:06:20,017
both an RPG and a shooter.

104
00:06:32,747 --> 00:06:37,748
So this meant that we needed to allow the player to play in different ways and use different

105
00:06:37,748 --> 00:06:38,088
roles.

106
00:06:38,088 --> 00:06:41,870
So think like disruptor, tank, sniper, medic, and others.

107
00:06:41,870 --> 00:06:48,632
This was especially important because we were a co-op game and we wanted players to combine

108
00:06:48,632 --> 00:06:50,533
their skills to synergize with one another.

109
00:06:50,533 --> 00:06:54,854
And that also meant that they needed a reason to do so.

110
00:06:54,854 --> 00:07:00,957
On top of that, we incorporated typical RPG systems like aggro and crowd control that

111
00:07:00,957 --> 00:07:02,317
aren't always seen in shooters.

112
00:07:04,381 --> 00:07:07,902
Another thing we wanted to do is we wanted to incentivize the pre-combat setup,

113
00:07:07,902 --> 00:07:12,884
something that we coined as the investigation phase internally,

114
00:07:12,884 --> 00:07:17,806
which basically gave the player the opportunity to scope out and plan

115
00:07:17,806 --> 00:07:20,227
for a tactical attack.

116
00:07:20,227 --> 00:07:23,668
And finally, of course, because we were an RPG and a shooter,

117
00:07:23,668 --> 00:07:27,749
we wanted to reward the twitch gameplay of a shooter, so that was the basic

118
00:07:27,749 --> 00:07:30,730
timing and positioning and dexterity challenges that provides.

119
00:07:34,047 --> 00:07:39,531
The next pillar was that it was important that our NPCs fit into a realistic setting.

120
00:07:39,531 --> 00:07:46,576
The Tom Clancy IP is of course known for its realism and its highly detailed universe,

121
00:07:46,576 --> 00:07:52,039
so our NPCs needed to have some kind of realism to them, so they were constrained by that

122
00:07:52,039 --> 00:07:52,840
to some extent.

123
00:07:52,840 --> 00:07:59,824
So that meant we couldn't rely on magic and sci-fi even though we were an RPG.

124
00:08:00,867 --> 00:08:04,150
At first, this kind of seemed like a bit of a limitation,

125
00:08:04,150 --> 00:08:05,071
and it was a challenge.

126
00:08:05,071 --> 00:08:07,393
But later, we found that the constraints

127
00:08:07,393 --> 00:08:09,295
and the guidelines that provided actually

128
00:08:09,295 --> 00:08:13,619
empowered us way more than if we had kind of a blank slate

129
00:08:13,619 --> 00:08:14,119
to work with.

130
00:08:17,365 --> 00:08:23,350
The player could go basically anywhere in the world in our game since we were open world.

131
00:08:23,350 --> 00:08:26,432
So we had a near one-to-one recreation of Midtown Manhattan.

132
00:08:26,432 --> 00:08:31,776
So that also meant that we needed to develop ways of encouraging the player to come back

133
00:08:31,776 --> 00:08:36,539
to locations when they've powered or leveled up, although we mostly solved that through

134
00:08:36,539 --> 00:08:37,440
enemy level scaling.

135
00:08:37,440 --> 00:08:42,824
Most importantly though, even though we were in this realistic setting...

136
00:08:44,077 --> 00:08:46,902
fun was still the most important thing for NPCs.

137
00:08:46,902 --> 00:08:53,072
Our NPCs were mainly there to drive fun for the player.

138
00:08:54,736 --> 00:09:00,279
even though that some of their behaviors were a bit gamey,

139
00:09:00,279 --> 00:09:02,900
we decided that that was best for the game overall.

140
00:09:02,900 --> 00:09:05,882
We felt like we could push the boundary

141
00:09:05,882 --> 00:09:07,603
a little bit on that.

142
00:09:07,603 --> 00:09:10,504
And personally, I mean, that's a bit hard, right?

143
00:09:10,504 --> 00:09:12,845
Working in AI, because sometimes we get our egos

144
00:09:12,845 --> 00:09:15,086
a little bit involved, especially me,

145
00:09:15,086 --> 00:09:18,048
and you have to remember why you're making the game

146
00:09:18,048 --> 00:09:18,788
in the first place.

147
00:09:22,259 --> 00:09:24,701
Our third design pillar was to create strong archetypes.

148
00:09:24,701 --> 00:09:28,544
So this meant creating NPCs that fulfilled various roles

149
00:09:28,544 --> 00:09:30,906
that challenged the player in different ways.

150
00:09:30,906 --> 00:09:34,629
This meant encouraging the player to use different tactics

151
00:09:34,629 --> 00:09:37,731
based on the enemy compositions.

152
00:09:37,731 --> 00:09:40,833
Now we created, excuse me.

153
00:09:41,875 --> 00:09:48,602
We created NPCs that used different strategies and skills

154
00:09:48,602 --> 00:09:50,563
and would synergize with one another.

155
00:09:50,563 --> 00:09:53,746
And that was kind of a core part of creating combat

156
00:09:53,746 --> 00:09:55,007
was to create something we called

157
00:09:55,007 --> 00:09:56,209
combat puzzles for the player.

158
00:09:56,209 --> 00:09:58,250
And that was where we used two NPCs

159
00:09:58,250 --> 00:10:00,533
that worked really well together.

160
00:10:00,533 --> 00:10:03,135
Now, this of course meant that we had to create

161
00:10:03,135 --> 00:10:05,197
really clear signs and feedback to the player.

162
00:10:06,405 --> 00:10:13,469
And we did that through the UI color, the icons in the UI, the appearance of the enemies,

163
00:10:13,469 --> 00:10:17,891
and of course their out-of-combat and in-combat behaviors.

164
00:10:17,891 --> 00:10:24,635
The final and most important pillar, though, is one of continual challenge.

165
00:10:24,635 --> 00:10:30,919
So our NPCs needed to provide new concepts and gameplay to the player over time because

166
00:10:30,919 --> 00:10:33,460
combat was such an important part of the division.

167
00:10:35,550 --> 00:10:38,672
So we kind of introduced a basic rollout of our NPCs

168
00:10:38,672 --> 00:10:40,694
and the different skills.

169
00:10:40,694 --> 00:10:42,475
But that also meant kind of introducing

170
00:10:42,475 --> 00:10:44,236
the loop of introducing something new,

171
00:10:44,236 --> 00:10:47,298
having the player practice it, then master it,

172
00:10:47,298 --> 00:10:50,059
and then introduce new and more evolved concepts.

173
00:10:50,059 --> 00:10:56,903
Additionally, we did provide multiple difficulty levels

174
00:10:56,903 --> 00:10:59,185
for missions.

175
00:10:59,185 --> 00:11:01,186
Don't necessarily need to talk about that, though,

176
00:11:01,186 --> 00:11:02,967
for the case of this talk, though.

177
00:11:05,261 --> 00:11:12,983
So creating a continual challenge did pose some problems to us though in development

178
00:11:12,983 --> 00:11:19,926
because it meant that we needed to create a ton of different NPCs.

179
00:11:19,926 --> 00:11:21,706
So I'll discuss how we attempted to solve this problem a bit later in the talk.

180
00:11:21,706 --> 00:11:27,948
Now that we've covered the overall design philosophy, let's take a quick look at the

181
00:11:27,948 --> 00:11:30,769
different archetypes featured in the division.

182
00:11:30,769 --> 00:11:32,850
Before we do that though...

183
00:11:33,651 --> 00:11:37,692
I think it's important to note the real reason why we created archetypes, the real reason

184
00:11:37,692 --> 00:11:42,194
we thought it was important was because each archetype poses a different challenge.

185
00:11:42,194 --> 00:11:44,655
And we broke this down into six separate archetype challenges.

186
00:11:44,655 --> 00:11:47,596
The first of which is what we call target prioritization.

187
00:11:47,596 --> 00:11:52,857
And it forces the player to deal with an immediate threat or face the consequences.

188
00:11:52,857 --> 00:11:57,419
The next challenge that we identified was a repositioning challenge.

189
00:11:57,419 --> 00:12:02,941
It forced the player, usually out of cover, to a new position to avoid a dangerous threat.

190
00:12:04,802 --> 00:12:07,064
Next was the minimize exposure challenge.

191
00:12:07,064 --> 00:12:09,825
And this meant that the player had

192
00:12:09,825 --> 00:12:12,507
to minimize the time that they were popped out aiming

193
00:12:12,507 --> 00:12:14,268
or in between covers.

194
00:12:14,268 --> 00:12:18,451
The target ordering challenge challenged the player

195
00:12:18,451 --> 00:12:20,853
to figure out an optimal path for defeating the enemies.

196
00:12:20,853 --> 00:12:24,995
Next was the positioning challenge,

197
00:12:24,995 --> 00:12:26,616
which encouraged the player to move

198
00:12:26,616 --> 00:12:28,538
to an advantageous position.

199
00:12:28,538 --> 00:12:30,959
Now, this is really different than the repositioning

200
00:12:30,959 --> 00:12:33,521
challenge in that it's a very proactive action instead

201
00:12:33,521 --> 00:12:34,562
of a reactive one.

202
00:12:36,093 --> 00:12:41,195
And finally, the endurance challenge was one where the player had to spend a lot of time

203
00:12:41,195 --> 00:12:42,935
in order to defeat an enemy.

204
00:12:42,935 --> 00:12:51,278
This is a table that we gave to our level design team to create interesting challenges.

205
00:12:51,278 --> 00:12:57,001
So this table is really meant to kind of show which archetypes fit really well together

206
00:12:57,001 --> 00:13:01,082
and their skills synergized using the challenges that we showed in the last screen.

207
00:13:05,580 --> 00:13:07,661
Before we move on though, just a quick warning

208
00:13:07,661 --> 00:13:10,343
that the videos shown in this presentation

209
00:13:10,343 --> 00:13:13,066
from this point on feature test maps

210
00:13:13,066 --> 00:13:15,948
with incomplete lighting and propping.

211
00:13:15,948 --> 00:13:18,710
So you guys probably are all aware of this.

212
00:13:18,710 --> 00:13:20,932
Just something to point out.

213
00:13:20,932 --> 00:13:23,534
So down to the archetypes.

214
00:13:23,534 --> 00:13:26,496
The first archetype that we had is what we called Assault.

215
00:13:26,496 --> 00:13:28,618
And that's kind of your basic cover using grunt.

216
00:13:28,618 --> 00:13:31,620
It's your basic third person shooter challenge.

217
00:13:32,893 --> 00:13:37,054
but they're really there to kind of balance out the fire team

218
00:13:37,054 --> 00:13:37,194
and

219
00:13:37,194 --> 00:13:42,215
and yeah they they were a grunt role within the fire team

220
00:13:42,215 --> 00:13:43,596
is what we called them

221
00:13:43,596 --> 00:13:49,377
next is the rusher archetype which runs directly at the player and forces them

222
00:13:49,377 --> 00:13:52,678
to prioritize them or face the consequences they got more dangerous as

223
00:13:52,678 --> 00:13:54,479
the player got closer

224
00:13:54,479 --> 00:13:58,160
so it was really important for the player to take them out as quickly as

225
00:13:58,160 --> 00:13:59,460
possible

226
00:13:59,460 --> 00:14:00,400
sniper archetype

227
00:14:01,493 --> 00:14:05,556
Pretty typical sniper, long range, high damage, single shot, very accurate.

228
00:14:05,556 --> 00:14:09,800
They force the player to minimize their exposure, so not stay up too long,

229
00:14:09,800 --> 00:14:11,001
not go in between covers too often.

230
00:14:11,001 --> 00:14:15,965
The thrower archetype throws a grenade or other dangerous objects to force the

231
00:14:15,965 --> 00:14:17,807
player usually out of cover.

232
00:14:17,807 --> 00:14:19,608
So this is a repositioning challenge.

233
00:14:21,922 --> 00:14:24,866
Next are the controller and turret archetypes.

234
00:14:24,866 --> 00:14:27,689
The controller sets up and fights through a proxy,

235
00:14:27,689 --> 00:14:31,213
generally a turret, and repairs it if it ever gets damaged.

236
00:14:31,213 --> 00:14:34,056
Now the turret automatically fires at the player,

237
00:14:34,056 --> 00:14:36,739
usually with a high rate of fire, suppressing them.

238
00:14:37,946 --> 00:14:42,048
But what this did was this introduced an interesting target ordering challenge

239
00:14:42,048 --> 00:14:47,271
because the player could make a decision if they wanted to try to take out the controller

240
00:14:47,271 --> 00:14:52,675
before the turret was set up, or they could damage the turret and lure the controller

241
00:14:52,675 --> 00:14:56,417
out, or they could damage, or kill, I'm sorry, the controller while the turret was up and

242
00:14:56,417 --> 00:14:57,878
have the turret malfunction on its own.

243
00:15:01,618 --> 00:15:06,181
Next is a heavy weapons archetype, suppresses the player with a high rate of fire,

244
00:15:06,181 --> 00:15:09,723
force the player to minimize their exposure.

245
00:15:09,723 --> 00:15:15,465
But what's different with this and the sniper though is they typically had kind of a long reload time

246
00:15:15,465 --> 00:15:20,308
and allowed the player to come up and kind of exploit them.

247
00:15:20,308 --> 00:15:23,650
The next archetype is the tank archetype, which are heavy NPCs

248
00:15:23,650 --> 00:15:27,431
who take a lot of damage to kill, but they also generally deal a lot of damage as well.

249
00:15:29,076 --> 00:15:31,237
They have weak points on them,

250
00:15:31,237 --> 00:15:34,199
and this allows the player to position themselves

251
00:15:34,199 --> 00:15:36,760
in a way that they can hit the weak points,

252
00:15:36,760 --> 00:15:39,581
and some require flanking.

253
00:15:39,581 --> 00:15:42,703
And they always end up either damaging the NPC by a lot

254
00:15:42,703 --> 00:15:44,143
or crowd controlling them.

255
00:15:44,143 --> 00:15:48,546
Leader archetypes affect the behaviors of other NPCs,

256
00:15:48,546 --> 00:15:49,906
generally making them more aggressive,

257
00:15:49,906 --> 00:15:51,487
so it's advantageous for the player

258
00:15:51,487 --> 00:15:53,168
to usually take them out as quickly as possible.

259
00:15:55,801 --> 00:15:57,942
Next is the support archetype.

260
00:15:57,942 --> 00:16:00,104
Assist teammates by healing them.

261
00:16:00,104 --> 00:16:02,806
Generally, think of a medic or something like that.

262
00:16:02,806 --> 00:16:04,387
Again, it's a target ordering challenge,

263
00:16:04,387 --> 00:16:06,869
but medics are also really defensive.

264
00:16:06,869 --> 00:16:08,410
So the player also has to kind of position themself

265
00:16:08,410 --> 00:16:09,130
if they want to take them out

266
00:16:09,130 --> 00:16:09,751
or lure them into a wounded ally.

267
00:16:09,751 --> 00:16:11,812
And finally, we have what we called special.

268
00:16:11,812 --> 00:16:12,913
And that is basically all NPCs

269
00:16:12,913 --> 00:16:13,834
that didn't fit into any of the categories.

270
00:16:25,993 --> 00:16:30,615
Now, this meant that NPCs in this category

271
00:16:30,615 --> 00:16:33,597
were a bit harder to find, and thus,

272
00:16:33,597 --> 00:16:36,038
the player didn't have a lot of education,

273
00:16:36,038 --> 00:16:37,658
necessarily, on the specific mechanics.

274
00:16:37,658 --> 00:16:41,300
So we primarily saved these for endgame,

275
00:16:41,300 --> 00:16:47,982
to keep it interesting for the player.

276
00:16:47,982 --> 00:16:50,944
Now we're gonna take a look at our five enemy factions,

277
00:16:50,944 --> 00:16:53,685
as well as our friendly combat faction.

278
00:16:55,167 --> 00:16:59,211
Now these are introduced in the order of which they're introduced to the player.

279
00:16:59,211 --> 00:17:02,714
So the first faction the player will encounter are the rioters.

280
00:17:02,714 --> 00:17:07,397
They present a really introductory challenge to the player.

281
00:17:07,397 --> 00:17:08,218
They're our starter NPCs.

282
00:17:08,218 --> 00:17:13,483
So they're really there to kind of teach the player the mechanics of the game and really

283
00:17:13,483 --> 00:17:16,945
introduce them to the various archetypes that we have in the games.

284
00:17:16,945 --> 00:17:20,348
So snipers, throwers, with very little distraction.

285
00:17:20,348 --> 00:17:24,191
They're disorganized, they're unskilled, they're low-tech.

286
00:17:26,798 --> 00:17:28,941
The next faction the player will encounter are the cleaners.

287
00:17:28,941 --> 00:17:33,205
Now the cleaners present a slightly more advanced challenge to the player.

288
00:17:33,205 --> 00:17:37,389
And most notably they introduce a few new archetypes to the player for the

289
00:17:37,389 --> 00:17:38,510
first time.

290
00:17:38,510 --> 00:17:41,393
And that's the controller and thus turret archetypes.

291
00:17:41,393 --> 00:17:43,575
And then of course the tank archetype.

292
00:17:43,575 --> 00:17:46,998
They're a bit more organized

293
00:17:46,998 --> 00:17:49,561
and they're a bit more deadly than the rioters.

294
00:17:51,352 --> 00:17:54,652
The third faction the player will encounter are the Rikers,

295
00:17:54,652 --> 00:17:59,213
and the Rikers present a slightly more advanced challenge than even the Cleaners,

296
00:17:59,213 --> 00:18:02,354
and they're a bit more coordinated, so this is the first time the player will

297
00:18:02,354 --> 00:18:04,575
kind of see coordination in combat.

298
00:18:04,575 --> 00:18:07,715
The fourth faction is the Last Man Battalion,

299
00:18:07,715 --> 00:18:12,536
and the Last Man Battalion is a kind of militaristic faction,

300
00:18:12,536 --> 00:18:16,357
so it fits kind of the Clancy IP really well,

301
00:18:16,357 --> 00:18:19,238
and it provides advanced challenges to the player.

302
00:18:20,444 --> 00:18:25,449
They're organized, they're tactical, and we'll talk about some of the things that they do in just a bit.

303
00:18:25,449 --> 00:18:30,053
And the last enemy faction that the player will encounter is the Tier 2 of the Last Man Battalion.

304
00:18:30,053 --> 00:18:41,143
Now, narratively, they're the same as the Last Man Battalion, but they actually are, gameplay-wise, a pretty separate faction.

305
00:18:41,143 --> 00:18:46,568
They're intended primarily for endgame because they present such an advanced challenge to the player.

306
00:18:47,900 --> 00:18:50,381
We also blend our archetypes a little bit at this point.

307
00:18:50,381 --> 00:18:53,021
So we kind of blend what a controller is

308
00:18:53,021 --> 00:18:54,822
with a support, for example.

309
00:18:54,822 --> 00:18:57,063
So we kind of change things up a little bit for the player.

310
00:18:57,063 --> 00:18:59,103
They're very organized.

311
00:18:59,103 --> 00:19:01,164
They use a lot of group tactics.

312
00:19:01,164 --> 00:19:04,065
So they're really intended to be a difficult fight.

313
00:19:04,065 --> 00:19:05,486
And last but not least is our sole friendly faction,

314
00:19:05,486 --> 00:19:09,467
combat faction, I should say,

315
00:19:09,467 --> 00:19:13,948
which is the Joint Task Force, or the JTF.

316
00:19:15,159 --> 00:19:19,280
They have pretty basic combat behaviors, only a single

317
00:19:19,280 --> 00:19:20,140
archetype.

318
00:19:20,140 --> 00:19:22,101
And really, their main purpose was

319
00:19:22,101 --> 00:19:24,981
to be a cheerleader in the game for the player.

320
00:19:24,981 --> 00:19:27,962
So they would just cheer the player on in and out of combat.

321
00:19:27,962 --> 00:19:31,203
So now that we've talked about the different archetypes

322
00:19:31,203 --> 00:19:35,684
and factions in the game, I want to talk about the NPC challenge

323
00:19:35,684 --> 00:19:38,664
tiers, which was pretty important to our game.

324
00:19:38,664 --> 00:19:42,505
It'll combine kind of these two components.

325
00:19:45,483 --> 00:19:51,107
So to provide a continuing, continually involving challenge for the players,

326
00:19:51,107 --> 00:19:55,749
we took each of the five factions and we split them up into tiers,

327
00:19:55,749 --> 00:19:59,031
starting with the rioters and ending with the last man battalion.

328
00:19:59,031 --> 00:20:04,034
Now we had a bunch of different aspects that I listed there

329
00:20:04,034 --> 00:20:07,856
that we improved as we increased the faction tier.

330
00:20:07,856 --> 00:20:09,336
So we did this really for two reasons.

331
00:20:10,428 --> 00:20:16,930
Like one, we wanted to provide a continuing evolving challenge for the player, which is one of the pillars I mentioned, if you remember.

332
00:20:16,930 --> 00:20:21,871
But possibly the more important reason to that as well, or equally as important,

333
00:20:21,871 --> 00:20:27,832
is that we needed a quick and relatively easy way to create a lot of NPCs.

334
00:20:27,832 --> 00:20:34,414
So we kind of picked components that we thought we could tweak that would be interesting in order to provide the greatest variety possible.

335
00:20:37,563 --> 00:20:40,305
So we're going to briefly look at each of these elements and how they're scaled.

336
00:20:40,305 --> 00:20:44,369
And we're going to start with reaction to player skills and actions.

337
00:20:44,369 --> 00:20:48,733
So to efficiently scale

338
00:20:48,733 --> 00:20:53,597
the way that NPCs reacted to the player's vast array of abilities,

339
00:20:53,597 --> 00:20:54,778
we created what we called

340
00:20:54,778 --> 00:20:58,041
profiles, or reaction profiles.

341
00:20:59,163 --> 00:21:06,807
Now, these profiles changed depending on the faction and the role of the NPC, which I'll

342
00:21:06,807 --> 00:21:07,728
talk about in just a second.

343
00:21:07,728 --> 00:21:10,909
So first is the dumb profile, and this is used exclusively by the rioters, and it allows

344
00:21:10,909 --> 00:21:18,093
the player to be a lot less careful with their abilities and how they use them, so the player

345
00:21:18,093 --> 00:21:22,456
doesn't have to use a lot of consideration.

346
00:21:22,456 --> 00:21:25,217
They get a lot of, you know, kind of bang for their buck with their skills.

347
00:21:25,217 --> 00:21:27,318
Also, as an example...

348
00:21:28,820 --> 00:21:36,062
If the player uses a seeker mine on an NPC, and a seeker mine is an autonomous ball-shaped

349
00:21:36,062 --> 00:21:42,464
bomb that rolls towards an enemy that explodes in close proximity, a dumb profile NPC will

350
00:21:42,464 --> 00:21:47,905
run away in a panicked way, and they're going to run towards an ally, a very reluctant ally

351
00:21:47,905 --> 00:21:52,787
actually, and hopefully the bomb will explode and kill them or damage them both.

352
00:21:55,255 --> 00:22:00,417
Next is the default profile, which is used by the majority of our NPCs in the game.

353
00:22:00,417 --> 00:22:05,398
It's slightly better than the dumb profile in terms of the reactivity and the way that

354
00:22:05,398 --> 00:22:11,219
the NPC avoids the player's abilities, but it's still not very effective.

355
00:22:11,219 --> 00:22:17,861
So in the example of the Seeker Mine, instead of running towards an ally, the NPC just runs

356
00:22:17,861 --> 00:22:19,422
away from the Seeker Mine in a panicked way.

357
00:22:22,246 --> 00:22:24,367
The next profile is the elite profile.

358
00:22:24,367 --> 00:22:28,988
And the elite profile is only used by the tier two

359
00:22:28,988 --> 00:22:32,349
of the last man battalion and elite role NPCs.

360
00:22:32,349 --> 00:22:35,570
Now this profile actually allows the NPCs

361
00:22:35,570 --> 00:22:37,731
to counter some of the player's skills.

362
00:22:37,731 --> 00:22:40,692
So if we looked at the seeker mine example again,

363
00:22:40,692 --> 00:22:43,453
an NPC targeted by that will roll out of the explosion.

364
00:22:46,387 --> 00:22:47,908
Next is the tech profile.

365
00:22:47,908 --> 00:22:51,370
And the tech profile is only used by,

366
00:22:51,370 --> 00:22:54,913
it's kind of rare, so it's only used by a few NPCs in the game.

367
00:22:54,913 --> 00:22:58,235
But it allows NPCs to counter or even hack

368
00:22:58,235 --> 00:22:59,516
some of the player's skills.

369
00:22:59,516 --> 00:23:01,818
Again, to use the seeker mind as an example,

370
00:23:01,818 --> 00:23:06,221
if the player deploys it towards them, they will hack it,

371
00:23:06,221 --> 00:23:07,783
send it right back to the player,

372
00:23:07,783 --> 00:23:09,684
and the player's own seeker mind will blow up in their face.

373
00:23:12,820 --> 00:23:17,382
And the final two profiles are the heavy and the turret profiles, which are used by the

374
00:23:17,382 --> 00:23:21,583
tank and turret profiles, respectively.

375
00:23:21,583 --> 00:23:26,304
So heavy profile, the NPC doesn't usually react to a lot of things, because they're

376
00:23:26,304 --> 00:23:32,146
kind of big and heavy, but they do have a couple few unique ways that they counter skills

377
00:23:32,146 --> 00:23:32,586
as well.

378
00:23:32,586 --> 00:23:40,388
And finally, to use the seeker mine example, the NPC will actually kick the seeker mine

379
00:23:40,388 --> 00:23:42,288
if it gets close to them, and then have it destroy.

380
00:23:47,977 --> 00:23:51,999
So our next difficulty modifier that we used was movement speed and style.

381
00:23:51,999 --> 00:24:00,502
So we increased the movement speed, basically, of NPCs as we improved the faction tier.

382
00:24:00,502 --> 00:24:05,344
However, we only limit this to the strafe speed of the NPCs and the rush speed of rushers.

383
00:24:05,344 --> 00:24:10,286
Now, we primarily did this for kind of technical and production-related reasons,

384
00:24:10,286 --> 00:24:12,667
but we actually thought it ended up being pretty sufficient.

385
00:24:14,339 --> 00:24:19,043
So some NPCs actually also had some kind of panicked movement

386
00:24:19,043 --> 00:24:21,545
styles, specifically in the lower tiers.

387
00:24:21,545 --> 00:24:23,527
And then as we got up into the higher tiers,

388
00:24:23,527 --> 00:24:25,528
they used more composed movement styles.

389
00:24:27,752 --> 00:24:32,934
Additionally, we had two different overall cover movement styles, so when NPCs were moving to cover.

390
00:24:32,934 --> 00:24:41,158
The first one was what we called mixed movement, where an NPC would sprint to a location, stop, shoot,

391
00:24:41,158 --> 00:24:45,020
and then either run into cover or strafe and shoot into a cover a short distance.

392
00:24:45,020 --> 00:24:53,004
The other option was called full strafe, where the NPC would strafe into a cover while shooting the entire way.

393
00:24:53,004 --> 00:24:57,306
Now, a faction could have one of these two profiles, so we made it pretty easy.

394
00:25:01,343 --> 00:25:04,205
The next modifier we had was the group behavior modifier,

395
00:25:04,205 --> 00:25:06,546
which we have split into two groups, which again,

396
00:25:06,546 --> 00:25:08,326
the faction got one of.

397
00:25:08,326 --> 00:25:11,188
The first was what we called disorganized,

398
00:25:11,188 --> 00:25:14,049
which is where NPCs didn't coordinate their movement,

399
00:25:14,049 --> 00:25:15,689
they didn't communicate to each other,

400
00:25:15,689 --> 00:25:17,330
so they didn't provide cover fire.

401
00:25:17,330 --> 00:25:21,192
And then we had organized.

402
00:25:21,192 --> 00:25:23,533
And organized is where the NPCs did provide

403
00:25:23,533 --> 00:25:25,173
cover fire for each other,

404
00:25:25,173 --> 00:25:26,974
they did coordinate their movement,

405
00:25:26,974 --> 00:25:29,175
and they also actively attempted to swarm

406
00:25:29,175 --> 00:25:30,055
and surround the player.

407
00:25:34,908 --> 00:25:36,449
The next modifier was cover usage.

408
00:25:36,449 --> 00:25:39,871
So we split this into two major groups,

409
00:25:39,871 --> 00:25:43,933
one of which was assigned to each faction.

410
00:25:43,933 --> 00:25:45,694
The first is inconsistent,

411
00:25:45,694 --> 00:25:48,316
where NPCs would occasionally wander out of cover

412
00:25:48,316 --> 00:25:51,358
and start shooting really aggressively at the player.

413
00:25:51,358 --> 00:25:54,640
By contrast, the consistent one

414
00:25:54,640 --> 00:25:58,622
meant that NPCs always stayed in cover,

415
00:25:58,622 --> 00:26:00,843
and if they ever found themselves out of cover

416
00:26:00,843 --> 00:26:01,924
for some reason,

417
00:26:01,924 --> 00:26:03,685
they would attempt to get back in immediately.

418
00:26:08,667 --> 00:26:12,450
Now one of the more important ones was skill usage.

419
00:26:12,450 --> 00:26:18,475
So we scaled skill usage not only in terms of the frequency

420
00:26:18,475 --> 00:26:23,559
in which NPCs use skills, and the speed, and the duration,

421
00:26:23,559 --> 00:26:26,041
and things like that, but we also ended up

422
00:26:26,041 --> 00:26:28,663
swapping out entire skills.

423
00:26:28,663 --> 00:26:31,265
So as an example, let's look at the thrower archetype.

424
00:26:34,820 --> 00:26:40,805
So the thrower archetype starts off in the lowest faction, the rioters, with a tear gas

425
00:26:40,805 --> 00:26:46,009
grenade, which is non-lethal, provides a satisfaction for the player. It's not particularly dangerous,

426
00:26:46,009 --> 00:26:50,633
but if there are other NPCs around, it can be a little bit dangerous for the player,

427
00:26:50,633 --> 00:26:56,218
so they still want to avoid it. Next, as we move up into the cleaners faction, we swap

428
00:26:56,218 --> 00:27:00,581
that out with an incendiary bomb. It's basically the same thing as a tear gas grenade, except

429
00:27:00,581 --> 00:27:02,483
it does have damage over time included.

430
00:27:04,267 --> 00:27:07,130
After that, we improve with the Rikers.

431
00:27:07,130 --> 00:27:10,212
In the Rikers, we swap out the incendiary bomb

432
00:27:10,212 --> 00:27:11,233
with a frag grenade.

433
00:27:11,233 --> 00:27:13,876
And the frag grenade deals quite a lot of damage,

434
00:27:13,876 --> 00:27:15,357
and it has a shorter fuse.

435
00:27:15,357 --> 00:27:18,940
And finally, the last kind of evolution of the thrower

436
00:27:18,940 --> 00:27:20,381
is the Last Man Battalion,

437
00:27:20,381 --> 00:27:23,784
where we actually swap out the frag grenade

438
00:27:23,784 --> 00:27:25,306
with a grenade launcher that shoots

439
00:27:25,306 --> 00:27:28,228
three consecutive grenades that explode on impact.

440
00:27:28,228 --> 00:27:30,671
So hopefully you can kind of see a progression

441
00:27:30,671 --> 00:27:31,812
of challenge there for the player.

442
00:27:36,282 --> 00:27:41,547
And finally, I think it's worth mentioning that we did a little bit of health, kind of

443
00:27:41,547 --> 00:27:47,673
stagger, suppression, resistance, and damage and accuracy improvements with Faction Tier.

444
00:27:47,673 --> 00:27:52,018
We tried to keep this as minimal as possible because we found that all the other things

445
00:27:52,018 --> 00:27:55,901
that we do, like behavior, I'm sorry, players respond to a lot better.

446
00:27:55,901 --> 00:27:59,865
So it's less about numbers and more about behavioral changes.

447
00:28:03,927 --> 00:28:06,548
So I'm going to show a video about,

448
00:28:06,548 --> 00:28:09,290
or that compares the first faction of the game,

449
00:28:09,290 --> 00:28:12,973
the Riders, with the final, the most advanced faction,

450
00:28:12,973 --> 00:28:14,554
the tier two of the Last Man Battalion.

451
00:28:14,554 --> 00:28:18,637
Now, please note the differences in the cover usage,

452
00:28:18,637 --> 00:28:21,539
the skill usage, the tactics, and their skills in combat.

453
00:28:21,539 --> 00:28:23,540
And also just a quick note,

454
00:28:23,540 --> 00:28:26,882
just a reminder that this is a test map.

455
00:28:26,882 --> 00:28:29,424
And I have God Mode in, God Mode on,

456
00:28:29,424 --> 00:28:31,245
so I don't embarrass myself by dying.

457
00:29:17,086 --> 00:29:22,008
Shooter gonna come out

458
00:29:47,513 --> 00:29:52,575
You gotta jump out of there!

459
00:29:52,575 --> 00:29:57,717
There he goes down!

460
00:29:57,717 --> 00:29:58,998
Ratcher!

461
00:30:14,938 --> 00:30:17,599
So we also scale difficulty in a few other ways,

462
00:30:17,599 --> 00:30:21,460
which I'll just briefly mention here.

463
00:30:21,460 --> 00:30:26,181
So we scale the challenge of individual NPCs

464
00:30:26,181 --> 00:30:28,342
by using something we call NPC roles,

465
00:30:28,342 --> 00:30:31,462
which is basically our one way to change the difficulty

466
00:30:31,462 --> 00:30:34,883
of an NPC without changing the faction.

467
00:30:37,247 --> 00:30:40,348
So we start off with the, what we call, veteran NPCs,

468
00:30:40,348 --> 00:30:41,748
which is the first improved role.

469
00:30:41,748 --> 00:30:44,449
And they're essentially the same thing as normal NPCs,

470
00:30:44,449 --> 00:30:46,750
except they have a little bit better weapons,

471
00:30:46,750 --> 00:30:49,651
and they feature the addition of armor.

472
00:30:49,651 --> 00:30:52,052
So their health bar looks very visually different

473
00:30:52,052 --> 00:30:52,412
to the player.

474
00:30:54,723 --> 00:30:58,826
The next role is elite, and elite NPCs have improved weapons,

475
00:30:58,826 --> 00:31:01,689
even more improved actually than the veterans,

476
00:31:01,689 --> 00:31:04,612
but they also have special ammo types.

477
00:31:04,612 --> 00:31:07,174
We give them brand new skills,

478
00:31:07,174 --> 00:31:09,176
and they have improved ability reactions,

479
00:31:09,176 --> 00:31:11,338
so they start using the elite profile, for example.

480
00:31:12,779 --> 00:31:17,442
They also have additional armor and even better aiming.

481
00:31:17,442 --> 00:31:20,304
One quick note though on the skill modifications.

482
00:31:20,304 --> 00:31:24,146
We actually ended up just using the next faction up

483
00:31:24,146 --> 00:31:25,947
or two factions up skills generally.

484
00:31:25,947 --> 00:31:28,509
And that was mostly just to save production costs.

485
00:31:28,509 --> 00:31:30,590
And they end up working actually pretty well, I think.

486
00:31:30,590 --> 00:31:33,732
And then finally, we have the named role NPCs,

487
00:31:33,732 --> 00:31:36,293
which are basically just reserved for bosses.

488
00:31:36,293 --> 00:31:38,615
And they're the elite NPCs,

489
00:31:38,615 --> 00:31:41,396
but they just have more armor, unique weapons,

490
00:31:41,396 --> 00:31:42,537
and do a little bit more damage.

491
00:31:47,082 --> 00:31:49,943
So my final topic, before passing the stage over to Philip,

492
00:31:49,943 --> 00:31:53,745
is just to talk really briefly about the structure

493
00:31:53,745 --> 00:31:54,906
of our behavior tree.

494
00:31:54,906 --> 00:31:55,466
So as I talked about before,

495
00:31:55,466 --> 00:31:56,747
one of the big challenges we had on the project

496
00:31:56,747 --> 00:31:58,688
was creating a huge number of NPCs.

497
00:31:58,688 --> 00:32:02,650
And of course the way we decided to do that

498
00:32:02,650 --> 00:32:07,753
was to make our behaviors as modular

499
00:32:07,753 --> 00:32:10,735
and reusable as possible.

500
00:32:10,735 --> 00:32:15,037
So we split them up into the groups,

501
00:32:15,037 --> 00:32:16,458
which you can see here.

502
00:32:18,388 --> 00:32:22,952
So I'll kind of take you through the flow of the NPC behavior.

503
00:32:22,952 --> 00:32:25,694
So we first start off with what we called high priority

504
00:32:25,694 --> 00:32:26,255
at critical events.

505
00:32:26,255 --> 00:32:28,397
And so that's basically an evaluation

506
00:32:28,397 --> 00:32:30,899
of is there a grenade nearby?

507
00:32:30,899 --> 00:32:33,501
Is there a seeker mind that's attacking me?

508
00:32:33,501 --> 00:32:37,084
Or things like, is there a status effect applied to me?

509
00:32:37,084 --> 00:32:38,666
Or is my weak point exploding?

510
00:32:38,666 --> 00:32:39,747
Something like that.

511
00:32:41,379 --> 00:32:42,840
Now if those checks fail, we move on

512
00:32:42,840 --> 00:32:44,802
to what we call scripted events.

513
00:32:44,802 --> 00:32:48,605
And these are all events that are level design controlled.

514
00:32:48,605 --> 00:32:50,546
So these are move orders and things like that.

515
00:32:50,546 --> 00:32:54,069
So Philip will be talking more about that in just a moment.

516
00:32:54,069 --> 00:32:57,691
We then move on to low priority critical events and NPC

517
00:32:57,691 --> 00:32:58,332
objectives.

518
00:32:58,332 --> 00:33:02,055
The NPC objectives being dynamic objectives that the NPCs do.

519
00:33:02,055 --> 00:33:04,977
It affects their behavior and movement.

520
00:33:07,947 --> 00:33:11,649
Then if that fails, we move on to our detection system,

521
00:33:11,649 --> 00:33:14,930
which is basically controlling whether the NPC is in combat,

522
00:33:14,930 --> 00:33:17,332
if they're an idol, investigation, and so forth.

523
00:33:17,332 --> 00:33:20,954
Then we move on to some of the very specific archetype

524
00:33:20,954 --> 00:33:24,676
behaviors before finally ending up with the base behavior

525
00:33:24,676 --> 00:33:27,037
that almost all NPCs share.

526
00:33:27,037 --> 00:33:33,360
Now, that controls cover usage, reloading, shooting,

527
00:33:33,360 --> 00:33:35,081
group behaviors, things like that.

528
00:33:36,030 --> 00:33:39,232
And you'll notice I also pointed out the faction tier modifier.

529
00:33:39,232 --> 00:33:41,833
So all those things that we listed before,

530
00:33:41,833 --> 00:33:44,675
those all are listed in those blocks

531
00:33:44,675 --> 00:33:47,177
and are controllable in those blocks.

532
00:33:47,177 --> 00:33:53,520
So before digging any deeper, though, in the behavior tree,

533
00:33:53,520 --> 00:33:55,261
I'm going to pass the stage over to Philip.

534
00:33:55,261 --> 00:33:55,442
Thank you.

535
00:33:55,442 --> 00:33:55,642
Thank you.

536
00:33:55,642 --> 00:33:55,982
Thank you.

537
00:34:06,322 --> 00:34:08,303
Thanks, Drew, and good morning to everybody.

538
00:34:08,303 --> 00:34:11,485
My name is Philip Dunstan, and I'm a senior AI programmer

539
00:34:11,485 --> 00:34:13,406
on Tom Clancy's The Division.

540
00:34:13,406 --> 00:34:16,148
You've just heard Drew talk about our design intent

541
00:34:16,148 --> 00:34:20,451
and philosophy for the NPCs, and how we differentiate these

542
00:34:20,451 --> 00:34:23,933
through their archetypes and the factions.

543
00:34:23,933 --> 00:34:25,794
I'm now going to describe some of the more technical

544
00:34:25,794 --> 00:34:27,916
elements of the NPC behaviors.

545
00:34:27,916 --> 00:34:29,997
And I'm going to begin with a brief description

546
00:34:29,997 --> 00:34:33,099
of the combat encounters, before diving into some

547
00:34:33,099 --> 00:34:36,041
of the behavior systems that underlie our NPC behaviors.

548
00:34:37,260 --> 00:34:43,522
I will then talk about how we give control over the NPCs to level designers, both directly

549
00:34:43,522 --> 00:34:45,163
and through these behaviors.

550
00:34:45,163 --> 00:34:50,625
And finally, I will finish with a few lessons that we learned working with cross-discipline

551
00:34:50,625 --> 00:34:53,447
teams and particularly working with level designers.

552
00:34:53,447 --> 00:34:59,329
The Division is a mixture of open world and narrative-driven story missions.

553
00:34:59,329 --> 00:35:06,752
Our open world consists of emergent behaviors with roaming mobs interacting with level design

554
00:35:07,641 --> 00:35:11,244
And our story missions are generally authored

555
00:35:11,244 --> 00:35:12,345
linear series of encounters

556
00:35:12,345 --> 00:35:14,046
with a very predictable player movement.

557
00:35:14,046 --> 00:35:16,508
Across both open world and story missions,

558
00:35:16,508 --> 00:35:22,413
a core creative intent on Tom Clancy's The Division

559
00:35:22,413 --> 00:35:25,955
was to give the player control over how combat is initiated.

560
00:35:25,955 --> 00:35:26,856
And as Drew mentioned earlier,

561
00:35:26,856 --> 00:35:28,878
this is called the player investigation phase.

562
00:35:31,270 --> 00:35:35,653
The player pulse skill helps players identify high priority

563
00:35:35,653 --> 00:35:36,213
targets.

564
00:35:36,213 --> 00:35:38,935
Gameplay mechanics allow players to coordinate targets

565
00:35:38,935 --> 00:35:41,656
and to synchronize their combat.

566
00:35:41,656 --> 00:35:43,698
And importantly, we wanted to allow the player

567
00:35:43,698 --> 00:35:48,580
to be able to relocate prior to the beginning of combat.

568
00:35:48,580 --> 00:35:50,382
For a group of players to be able to move,

569
00:35:50,382 --> 00:35:53,243
to flank a mob of NPCs, or for a single player

570
00:35:53,243 --> 00:35:55,405
to approach within an optimal combat range based

571
00:35:55,405 --> 00:35:56,665
on their combat loadout.

572
00:35:58,729 --> 00:36:01,270
To make this possible, we needed a system

573
00:36:01,270 --> 00:36:03,350
to allow players to approach the NPCs

574
00:36:03,350 --> 00:36:05,370
without triggering immediate combat,

575
00:36:05,370 --> 00:36:07,451
and that was the responsibility of our detection system.

576
00:36:07,451 --> 00:36:11,232
Our detection loop is built of five alert levels,

577
00:36:11,232 --> 00:36:14,152
escalating an NPC from idle up to investigation

578
00:36:14,152 --> 00:36:16,232
when a target is spotted and into combat.

579
00:36:16,232 --> 00:36:19,713
After combat, if all hostiles are dead,

580
00:36:19,713 --> 00:36:24,774
NPCs can transition to a combat investigation phase,

581
00:36:24,774 --> 00:36:27,375
and from there, either back into idle or into combat.

582
00:36:29,802 --> 00:36:32,224
As Drew mentioned, spoke about earlier,

583
00:36:32,224 --> 00:36:35,967
the alert level controls some of the behaviors

584
00:36:35,967 --> 00:36:37,348
in the base of our NPC behavior tree.

585
00:36:37,348 --> 00:36:40,190
The detection system is built on top of the alertness value.

586
00:36:40,190 --> 00:36:43,933
And this is affected by both audio and visual stimuli.

587
00:36:43,933 --> 00:36:47,236
And it's defined per archetype.

588
00:36:47,236 --> 00:36:50,118
Our audio visual stimuli are governed

589
00:36:50,118 --> 00:36:53,921
by standard vision cones,

590
00:36:53,921 --> 00:36:56,923
and I'm sure you're familiar with these.

591
00:36:58,422 --> 00:37:01,283
We have forward and periphery cones,

592
00:37:01,283 --> 00:37:03,304
and these are shown in yellow in the video.

593
00:37:03,304 --> 00:37:04,404
In addition to the standard vision cones,

594
00:37:04,404 --> 00:37:06,424
we have instant combat cones.

595
00:37:06,424 --> 00:37:10,045
These are shown in orange.

596
00:37:10,045 --> 00:37:15,527
If a target is seen within the instant combat cone,

597
00:37:15,527 --> 00:37:19,028
combat is triggered immediately.

598
00:37:19,028 --> 00:37:23,349
To prevent the player from sneaking up behind an NPC,

599
00:37:23,349 --> 00:37:25,650
we have a 360 degree close awareness area.

600
00:37:26,921 --> 00:37:29,603
And our vision cones differ if an NPC is in combat

601
00:37:29,603 --> 00:37:31,924
or out of combat, if the NPC is aiming or not aiming,

602
00:37:31,924 --> 00:37:34,405
and they're also modified by the weather.

603
00:37:34,405 --> 00:37:37,447
Interestingly, to allow the player to be able to sneak up

604
00:37:37,447 --> 00:37:40,049
on a group of NPCs out of combat,

605
00:37:40,049 --> 00:37:42,910
we modified the line of sight test slightly

606
00:37:42,910 --> 00:37:48,153
so that a player in low cover remains hidden more easily.

607
00:37:52,237 --> 00:37:55,738
Our audio events contain a sound type and a radius.

608
00:37:55,738 --> 00:37:59,620
The radius governs the maximum distance at which the sound can be heard, and the sound

609
00:37:59,620 --> 00:38:05,544
type specifies, limits the maximum alert level that can be triggered by that audio event.

610
00:38:05,544 --> 00:38:11,587
An interesting, suspicious sound, sorry, can trigger, such as player vaulting over cover,

611
00:38:11,587 --> 00:38:17,230
can trigger an NPC into an investigation alert level, but not into combat.

612
00:38:17,836 --> 00:38:21,618
And a threatening sound, such as shots fired or an explosion,

613
00:38:21,618 --> 00:38:22,579
can trigger combat.

614
00:38:22,579 --> 00:38:24,700
In addition to creating pre-combat gameplay options

615
00:38:24,700 --> 00:38:28,482
for the player, we also want to give the player the ability

616
00:38:28,482 --> 00:38:31,384
to exploit the detection system during combat.

617
00:38:31,384 --> 00:38:35,587
And to facilitate this, the NPCs remember the last position

618
00:38:35,587 --> 00:38:38,268
a hostile target was seen.

619
00:38:38,268 --> 00:38:44,932
The last known position contains two points, the aim at position

620
00:38:44,932 --> 00:38:47,294
and the navmesh position.

621
00:38:48,269 --> 00:38:51,071
The aim at position in green provides a point

622
00:38:51,071 --> 00:38:54,934
for the NPCs to aim at, where they no longer have line

623
00:38:54,934 --> 00:38:55,895
of sight to the target.

624
00:38:55,895 --> 00:38:59,137
This is particularly useful when the target is in low cover.

625
00:38:59,137 --> 00:39:03,560
We can position the aim at point slightly above low cover

626
00:39:03,560 --> 00:39:06,342
or outside of corner cover, so that bullets and flames

627
00:39:06,342 --> 00:39:08,864
are seen to naturally flow past the cover edge,

628
00:39:08,864 --> 00:39:10,926
with the occasional shot hitting the cover.

629
00:39:12,653 --> 00:39:15,755
The nav mesh position allows NPCs to find positions

630
00:39:15,755 --> 00:39:18,776
that can see behind the cover, either for flanking

631
00:39:18,776 --> 00:39:20,596
or as part of an investigation behavior.

632
00:39:20,596 --> 00:39:26,498
Moving on to our position system.

633
00:39:26,498 --> 00:39:31,200
This is core to all of our combat behaviors.

634
00:39:31,200 --> 00:39:33,941
And we use this for both cover

635
00:39:33,941 --> 00:39:35,602
and non-cover position queries.

636
00:39:36,818 --> 00:39:39,424
We don't use any local steering on the division.

637
00:39:39,424 --> 00:39:42,190
So we use this for nearly all of our NPC combat movement

638
00:39:42,190 --> 00:39:44,676
and some of our out of combat movement.

639
00:39:47,281 --> 00:39:50,622
The position system operates on pre-generated tactical positions.

640
00:39:50,622 --> 00:39:55,083
Across six square kilometers of Manhattan, we have almost two and a half million tactical

641
00:39:55,083 --> 00:39:57,804
positions, both cover and non-cover.

642
00:39:57,804 --> 00:40:03,466
Our cover-based positions include information about the cover depth, the cover height, and

643
00:40:03,466 --> 00:40:05,187
the cover-facing direction.

644
00:40:05,187 --> 00:40:09,488
And our non-cover positions are generated on a rotated grid with approximately four

645
00:40:09,488 --> 00:40:10,208
meter spacing.

646
00:40:11,189 --> 00:40:16,073
We use a rotated grid here to avoid some of the artifacts

647
00:40:16,073 --> 00:40:19,636
arising from the north, south, and east, west orientation

648
00:40:19,636 --> 00:40:23,359
of most of the buildings and streets in Manhattan.

649
00:40:23,359 --> 00:40:25,601
As behaviors are run on the server,

650
00:40:25,601 --> 00:40:27,543
these tactical positions are permanently resident memory.

651
00:40:27,543 --> 00:40:31,527
To perform queries on the tactical positions,

652
00:40:31,527 --> 00:40:33,749
we use a single uber position evaluator

653
00:40:33,749 --> 00:40:35,931
with memory parameters affecting the scoring.

654
00:40:35,931 --> 00:40:37,933
Some of those parameters are shown here.

655
00:40:39,630 --> 00:40:41,991
To make it easier for behavior authors,

656
00:40:41,991 --> 00:40:44,711
we expose sets of parameters through different behavior tree

657
00:40:44,711 --> 00:40:46,052
nodes.

658
00:40:46,052 --> 00:40:48,132
You can see in the screenshot here,

659
00:40:48,132 --> 00:40:49,552
we have a find cover position and find

660
00:40:49,552 --> 00:40:50,472
non-cover position nodes.

661
00:40:50,472 --> 00:40:54,633
And these are the workhorse nodes of our combat behaviors.

662
00:40:54,633 --> 00:40:57,434
In addition, you can see other types of movement queries.

663
00:40:57,434 --> 00:40:58,794
In the top right, for example, you

664
00:40:58,794 --> 00:41:02,155
can see a node which allows an NPC to find a suitable place

665
00:41:02,155 --> 00:41:03,215
to place a turret.

666
00:41:03,215 --> 00:41:04,975
And the bottom right, we have a node

667
00:41:04,975 --> 00:41:07,276
for an NPC to find a position to run away

668
00:41:07,276 --> 00:41:08,216
from a nearby grenade.

669
00:41:14,045 --> 00:41:16,506
we often perform multiple successive queries

670
00:41:16,506 --> 00:41:19,948
in behaviors with more and more permissive parameters.

671
00:41:19,948 --> 00:41:22,790
For example, we might perform a cover position query

672
00:41:22,790 --> 00:41:23,690
with an optimal range.

673
00:41:23,690 --> 00:41:26,031
If that doesn't work, we'll fall back

674
00:41:26,031 --> 00:41:28,733
on a non-cover position query with requiring

675
00:41:28,733 --> 00:41:30,434
line of sight to the target.

676
00:41:30,434 --> 00:41:32,115
And finally, if both of those fail,

677
00:41:32,115 --> 00:41:34,936
a cover or a non-cover position query without line of sight.

678
00:41:34,936 --> 00:41:38,018
And we found that this gives us better results

679
00:41:38,018 --> 00:41:40,980
than trying to identify a single best position in a single pass.

680
00:41:42,797 --> 00:41:45,418
It avoids the challenging problem of having to try

681
00:41:45,418 --> 00:41:51,560
and tune the different weights for the different parameters

682
00:41:51,560 --> 00:41:52,860
for the different queries.

683
00:41:52,860 --> 00:41:56,422
Caching both navigation and line of sight results

684
00:41:56,422 --> 00:41:58,603
was key to making this work with acceptable performance.

685
00:41:58,603 --> 00:41:59,523
In addition to combat positioning,

686
00:41:59,523 --> 00:42:04,245
we reused the tactical positions and the positioning

687
00:42:04,245 --> 00:42:08,186
system for investigation behaviors

688
00:42:08,186 --> 00:42:09,747
and other non-combat behaviors.

689
00:42:10,627 --> 00:42:13,587
The example here is our scripted investigation behavior.

690
00:42:13,587 --> 00:42:16,368
A group of NPCs is instructed to search an area.

691
00:42:16,368 --> 00:42:17,128
And I want to reiterate something

692
00:42:17,128 --> 00:42:21,129
that Drew mentioned here.

693
00:42:21,129 --> 00:42:23,449
This is a lot of the videos and screenshots

694
00:42:23,449 --> 00:42:27,290
you're seeing are not indicative of the final quality

695
00:42:27,290 --> 00:42:27,790
of the game.

696
00:42:27,790 --> 00:42:30,391
They're taken from test levels generated in our Snowdrop

697
00:42:30,391 --> 00:42:31,311
engine during development.

698
00:42:31,311 --> 00:42:33,052
So back to the example.

699
00:42:36,861 --> 00:42:39,582
The search query here is a simple algorithm.

700
00:42:39,582 --> 00:42:41,643
We take all of the tactical positions

701
00:42:41,643 --> 00:42:42,323
within the search volume.

702
00:42:42,323 --> 00:42:44,664
When we query the positions,

703
00:42:44,664 --> 00:42:48,145
we look for a position based on the distance from the NPC

704
00:42:48,145 --> 00:42:50,045
and looking for corner-covered positions.

705
00:42:50,045 --> 00:42:53,427
And finally, as the NPCs move through the area,

706
00:42:53,427 --> 00:42:55,507
we eliminate positions that have become visible

707
00:42:55,507 --> 00:42:56,068
to the player.

708
00:42:56,068 --> 00:42:57,508
This is a simple algorithm,

709
00:42:57,508 --> 00:43:00,269
and it works well with multiple agents.

710
00:43:04,904 --> 00:43:07,866
The division, finally I'm going to talk about the threat system.

711
00:43:07,866 --> 00:43:11,589
The division is designed to be played co-op with up to four players.

712
00:43:11,589 --> 00:43:13,571
And so we needed an aggro-style threat system.

713
00:43:13,571 --> 00:43:19,876
Target threat scores are calculated from a base threat, which is made of stable parameters

714
00:43:19,876 --> 00:43:23,779
such as whether the agent is a player or whether they're currently behind cover.

715
00:43:23,779 --> 00:43:29,503
And an action threat, which is usually a single frame event, such as the target shooting or

716
00:43:29,503 --> 00:43:31,165
the target using a skill.

717
00:43:31,165 --> 00:43:32,666
And the action threat decays over time.

718
00:43:35,730 --> 00:43:38,873
So those are some of our core NPC behavior systems.

719
00:43:38,873 --> 00:43:42,877
We're now going to take a look at how we allow

720
00:43:42,877 --> 00:43:46,140
level designers to control NPCs, both directly

721
00:43:46,140 --> 00:43:47,141
and through these systems.

722
00:43:47,141 --> 00:43:49,243
The Snowdrop engine provides level designers

723
00:43:49,243 --> 00:43:52,146
with a visual scripting environment.

724
00:43:52,146 --> 00:43:54,649
If you've used CryEngine or Unreal before,

725
00:43:54,649 --> 00:43:58,092
you're probably familiar with this type of environment.

726
00:43:59,258 --> 00:44:03,763
We provide nodes that allow level designers to issue low-level orders to NPCs, to set

727
00:44:03,763 --> 00:44:07,467
an NPC's alert level, and to modify positioning and threat systems.

728
00:44:07,467 --> 00:44:09,949
We also provide nodes to set high-level objectives on groups of NPCs.

729
00:44:09,949 --> 00:44:12,732
One of the first tools that we made available to level designers was low-level orders, and

730
00:44:12,732 --> 00:44:13,813
we call these NPC orders.

731
00:44:24,988 --> 00:44:27,991
NPC orders are typically used to control a single NPC

732
00:44:27,991 --> 00:44:30,353
in a scripted environment, such as putting a hostage

733
00:44:30,353 --> 00:44:32,594
behind cover or having an NPC follow a player.

734
00:44:32,594 --> 00:44:36,137
It's tempting to implement these as an override behavior that

735
00:44:36,137 --> 00:44:39,219
replaces all of an NPC's behavior.

736
00:44:39,219 --> 00:44:40,600
But we found it much more effective

737
00:44:40,600 --> 00:44:43,182
to implement them in the behavior tree

738
00:44:43,182 --> 00:44:44,843
as a reaction to a critical event.

739
00:44:44,843 --> 00:44:47,666
In this way, we can have them override the base NPC

740
00:44:47,666 --> 00:44:50,087
behaviors, but still have the NPC respond

741
00:44:50,087 --> 00:44:54,010
to very high priority critical events, such as grenades

742
00:44:54,010 --> 00:44:54,751
or blast skills.

743
00:44:56,542 --> 00:44:58,182
Now, I'd like to take a moment here

744
00:44:58,182 --> 00:45:00,843
to talk about level design.

745
00:45:00,843 --> 00:45:04,264
In my experience, level designers

746
00:45:04,264 --> 00:45:08,506
like to have full control over the player experience.

747
00:45:08,506 --> 00:45:09,946
And part of that is having knowledge

748
00:45:09,946 --> 00:45:12,627
about how the NPC is going to react in any given situation.

749
00:45:12,627 --> 00:45:16,489
So what happens when you give level designers, who

750
00:45:16,489 --> 00:45:19,029
like to have full knowledge of the NPCs,

751
00:45:19,029 --> 00:45:22,030
you give them fine positioning control over NPCs

752
00:45:22,030 --> 00:45:23,111
with NPC move orders.

753
00:45:23,893 --> 00:45:25,993
Well, to borrow a bit of an old meme here,

754
00:45:25,993 --> 00:45:29,534
you get move orders for everybody.

755
00:45:29,534 --> 00:45:30,575
You get a move order.

756
00:45:30,575 --> 00:45:31,675
You get a move order.

757
00:45:31,675 --> 00:45:35,236
You get a move order.

758
00:45:35,236 --> 00:45:39,277
And you don't get a move order.

759
00:45:39,277 --> 00:45:45,398
And so this, uh, thanks, Dave.

760
00:45:45,398 --> 00:45:45,818
Yeah.

761
00:45:45,818 --> 00:45:47,679
OK, so this isn't very good.

762
00:45:47,679 --> 00:45:50,920
Because move orders have some serious downsides.

763
00:45:52,077 --> 00:45:55,219
Move orders skip the evaluation of the underlying systems.

764
00:45:55,219 --> 00:45:58,141
We no longer use the results of our sensor and detection

765
00:45:58,141 --> 00:46:01,203
system and our threat evaluation system.

766
00:46:01,203 --> 00:46:05,646
And so move orders, load level orders, break NPC reactivity.

767
00:46:05,646 --> 00:46:08,248
And this is really big for players.

768
00:46:08,248 --> 00:46:11,050
Players seem much more likely to notice missing NPC reactions

769
00:46:11,050 --> 00:46:12,991
to events in the environment than they

770
00:46:12,991 --> 00:46:15,773
are to notice missing NPC abilities.

771
00:46:17,407 --> 00:46:24,953
Also, NPC orders don't provide any context to the behaviors that follow those move orders.

772
00:46:24,953 --> 00:46:29,277
And take, for example, we have a move order that is interrupted by combat.

773
00:46:29,277 --> 00:46:33,801
The behavior that follows that interruption has no information about what the NPC was

774
00:46:33,801 --> 00:46:35,303
trying to achieve with that move order.

775
00:46:35,303 --> 00:46:39,607
And finally, and I think most importantly, low-level orders force level designers to

776
00:46:39,607 --> 00:46:40,247
have to create AI.

777
00:46:40,938 --> 00:46:45,163
They need to plan for all of the permutations of combat and the environment, and they need

778
00:46:45,163 --> 00:46:46,885
to script accordingly.

779
00:46:46,885 --> 00:46:50,990
And this isn't a burden that level designers want, and it's not one that we should be forcing

780
00:46:50,990 --> 00:46:51,791
upon them.

781
00:46:51,791 --> 00:46:57,699
So we're going to prefer systemic approaches that work with the behavior systems rather

782
00:46:57,699 --> 00:46:58,500
than circumventing them.

783
00:47:00,441 --> 00:47:03,022
So the next thing we gave to the designers

784
00:47:03,022 --> 00:47:04,862
was the ability to modify the positioning system.

785
00:47:04,862 --> 00:47:07,323
And initially, this was through NPC zones.

786
00:47:07,323 --> 00:47:09,944
An NPC zone acts like a binary filter

787
00:47:09,944 --> 00:47:11,784
to the positioning system.

788
00:47:11,784 --> 00:47:16,126
The position evaluator will only accept positions

789
00:47:16,126 --> 00:47:18,967
that are within the volume specified in the NPC zone.

790
00:47:18,967 --> 00:47:20,727
If NPCs are outside of the zone, then we

791
00:47:20,727 --> 00:47:22,888
can allow positions that move them closer to the zone.

792
00:47:22,888 --> 00:47:24,988
But once inside, they will remain within that zone.

793
00:47:27,148 --> 00:47:29,691
However, this doesn't work so well in the open world.

794
00:47:29,691 --> 00:47:33,555
Short-range combat NPCs break down at the boundary edges

795
00:47:33,555 --> 00:47:36,118
when their target is outside of the zone.

796
00:47:36,118 --> 00:47:39,281
And even medium-range NPCs can be sniped

797
00:47:39,281 --> 00:47:41,543
with impunity from players from outside of the zone.

798
00:47:43,230 --> 00:47:45,031
So we also added tactical position modifiers.

799
00:47:45,031 --> 00:47:47,273
And the tactical position modifier

800
00:47:47,273 --> 00:47:49,835
was a soft version of NPC zone.

801
00:47:49,835 --> 00:47:53,258
We changed the position evaluator

802
00:47:53,258 --> 00:47:56,861
to score positions that are closer to the volume are higher

803
00:47:56,861 --> 00:47:58,863
and give maximum score bonus to positions

804
00:47:58,863 --> 00:48:01,385
that are within the tactical position modifier volume.

805
00:48:01,385 --> 00:48:03,767
Even still, we found that these modifiers

806
00:48:03,767 --> 00:48:08,171
could become easily overused.

807
00:48:10,787 --> 00:48:15,209
One of the problems level designers was trying to solve

808
00:48:15,209 --> 00:48:18,871
was, with position modifiers, was to prevent combat in one area from attracting all of

809
00:48:18,871 --> 00:48:20,072
the NPCs nearby.

810
00:48:20,072 --> 00:48:26,035
And this was happening particularly often within narrative-driven story missions.

811
00:48:26,035 --> 00:48:28,977
But it could also happen in the open world, in the denser parts of Manhattan.

812
00:48:28,977 --> 00:48:35,420
A level designer would set up different encounters in adjoining rooms, but as soon as combat

813
00:48:35,420 --> 00:48:39,002
initiated, then all of the NPCs in that mission would come running.

814
00:48:40,159 --> 00:48:43,922
So we gave level designers two additional pre-combat alert levels.

815
00:48:43,922 --> 00:48:46,866
The first of these is the scripted investigation alert level.

816
00:48:46,866 --> 00:48:52,632
And we saw this earlier when we looked at the scripted behavior, and how it reused the

817
00:48:52,632 --> 00:48:53,913
tactical position system.

818
00:48:53,913 --> 00:48:59,619
With the scripted investigation, NPCs would continually search an area ad infinitum.

819
00:48:59,619 --> 00:49:03,323
And second, we gave them a scripted combat alert level.

820
00:49:03,716 --> 00:49:08,819
And a scripted combat alert level instructed NPCs to take cover and act as if combat was

821
00:49:08,819 --> 00:49:12,441
going to take place with the level direction specified by the level designers.

822
00:49:12,441 --> 00:49:21,027
Importantly, both these alert levels skipped the initial combat reactions or initial reactions

823
00:49:21,027 --> 00:49:26,690
from an NPC entering combat, such as barks and other combat reactions.

824
00:49:27,560 --> 00:49:31,102
and they don't transition back into either combat investigation or idle.

825
00:49:31,102 --> 00:49:33,944
The NPCs will stay in those areas until combat has begun.

826
00:49:33,944 --> 00:49:37,426
Finally, and somewhat very successfully, we added high-level objectives.

827
00:49:37,426 --> 00:49:45,990
And you can see the list of high-level objectives that we provided here.

828
00:49:47,626 --> 00:49:50,107
These objectives are built on top of the underlying NPC

829
00:49:50,107 --> 00:49:51,187
systems.

830
00:49:51,187 --> 00:49:53,768
They modify the position of the detection system,

831
00:49:53,768 --> 00:49:57,369
the position evaluation and positioning system,

832
00:49:57,369 --> 00:49:58,429
and the threat system.

833
00:49:58,429 --> 00:50:02,850
The primary behavior for these objectives

834
00:50:02,850 --> 00:50:05,531
was implemented a slightly lower priority than the NPC orders.

835
00:50:05,531 --> 00:50:08,072
But throughout the behavior tree,

836
00:50:08,072 --> 00:50:11,993
the NPC objectives can be used to provide additional context

837
00:50:11,993 --> 00:50:13,993
to behaviors, animations, and barks.

838
00:50:15,746 --> 00:50:19,950
And high-level objectives can be used in both in-combat and out-of-combat situations.

839
00:50:19,950 --> 00:50:25,535
And we're going to take a little deeper look at one of these objectives, the interact with

840
00:50:25,535 --> 00:50:26,295
prop objective.

841
00:50:26,295 --> 00:50:34,943
So for the interact with prop objective, a group of NPCs is instructed to move into the

842
00:50:34,943 --> 00:50:36,264
vicinity of an object.

843
00:50:36,264 --> 00:50:43,190
And if there are no high-value threats, then to start interacting with that object.

844
00:50:44,377 --> 00:50:47,358
We modify the positioning system to score the positions

845
00:50:47,358 --> 00:50:51,621
near the object higher, and score even higher positions

846
00:50:51,621 --> 00:50:54,522
that are between the object and any hostile targets.

847
00:50:54,522 --> 00:50:56,483
And so NPCs are naturally seen to take cover

848
00:50:56,483 --> 00:50:58,184
in front of players approaching the object.

849
00:50:58,184 --> 00:51:01,146
We modify the threat system to increase the value

850
00:51:01,146 --> 00:51:05,248
of the threats that are in the area around the object,

851
00:51:05,248 --> 00:51:08,270
and further increase the value of threats

852
00:51:08,270 --> 00:51:10,632
that are targeting NPCs that are interacting

853
00:51:10,632 --> 00:51:11,352
with the object.

854
00:51:12,317 --> 00:51:14,438
And finally, we introduce new behaviors

855
00:51:14,438 --> 00:51:17,139
to move NPCs that are a long way away from the object

856
00:51:17,139 --> 00:51:18,519
near the object.

857
00:51:18,519 --> 00:51:21,800
And also, if there are no high value of threats

858
00:51:21,800 --> 00:51:23,701
in the vicinity, for an NPC to begin

859
00:51:23,701 --> 00:51:24,381
interacting with the object.

860
00:51:24,381 --> 00:51:26,842
So the question arises then, low-level orders

861
00:51:26,842 --> 00:51:30,323
or high-level systemic behaviors?

862
00:51:30,323 --> 00:51:32,624
Well, to tell the truth, we needed both.

863
00:51:32,624 --> 00:51:36,205
In the open world, we prefer the systemic behaviors

864
00:51:36,205 --> 00:51:37,625
of the high-level objectives.

865
00:51:39,190 --> 00:51:41,491
This handles the unpredictable player movement,

866
00:51:41,491 --> 00:51:44,673
and it allows us to maintain as much NPC reactivity as we can.

867
00:51:44,673 --> 00:51:45,893
Low-level missions, however, are great in story missions.

868
00:51:45,893 --> 00:51:49,255
They give fine control over NPC positioning,

869
00:51:49,255 --> 00:51:53,058
and they work much better for scripted sequence

870
00:51:53,058 --> 00:51:54,859
than animation sequences.

871
00:51:54,859 --> 00:51:57,880
They are more interruptible, and they

872
00:51:57,880 --> 00:52:00,182
don't have the same constraints with initial player NPC

873
00:52:00,182 --> 00:52:00,462
positioning.

874
00:52:00,462 --> 00:52:04,684
We found across low-level orders and high-level objectives

875
00:52:04,684 --> 00:52:07,205
that players will find a way to break all of our NPC behaviors.

876
00:52:08,178 --> 00:52:11,580
but we, and certainly low-level orders are more brittle

877
00:52:11,580 --> 00:52:14,202
than the high-level objectives, but we certainly,

878
00:52:14,202 --> 00:52:17,604
we still found them very important to have for the division.

879
00:52:17,604 --> 00:52:21,907
So, I've now discussed the technical aspects

880
00:52:21,907 --> 00:52:24,969
of the MPC behaviors, and how we give the control

881
00:52:24,969 --> 00:52:26,770
to level designers, and I'd like to finish up

882
00:52:26,770 --> 00:52:28,531
with some of the lessons that we learned

883
00:52:28,531 --> 00:52:30,872
working with cross-discipline teams.

884
00:52:31,720 --> 00:52:34,002
and particularly working with level designers.

885
00:52:34,002 --> 00:52:35,643
And I think this relationship is one

886
00:52:35,643 --> 00:52:37,564
that doesn't really get discussed enough.

887
00:52:37,564 --> 00:52:39,425
We often talk about the relationship

888
00:52:39,425 --> 00:52:42,567
between AI designers and AI programmers,

889
00:52:42,567 --> 00:52:44,288
or animators and AI programmers,

890
00:52:44,288 --> 00:52:46,269
but rarely the relationship with level designers.

891
00:52:46,269 --> 00:52:48,590
And yet, level design is so important to good AI.

892
00:52:48,590 --> 00:52:54,134
Good level design matches the capabilities of the AI.

893
00:52:54,134 --> 00:52:56,435
It shows off the strengths of our AI,

894
00:52:56,435 --> 00:52:57,676
and it hides any shortcomings.

895
00:52:59,349 --> 00:53:03,051
And of course, the most important thing about any relationship is communication.

896
00:53:03,051 --> 00:53:05,392
And we're talking about two-way communication here.

897
00:53:05,392 --> 00:53:10,794
Yes, we need to educate the level designers on the features that we're giving to them

898
00:53:10,794 --> 00:53:14,476
to control the embassies and how we would like them to be used.

899
00:53:14,476 --> 00:53:17,817
But we also need to talk with them about the bugs that they're having

900
00:53:17,817 --> 00:53:22,539
and to try and identify features where we can improve the tools that we're giving them

901
00:53:22,539 --> 00:53:26,821
and the AI behaviors in the level design they're creating.

902
00:53:28,796 --> 00:53:31,118
I'm going to grossly generalize a bit here,

903
00:53:31,118 --> 00:53:34,361
and I certainly don't mean to make any offense at all

904
00:53:34,361 --> 00:53:34,941
to level design.

905
00:53:34,941 --> 00:53:37,804
In my experience, level designers

906
00:53:37,804 --> 00:53:40,266
are used to making things work with the tools

907
00:53:40,266 --> 00:53:41,327
they have available to them.

908
00:53:41,327 --> 00:53:42,968
And the systems they use are often

909
00:53:42,968 --> 00:53:45,811
in flux during the whole state of the project development.

910
00:53:45,811 --> 00:53:48,173
They often have very tight production schedules

911
00:53:48,173 --> 00:53:49,034
and may be too busy producing content.

912
00:53:57,436 --> 00:54:01,799
to be able to make suggestions on AI features.

913
00:54:01,799 --> 00:54:04,080
So talking to them about the issues they're having

914
00:54:04,080 --> 00:54:06,922
and how we can improve our tools becomes even more important.

915
00:54:06,922 --> 00:54:10,064
We found that wikis and emails are completely

916
00:54:10,064 --> 00:54:11,405
insufficient for this.

917
00:54:11,405 --> 00:54:13,446
During the height of development,

918
00:54:13,446 --> 00:54:16,047
wiki pages get bookmarked, emails get marked as follow up,

919
00:54:16,047 --> 00:54:17,708
but no one gets a chance to read them.

920
00:54:17,708 --> 00:54:21,391
On the division, we use cross-discipline teams

921
00:54:21,391 --> 00:54:25,653
to great effect on certain particular gameplay aspects.

922
00:54:27,251 --> 00:54:31,593
One of my favorite things we did on the division was weekly sync meetings with key level designers

923
00:54:31,593 --> 00:54:32,993
and members of the MPC teams.

924
00:54:32,993 --> 00:54:37,275
This was particularly effective with our remote co-dev teams.

925
00:54:37,275 --> 00:54:41,897
These level designers became funnels for the type of communication that I'm talking about

926
00:54:41,897 --> 00:54:44,378
between level designers on their teams and the MPC team.

927
00:54:46,137 --> 00:54:48,378
And also, and I'm very proud of this,

928
00:54:48,378 --> 00:54:51,920
is we had an embedded level designer within the MPC team.

929
00:54:51,920 --> 00:54:54,341
This level designer became an informal point of contact

930
00:54:54,341 --> 00:54:56,762
for other level designers on the project

931
00:54:56,762 --> 00:54:57,882
with problems they were having.

932
00:54:57,882 --> 00:55:00,384
And the level designer could respond quickly

933
00:55:00,384 --> 00:55:02,785
and detect patterns in those problems.

934
00:55:02,785 --> 00:55:04,125
Validation and debugging tools are also very important.

935
00:55:11,137 --> 00:55:13,158
We can validate as much as possible in the editor.

936
00:55:13,158 --> 00:55:15,320
For instance, we can check the volumes

937
00:55:15,320 --> 00:55:18,522
that are passed to investigation areas or NPC zones

938
00:55:18,522 --> 00:55:21,044
to make sure they contain enough tactical positions

939
00:55:21,044 --> 00:55:21,324
to be viable.

940
00:55:21,324 --> 00:55:24,426
One of the powers of the Snowdrop engine

941
00:55:24,426 --> 00:55:29,550
is our ability to create and iterate quickly on test levels.

942
00:55:29,550 --> 00:55:31,851
And we use these both for reproducing the problems

943
00:55:31,851 --> 00:55:35,974
that levels are having away from the complexity of the full game.

944
00:55:36,805 --> 00:55:39,087
And we also use it to provide examples

945
00:55:39,087 --> 00:55:42,108
of the intended use of our AI to level design.

946
00:55:42,108 --> 00:55:44,610
Both of these tasks became a very important role

947
00:55:44,610 --> 00:55:46,431
of the embedded level designer on our team.

948
00:55:46,431 --> 00:55:47,391
And finally, we found it very useful

949
00:55:47,391 --> 00:55:51,634
to expose our debug draw environment to level designers.

950
00:55:51,634 --> 00:55:56,756
Not all of the level designers would use the debug draw,

951
00:55:56,756 --> 00:55:58,357
but some of them found it very helpful

952
00:55:58,357 --> 00:56:01,259
to be able to quickly debug simple AI problems.

953
00:56:03,070 --> 00:56:05,411
On the division, we have a very powerful behavior tree

954
00:56:05,411 --> 00:56:06,591
editor and debugger.

955
00:56:06,591 --> 00:56:09,112
And you can hear about more of this tomorrow

956
00:56:09,112 --> 00:56:11,792
with Jonas Gilberg's talk in the AR Summit.

957
00:56:11,792 --> 00:56:16,914
But we have found that this was never used at all

958
00:56:16,914 --> 00:56:17,574
by level design.

959
00:56:17,574 --> 00:56:19,354
This is simply too low a level that they're interested in

960
00:56:19,354 --> 00:56:21,575
for debugging NPC behaviors.

961
00:56:21,575 --> 00:56:23,995
And so in conclusion, you've heard me,

962
00:56:23,995 --> 00:56:26,356
sorry, you've heard Drew talk about the four pillars

963
00:56:26,356 --> 00:56:28,276
of design that we use for creating NPCs.

964
00:56:29,969 --> 00:56:33,150
how the division is both an RPG and a shooter,

965
00:56:33,150 --> 00:56:36,751
how we prioritize fun, but we respect the realism

966
00:56:36,751 --> 00:56:39,392
for the Tom Clancy universe,

967
00:56:39,392 --> 00:56:43,333
how we create combat challenge puzzles

968
00:56:43,333 --> 00:56:44,974
with strong archetypes,

969
00:56:44,974 --> 00:56:47,354
and how we continually challenge the player

970
00:56:47,354 --> 00:56:52,196
through increasing NBC behavior complexity and abilities.

971
00:56:52,775 --> 00:56:55,195
You've heard me talk about the behavior systems

972
00:56:55,195 --> 00:56:57,156
and how we give control over level design

973
00:56:57,156 --> 00:57:01,177
to be over the NPCs, both directly and through these systems.

974
00:57:01,177 --> 00:57:02,257
And finally, you heard me talk about

975
00:57:02,257 --> 00:57:04,818
the cross-discipline teams, and particularly

976
00:57:04,818 --> 00:57:06,278
that relationship with level design

977
00:57:06,278 --> 00:57:07,178
that I think is so important.

978
00:57:07,178 --> 00:57:09,279
Like to shout a big thanks out here

979
00:57:09,279 --> 00:57:12,320
to the four Ubisoft studios that worked on the Division,

980
00:57:12,320 --> 00:57:14,040
Leeds Studio Massive Entertainment,

981
00:57:14,040 --> 00:57:15,720
and our three co-dev partners,

982
00:57:15,720 --> 00:57:18,061
Reflections, RedStorm, and Ubisoft Annecy.

983
00:57:19,305 --> 00:57:21,846
There are a lot of people that went to making,

984
00:57:21,846 --> 00:57:24,547
contributing to the NPCs on the division,

985
00:57:24,547 --> 00:57:25,728
and we thank everyone for it.

986
00:57:25,728 --> 00:57:28,869
A quick plug for Jonas Guilberg's talk

987
00:57:28,869 --> 00:57:30,009
tomorrow in the AR Summit.

988
00:57:30,009 --> 00:57:32,370
Jonas will be discussing

989
00:57:32,370 --> 00:57:36,912
behavior tree editing and debugging tools.

990
00:57:36,912 --> 00:57:39,252
And also a plug for Nikolai Stefanov

991
00:57:39,252 --> 00:57:41,273
talking later in the week at the main conference

992
00:57:41,273 --> 00:57:43,554
on the global illumination in Tom Clancy's division.

993
00:57:44,995 --> 00:57:48,197
I'm pretty sure there aren't any time for questions today,

994
00:57:48,197 --> 00:57:49,398
but if you do have any questions,

995
00:57:49,398 --> 00:57:51,699
Drew and I will be around here afterwards.

996
00:57:51,699 --> 00:57:53,140
We will also, along with Jonas,

997
00:57:53,140 --> 00:57:55,501
be at the Ubisoft Lounge on Wednesday morning

998
00:57:55,501 --> 00:57:57,823
from 11 to 12.30, and you're all welcome

999
00:57:57,823 --> 00:58:01,005
to come and ask us questions about the division,

1000
00:58:01,005 --> 00:58:03,906
about working on AI, and about working at Ubisoft.

1001
00:58:03,906 --> 00:58:05,888
And in particular, if you'd like to speak to us

1002
00:58:05,888 --> 00:58:08,109
about working in Sweden at Massive Entertainment,

1003
00:58:08,109 --> 00:58:09,290
we'd love to hear from you.

1004
00:58:09,290 --> 00:58:10,130
We're always looking for good people.

1005
00:58:10,130 --> 00:58:10,630
Thank you very much.

