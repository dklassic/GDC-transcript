1
00:00:05,009 --> 00:00:07,390
Thanks for being here this morning so early.

2
00:00:09,072 --> 00:00:10,713
Just before starting, a few reminders.

3
00:00:10,993 --> 00:00:12,835
Please silence your cell phones.

4
00:00:12,855 --> 00:00:18,719
At the end, please fill the forms and give me as much feedback as you want, and I will

5
00:00:18,760 --> 00:00:20,041
apologize for the French accent.

6
00:00:21,882 --> 00:00:23,283
My name is Charles Lefebvre.

7
00:00:23,563 --> 00:00:26,406
I am a technical architect at Ubisoft Montreal.

8
00:00:27,586 --> 00:00:29,848
And I've been working in games for a couple of years.

9
00:00:29,868 --> 00:00:33,310
I've been doing a few games, some that you know,

10
00:00:33,330 --> 00:00:34,351
some that you don't know.

11
00:00:34,911 --> 00:00:37,193
And I've been working on Assassin's Creed Origins.

12
00:00:38,113 --> 00:00:39,434
That's why I'm here today.

13
00:00:40,295 --> 00:00:43,397
And of course, that's me, but this is going to be the work

14
00:00:43,437 --> 00:00:45,178
of a big team that I'm going to present.

15
00:00:46,739 --> 00:00:48,000
So, enough about me.

16
00:00:48,420 --> 00:00:49,201
Who is a programmer?

17
00:00:51,562 --> 00:00:52,443
Who is a designer?

18
00:00:54,144 --> 00:00:55,925
Who has never played Assassin's Creed Origins?

19
00:00:57,373 --> 00:01:01,196
Okay, so if you haven't played, it's not for me.

20
00:01:04,359 --> 00:01:06,241
It's mostly a game about patting cats,

21
00:01:07,422 --> 00:01:10,764
riding unicorns, and surfing on pyramids.

22
00:01:16,279 --> 00:01:18,360
But some players have seen something else,

23
00:01:18,420 --> 00:01:19,721
according to the forum on Reddit.

24
00:01:19,741 --> 00:01:23,063
They have seen that the NPCs seem to have now a schedule

25
00:01:23,343 --> 00:01:25,224
and that they are always alive.

26
00:01:25,745 --> 00:01:26,585
Is it true? Yes.

27
00:01:26,865 --> 00:01:29,367
And I'm going to tell you why this is happening,

28
00:01:29,387 --> 00:01:30,567
thanks to our Meta.AI.

29
00:01:32,849 --> 00:01:34,110
So what did we add before?

30
00:01:35,470 --> 00:01:36,611
Are my videos on the plane?

31
00:01:38,432 --> 00:01:38,512
No.

32
00:01:42,185 --> 00:01:45,547
Okay, I will have to do that really, really manually,

33
00:01:45,908 --> 00:01:47,328
so I really apologize for that.

34
00:01:48,269 --> 00:01:49,149
Try not to be late.

35
00:01:51,011 --> 00:01:53,952
So what did we add in Assassin's Creed Syndicate?

36
00:01:54,813 --> 00:01:57,374
Basically, oh sorry, I'm gonna see anything on my screen,

37
00:01:57,394 --> 00:02:00,396
so I might turn, but I apologize for that.

38
00:02:01,417 --> 00:02:03,978
We had only gameplay in the,

39
00:02:04,238 --> 00:02:05,379
can I get the mic here?

40
00:02:05,499 --> 00:02:07,300
No, I'm turning all the time.

41
00:02:12,706 --> 00:02:14,829
The gameplay was only happening around the players.

42
00:02:14,849 --> 00:02:17,372
There was no gameplay when you were far from the player.

43
00:02:18,313 --> 00:02:22,819
We had some fake crowd that you could see when you were far,

44
00:02:23,359 --> 00:02:24,781
but there was no gameplay happening.

45
00:02:25,202 --> 00:02:27,264
You can see also some icons, but they are not moving.

46
00:02:27,304 --> 00:02:29,807
They are persistent icons, and they are just telling you

47
00:02:29,887 --> 00:02:30,548
where you should go.

48
00:02:33,563 --> 00:02:34,444
So why did we change?

49
00:02:34,845 --> 00:02:37,447
First, we have introduced an RPG element

50
00:02:37,467 --> 00:02:39,008
in our ingredients in our game.

51
00:02:39,028 --> 00:02:41,870
Ascend Squid Origin is not an RPG game,

52
00:02:42,631 --> 00:02:44,252
but we have some ingredients.

53
00:02:44,312 --> 00:02:46,134
And for example, you can loot some targets.

54
00:02:46,234 --> 00:02:47,175
You can loot some animals.

55
00:02:47,535 --> 00:02:50,518
And you don't want to be able to kill a target, loot it,

56
00:02:50,558 --> 00:02:52,880
go away, come back, and be able to reloot it again.

57
00:02:54,581 --> 00:02:55,262
We have the eagle.

58
00:02:55,282 --> 00:02:56,723
It's something new to the brand.

59
00:02:57,143 --> 00:02:59,065
And with this eagle, you can do a couple of things

60
00:02:59,265 --> 00:03:00,466
on a video that will not play.

61
00:03:08,464 --> 00:03:11,105
So with the eagle, you can go in the air,

62
00:03:11,185 --> 00:03:13,285
focus on some NPCs and see what they are doing.

63
00:03:13,305 --> 00:03:16,306
So those NPCs are really close to you.

64
00:03:17,206 --> 00:03:19,927
But you can also focus on NPCs that are really,

65
00:03:19,967 --> 00:03:22,268
really far from you, like 400 meters away.

66
00:03:22,288 --> 00:03:24,448
So you can focus on them, see what they are doing,

67
00:03:24,488 --> 00:03:25,529
you can see that they are moving.

68
00:03:25,549 --> 00:03:31,390
And you can move with the eagle,

69
00:03:31,430 --> 00:03:33,851
you can go as far as you want from the player with the eagle.

70
00:03:36,546 --> 00:03:37,987
And when you arrive close to them,

71
00:03:38,227 --> 00:03:40,068
they hear they are doing something, they are spawned,

72
00:03:40,128 --> 00:03:41,169
and they are in the right state.

73
00:03:50,315 --> 00:03:51,836
We have the long range navigation.

74
00:03:52,217 --> 00:03:53,537
We have what we call Fiery Kiss,

75
00:03:53,678 --> 00:03:56,079
that are bounty hunters that are attracted sometimes

76
00:03:56,139 --> 00:03:58,561
by the player, and they need to be able to navigate

77
00:03:59,001 --> 00:04:00,742
even when the navmesh is not loaded.

78
00:04:00,782 --> 00:04:02,704
And obviously the navmesh will be only loaded

79
00:04:02,764 --> 00:04:03,364
around the player.

80
00:04:05,514 --> 00:04:08,015
And we switch from a mission system to a quest system.

81
00:04:08,055 --> 00:04:10,676
That means that we have multiple quests tracked and

82
00:04:10,736 --> 00:04:11,677
active at the same time.

83
00:04:12,317 --> 00:04:15,018
And before, we had only one mission active.

84
00:04:15,358 --> 00:04:19,240
And sometimes when the target was too far from the player,

85
00:04:19,280 --> 00:04:21,701
we were failing the quest, the mission, and

86
00:04:21,741 --> 00:04:22,682
you had to restart it.

87
00:04:22,742 --> 00:04:25,523
Now with this quest, since you can have multiple active at

88
00:04:25,563 --> 00:04:27,424
the same time, it's not something that

89
00:04:27,464 --> 00:04:28,164
we can do anymore.

90
00:04:29,653 --> 00:04:31,614
Also, Egypt is a huge world.

91
00:04:31,634 --> 00:04:32,875
This is Egypt.

92
00:04:33,175 --> 00:04:34,476
This is London in Sonic 8.

93
00:04:34,656 --> 00:04:35,897
So it's 10 times bigger.

94
00:04:37,638 --> 00:04:40,680
So we need to have something that will create emergent and

95
00:04:40,720 --> 00:04:43,062
system in gameplay, because obviously we cannot fill this

96
00:04:43,122 --> 00:04:48,625
world with scripted or even small ingredients.

97
00:04:48,665 --> 00:04:50,286
We need to have big ingredients that are moving

98
00:04:50,326 --> 00:04:51,487
and creating gameplay.

99
00:04:53,727 --> 00:04:54,968
So what is a Meta-AI?

100
00:04:55,668 --> 00:04:57,308
It's a combination of three things.

101
00:04:57,588 --> 00:04:59,129
It's a virtually tracking system

102
00:04:59,149 --> 00:05:02,489
that can track objects virtually in the world.

103
00:05:02,509 --> 00:05:05,330
It can be static objects and dynamic objects.

104
00:05:06,350 --> 00:05:08,731
It's a spawning system in charge of spawning

105
00:05:08,771 --> 00:05:11,312
the visual representation of those objects.

106
00:05:12,292 --> 00:05:15,393
And it is a behavior system that will push goals

107
00:05:15,553 --> 00:05:17,333
and objectives on those objects.

108
00:05:18,333 --> 00:05:19,514
It's not a game director.

109
00:05:19,674 --> 00:05:20,794
Every object is independent.

110
00:05:22,192 --> 00:05:23,353
So we have static objects.

111
00:05:23,653 --> 00:05:26,234
It can be a ballista, it can be a brassier,

112
00:05:26,615 --> 00:05:27,595
or it can be a cage.

113
00:05:28,335 --> 00:05:29,556
They are always loaded.

114
00:05:29,616 --> 00:05:31,537
It's in-place data, either placed by mission

115
00:05:31,617 --> 00:05:33,918
or other designers, but they will be always loaded.

116
00:05:34,218 --> 00:05:35,779
It can have a representation or not.

117
00:05:36,740 --> 00:05:40,262
So here, we have a station.

118
00:05:40,962 --> 00:05:42,863
So it's one kind of static object

119
00:05:42,903 --> 00:05:44,844
that doesn't have a visual.

120
00:05:45,604 --> 00:05:48,066
It has a type, but it also has some labels,

121
00:05:48,106 --> 00:05:50,747
and it can be identified through those labels.

122
00:05:51,969 --> 00:05:56,554
It can have child positions that can be occupied and reserved by dynamic objects.

123
00:05:58,015 --> 00:06:04,202
Most of the time you will have a quad station at the position of the child position and

124
00:06:04,242 --> 00:06:08,726
when the entity is spawned it will be acquired and play a nice animation like the one you

125
00:06:08,746 --> 00:06:09,307
can see here.

126
00:06:10,088 --> 00:06:12,150
It can be disabled but never deleted.

127
00:06:13,191 --> 00:06:15,113
And we have a lot of static objects.

128
00:06:15,932 --> 00:06:16,933
This is a 2D map.

129
00:06:17,373 --> 00:06:19,535
This is a player's wide piece that you can't probably see.

130
00:06:19,555 --> 00:06:21,738
This is one kilometer, and this is five kilometers.

131
00:06:22,118 --> 00:06:24,781
So you can see that we have a lot of static objects.

132
00:06:24,841 --> 00:06:27,704
We have, in Egypt, 50,000 static objects

133
00:06:27,744 --> 00:06:29,225
for a weight of 15 megabytes.

134
00:06:31,408 --> 00:06:32,889
This is five kilometers of the game.

135
00:06:33,029 --> 00:06:33,890
So it's still big.

136
00:06:34,961 --> 00:06:38,503
This is the type of static objects that we have.

137
00:06:38,663 --> 00:06:41,885
Most of them are location and animal locations,

138
00:06:42,405 --> 00:06:44,186
but we have also a lot of spawners.

139
00:06:44,706 --> 00:06:47,328
So the spawners are the objects that will create

140
00:06:47,748 --> 00:06:49,269
the dynamic object, they will spawn them.

141
00:06:49,289 --> 00:06:54,131
Every static, every spawner will automatically generate

142
00:06:54,171 --> 00:06:56,532
some spawning position to ensure they are not all spawning

143
00:06:56,552 --> 00:07:00,534
on the same spot, and they will create some dynamic objects.

144
00:07:02,095 --> 00:07:03,216
So what is a dynamic object?

145
00:07:04,280 --> 00:07:08,001
It can be a boat, it can be a human, it can be an animal.

146
00:07:09,021 --> 00:07:10,561
You can be parented to another one,

147
00:07:10,601 --> 00:07:12,362
like here you have a human on a boat,

148
00:07:12,882 --> 00:07:15,883
so the human will be parented to the boat.

149
00:07:17,143 --> 00:07:19,644
And all the characters are underlined by the Meta-AI

150
00:07:19,684 --> 00:07:21,144
in the game except one.

151
00:07:22,664 --> 00:07:25,225
You can be virtual, you can be in bulk state,

152
00:07:25,265 --> 00:07:26,425
I will come back on that later,

153
00:07:26,465 --> 00:07:29,626
it's when you have a very cheap visual representation.

154
00:07:30,386 --> 00:07:31,306
And you can be real.

155
00:07:31,327 --> 00:07:33,787
Another video.

156
00:07:35,471 --> 00:07:36,532
You can have an AI state.

157
00:07:36,552 --> 00:07:44,220
That's what you are seeing when you are focusing on them with the eagle.

158
00:07:45,261 --> 00:07:47,303
And this is represented by your current behavior.

159
00:07:55,350 --> 00:08:00,732
And like the static objects, you can be identified by your type or by your labels.

160
00:08:01,252 --> 00:08:05,513
For the static objects, the labels were static, they will never change, but for the dynamic

161
00:08:05,553 --> 00:08:08,954
objects, some labels can be pushed by your behavior according to what you are doing.

162
00:08:09,395 --> 00:08:14,456
And once again, you can be identified by that, you can search for dynamic or static objects

163
00:08:14,496 --> 00:08:15,456
with a specific label.

164
00:08:27,203 --> 00:08:30,746
It's not going to look very great because this text is still going to be here.

165
00:08:31,187 --> 00:08:37,432
But if I'm zooming out, you can see that we have a lot of dynamic objects around the player.

166
00:08:38,413 --> 00:08:40,134
And they are moving, they are doing stuff.

167
00:08:49,430 --> 00:08:53,493
OK, we have up to 12,000 dynamic objects

168
00:08:54,014 --> 00:08:56,996
loaded for a budget of 40 megabytes.

169
00:08:58,117 --> 00:09:01,019
And if I'm displaying the same 2D map,

170
00:09:01,239 --> 00:09:03,461
you can see that we have a lot around the player.

171
00:09:03,801 --> 00:09:06,263
But as soon as you are going far away from the players,

172
00:09:06,283 --> 00:09:08,945
there are less, because we can delete some of them,

173
00:09:09,005 --> 00:09:10,146
like the crowds, the animals.

174
00:09:10,186 --> 00:09:12,008
We don't really need to keep them all the time.

175
00:09:13,089 --> 00:09:15,591
But some are important to keep, like the mission NPCs

176
00:09:15,751 --> 00:09:17,332
and the girl that you killed in a camp.

177
00:09:18,137 --> 00:09:20,918
And you can not delete them, but you can make them hibernate.

178
00:09:20,998 --> 00:09:22,399
That's the one that you can see in green.

179
00:09:23,059 --> 00:09:25,600
And in this case, that means that they won't be updated

180
00:09:25,660 --> 00:09:27,141
anymore, but we will keep them.

181
00:09:27,161 --> 00:09:30,042
So they will keep the inventory, their target, everything.

182
00:09:32,663 --> 00:09:36,785
Once again, this is what we have for dynamic objects.

183
00:09:36,865 --> 00:09:38,545
Most of them are humans and animals,

184
00:09:38,886 --> 00:09:42,987
but we have some various dynamic objects, like water vehicles.

185
00:09:46,272 --> 00:09:50,236
We want the subject to move, so for that we need to have something that will handle the

186
00:09:50,356 --> 00:09:51,497
long-range navigation.

187
00:09:52,058 --> 00:09:53,619
And this is the AI network.

188
00:09:54,160 --> 00:09:56,662
So this is a top view of the AI network in telemetry.

189
00:09:57,383 --> 00:09:58,544
So what is the AI network?

190
00:09:59,125 --> 00:10:01,027
It's a graph with nodes.

191
00:10:02,048 --> 00:10:04,450
Those nodes are going to be always on the live mesh.

192
00:10:04,790 --> 00:10:07,713
They can be either generated or end placed.

193
00:10:10,605 --> 00:10:16,388
Two connected nodes will have a maximum distance on 25 meters and always on the NAD mesh.

194
00:10:16,828 --> 00:10:21,390
Static objects and child positions will be nodes, but we have nodes that are not static

195
00:10:21,430 --> 00:10:22,631
objects or child positions.

196
00:10:23,311 --> 00:10:28,274
Between those nodes, we have some links, and those links can have some properties, like

197
00:10:28,574 --> 00:10:31,395
can it be used by a human, by an animal, or by a boat?

198
00:10:33,254 --> 00:10:34,175
And we have some lanes.

199
00:10:34,535 --> 00:10:36,216
Each dynamic object that can navigate

200
00:10:36,316 --> 00:10:37,697
will have a navigation profile.

201
00:10:38,037 --> 00:10:40,198
And according to this navigation profile,

202
00:10:41,079 --> 00:10:43,500
you will be able or not to navigate on a lane,

203
00:10:44,801 --> 00:10:46,662
and on a link, and to choose a lane.

204
00:10:47,123 --> 00:10:48,944
Isolated networks are supported.

205
00:10:49,004 --> 00:10:50,825
It's super easy for us to check if,

206
00:10:51,265 --> 00:10:53,066
for specific navigation profiles,

207
00:10:53,086 --> 00:10:54,607
two nodes are connected.

208
00:10:54,967 --> 00:10:56,528
So we can support isolated network.

209
00:10:57,069 --> 00:11:00,230
And they are divided in sectors for hierarchical pathfinding.

210
00:11:00,291 --> 00:11:01,911
So doing, even if it's a huge.

211
00:11:02,559 --> 00:11:05,300
a huge map, it's not super expensive to do a request.

212
00:11:06,460 --> 00:11:08,161
I'm going to try to show the video.

213
00:11:19,726 --> 00:11:20,787
So if I'm zooming out,

214
00:11:21,907 --> 00:11:24,108
you can see that we have a lot of nodes and links.

215
00:11:24,168 --> 00:11:26,729
We have alpha million nodes and alpha million links

216
00:11:27,309 --> 00:11:28,550
for a budget of 100 megabytes.

217
00:11:38,815 --> 00:11:39,655
Oh, that's a video.

218
00:11:40,136 --> 00:11:44,379
We are also using, we can also see the AI network.

219
00:11:44,399 --> 00:11:45,880
Sorry, I've lost my mouse.

220
00:11:49,683 --> 00:11:52,245
We're also using the AI network in the game

221
00:11:52,285 --> 00:11:53,766
when we are auto-following a road.

222
00:11:53,786 --> 00:11:57,048
And in this case, the player will follow this AI network,

223
00:11:57,088 --> 00:11:59,170
and we are even going to display it.

224
00:12:00,531 --> 00:12:02,092
So it's not only used by the meta-AI.

225
00:12:05,815 --> 00:12:10,337
So there are three states for the dynamic objects.

226
00:12:10,397 --> 00:12:11,738
The first one is a virtual state,

227
00:12:11,778 --> 00:12:13,558
and I'm going to show you a nice screenshot

228
00:12:14,239 --> 00:12:15,720
of an object in virtual.

229
00:12:15,900 --> 00:12:17,160
So obviously you cannot see anything,

230
00:12:17,620 --> 00:12:19,321
but if I'm turning on the debug display,

231
00:12:19,341 --> 00:12:21,522
you can see that we have a position,

232
00:12:22,183 --> 00:12:24,644
we can have an inventory, we can have a level,

233
00:12:25,364 --> 00:12:28,086
we can have a target, and you can have a path

234
00:12:28,346 --> 00:12:30,387
to this target along the eye network.

235
00:12:32,188 --> 00:12:33,788
That's the minimum that you need to keep

236
00:12:34,088 --> 00:12:35,189
when you're in virtual.

237
00:12:35,946 --> 00:12:38,767
and you're not going to be updated every frame, obviously.

238
00:12:39,488 --> 00:12:42,009
When you're in virtual, you're going to be updated

239
00:12:42,309 --> 00:12:44,070
every 15 seconds by default.

240
00:12:44,130 --> 00:12:45,091
If you're close to the player,

241
00:12:45,111 --> 00:12:47,132
you're going to be updated every five seconds.

242
00:12:49,953 --> 00:12:51,754
The second state is a bulk state.

243
00:12:52,234 --> 00:12:54,936
So you can see here, value subject in bulk.

244
00:12:55,236 --> 00:12:59,898
So that's a very cheap representation of an entity.

245
00:12:59,998 --> 00:13:01,799
It's only one draw call, there are no shadow.

246
00:13:03,386 --> 00:13:05,509
The spawning distance for those bugs

247
00:13:07,191 --> 00:13:08,753
will depend on the size of the object.

248
00:13:09,174 --> 00:13:11,537
For a child, it would be 250 meters.

249
00:13:12,177 --> 00:13:14,120
And for a boat, it would be two kilometers.

250
00:13:15,181 --> 00:13:16,143
And they can be animated.

251
00:13:18,695 --> 00:13:19,995
So you can see that they're animated.

252
00:13:20,415 --> 00:13:22,736
It's a simple animation, but when they are far,

253
00:13:23,436 --> 00:13:24,177
it's not obvious.

254
00:13:25,577 --> 00:13:28,618
So you can see that we have a very limited number

255
00:13:28,778 --> 00:13:29,439
of Bulk's models.

256
00:13:29,459 --> 00:13:31,599
They all look the same, every woman, every man,

257
00:13:32,000 --> 00:13:33,540
because they are really far from the player.

258
00:13:34,020 --> 00:13:35,821
It's different from what we had on Sonic 8

259
00:13:35,861 --> 00:13:37,982
where we have a big variety of Bulk's,

260
00:13:38,302 --> 00:13:39,862
and when they were getting close,

261
00:13:39,882 --> 00:13:41,223
we were trying to spawn an entity

262
00:13:41,263 --> 00:13:44,004
that was looking like the Bulk.

263
00:13:50,865 --> 00:13:53,648
So we have around 1,000 bugs when we are in cities,

264
00:13:53,688 --> 00:13:55,169
like in Alexandria, for example.

265
00:13:55,910 --> 00:13:58,233
And they are updated every two frames when visible,

266
00:13:58,273 --> 00:14:00,055
and once again when they are not visible.

267
00:14:00,075 --> 00:14:01,897
You don't really need to tick them each frame

268
00:14:01,937 --> 00:14:03,699
because the animation is not going to move a lot.

269
00:14:04,539 --> 00:14:06,742
So we are going to update them one in every two frames.

270
00:14:06,762 --> 00:14:11,006
Video, don't crash.

271
00:14:12,003 --> 00:14:14,463
We are even seeing the bugs when we are meditating.

272
00:14:14,683 --> 00:14:16,004
In this case, on the bottom of the screen,

273
00:14:16,044 --> 00:14:18,684
you can see that the boats are moving really, really fast.

274
00:14:19,445 --> 00:14:20,885
And it's not something that we can do

275
00:14:20,925 --> 00:14:22,805
with a real entity with physics components,

276
00:14:23,245 --> 00:14:25,186
but here it's a bug, so we just update it

277
00:14:25,526 --> 00:14:30,087
with a big DT, big delta time, 20 times the regular DT,

278
00:14:30,427 --> 00:14:31,907
and they're going to move super fast

279
00:14:32,187 --> 00:14:33,788
and create these visual effects.

280
00:14:38,533 --> 00:14:39,814
Finally, we have the real state.

281
00:14:39,874 --> 00:14:42,156
It's when you have an entity with components,

282
00:14:42,176 --> 00:14:44,557
so it can be animation, physics, AI components,

283
00:14:44,597 --> 00:14:45,518
a lot of components.

284
00:14:47,879 --> 00:14:54,383
When you're in a, no, obviously it's a video.

285
00:14:54,443 --> 00:14:57,164
When you have an entity, then you can fight with a player,

286
00:14:57,184 --> 00:14:59,126
some things that you cannot do in bulk or will.

287
00:14:59,886 --> 00:15:02,367
You can take damages, you can take arrows,

288
00:15:02,848 --> 00:15:05,189
you can, you have some particle effects,

289
00:15:05,209 --> 00:15:06,090
you can play some sounds.

290
00:15:07,622 --> 00:15:09,702
but this is going to be super expensive.

291
00:15:14,703 --> 00:15:16,124
So you can pick up some objects,

292
00:15:16,564 --> 00:15:18,024
but it's super expensive.

293
00:15:18,644 --> 00:15:20,925
Each component can be updated multiple times

294
00:15:21,165 --> 00:15:24,085
before and after the physics, for example,

295
00:15:24,105 --> 00:15:25,446
so it's really, really expensive.

296
00:15:25,846 --> 00:15:29,007
So we have a maximum budget of 200 objects in real estate.

297
00:15:37,475 --> 00:15:40,237
The player, I've said that there is only one object,

298
00:15:40,497 --> 00:15:42,538
one character that is not part of the meta eye

299
00:15:42,638 --> 00:15:43,618
and it's not the player.

300
00:15:43,638 --> 00:15:47,600
The player is an object.

301
00:15:47,841 --> 00:15:48,801
We have a player object.

302
00:15:49,401 --> 00:15:52,543
Obviously, it will never be in bulk or virtual,

303
00:15:53,103 --> 00:15:55,464
but other objects will be able to target the player

304
00:15:55,544 --> 00:15:58,286
and to navigate to the player and to fight with the player.

305
00:15:59,118 --> 00:16:03,360
The only one that is not part of the Meta AI is actually the Eagle.

306
00:16:03,880 --> 00:16:08,782
And one big reason for that is we don't really want the other NPCs to shoot and kill the Eagle.

307
00:16:08,842 --> 00:16:10,243
So it's not part of the Meta AI.

308
00:16:10,683 --> 00:16:12,264
But the Meta AI is not player-centric.

309
00:16:12,684 --> 00:16:14,105
It doesn't have any privilege.

310
00:16:15,025 --> 00:16:16,926
And I have a video to prove you that.

311
00:16:19,387 --> 00:16:22,689
So as you can see on this video, it's really not player-centric.

312
00:16:22,709 --> 00:16:24,870
And other NPCs don't care at all about the player.

313
00:16:26,411 --> 00:16:28,051
And it can be appeased by that sometimes.

314
00:16:34,802 --> 00:16:38,343
So in Meta-AI, there is AI, so we need to have something.

315
00:16:39,624 --> 00:16:42,284
And this will be handled by virtual behaviors.

316
00:16:42,344 --> 00:16:45,725
So virtual behaviors will give a world to the object.

317
00:16:46,885 --> 00:16:49,526
It can be to select a target, to navigate to this target,

318
00:16:49,666 --> 00:16:51,687
and to interact with this target.

319
00:16:52,487 --> 00:16:53,747
It's a simple gameplay loop.

320
00:16:54,227 --> 00:16:56,088
We have a couple of behaviors, but most of the time,

321
00:16:56,128 --> 00:16:57,768
it will be a go-to, a patchwork,

322
00:16:57,988 --> 00:17:00,209
can be slightly more complicated, like an ambush.

323
00:17:02,267 --> 00:17:06,029
And for each dynamic object, we have one main behavior

324
00:17:06,189 --> 00:17:07,389
and one reaction behavior.

325
00:17:07,910 --> 00:17:10,871
The only reaction behavior that we have is actually the flee,

326
00:17:11,211 --> 00:17:12,832
but we can persist the flee in virtual

327
00:17:12,872 --> 00:17:15,093
and keep on fleeing in the virtual space.

328
00:17:16,787 --> 00:17:19,029
And it's only going to run on the root object.

329
00:17:19,049 --> 00:17:20,930
So if you have someone on a horse,

330
00:17:21,190 --> 00:17:24,512
only the horse will have a virtual behavior active.

331
00:17:25,092 --> 00:17:27,073
That was an issue for us because that means

332
00:17:27,113 --> 00:17:29,335
that if you need a horse to navigate somewhere,

333
00:17:29,415 --> 00:17:31,616
as soon as you are on the horse,

334
00:17:32,036 --> 00:17:35,138
you need to ensure that the behavior is pushed on the horse

335
00:17:35,518 --> 00:17:37,559
and that the horse is going to select the same target.

336
00:17:40,761 --> 00:17:42,883
And as soon as the entity is spawned in real state,

337
00:17:42,943 --> 00:17:45,124
it's going to drive the AI of the spawn entity.

338
00:17:46,211 --> 00:17:52,116
Our AI is working through a state chart and the virtual behavior will push some embedded

339
00:17:52,136 --> 00:17:53,877
state charts into this state chart.

340
00:17:55,138 --> 00:18:02,743
So how this is working, small example, here we have a behavior go to for a range of 150

341
00:18:02,783 --> 00:18:06,766
meters and the label will be location sleep for low class.

342
00:18:07,707 --> 00:18:09,989
So we have an NPC with this virtual behavior.

343
00:18:10,649 --> 00:18:12,090
Well, this bed is too far.

344
00:18:13,228 --> 00:18:16,030
This one is not connected, it's on a separate AI network.

345
00:18:17,110 --> 00:18:18,491
This one maybe has the wrong label,

346
00:18:19,232 --> 00:18:20,632
and this one is already occupied,

347
00:18:21,153 --> 00:18:22,754
so we are going to use the closest bed.

348
00:18:23,154 --> 00:18:25,495
Can be the closest to the NPC,

349
00:18:25,916 --> 00:18:27,857
or the closest to his spawner,

350
00:18:28,197 --> 00:18:31,599
if we want to keep him in a range around his spawner,

351
00:18:31,979 --> 00:18:35,081
and to avoid him from going far away from the spawner.

352
00:18:36,842 --> 00:18:39,344
Now we need something to push those virtual behaviors

353
00:18:39,464 --> 00:18:41,485
on the dynamic objects, and this will be needs.

354
00:18:42,283 --> 00:18:43,044
So what is a need?

355
00:18:43,084 --> 00:18:44,285
Well, you can have a set of needs,

356
00:18:44,325 --> 00:18:47,526
like going to the toilet, sleeping, eating, or healing.

357
00:18:47,546 --> 00:18:51,548
And maybe this NPC went to the toilet 10 minutes ago,

358
00:18:52,069 --> 00:18:53,009
and now he doesn't need to go.

359
00:18:53,549 --> 00:18:55,350
There is no bed nearby, so he cannot sleep.

360
00:18:55,971 --> 00:18:58,412
And his health is perfectly fine,

361
00:18:58,652 --> 00:19:00,373
so he doesn't want to go and see a doctor.

362
00:19:00,933 --> 00:19:01,994
So he's going to eat.

363
00:19:03,375 --> 00:19:05,256
Those needs are organized in schedule,

364
00:19:05,296 --> 00:19:07,437
and you can have different schedules

365
00:19:07,897 --> 00:19:09,018
according to the time of day.

366
00:19:09,515 --> 00:19:10,997
And here we can see the active needs.

367
00:19:11,017 --> 00:19:16,221
The guy on the left is working, and the guard is socializing.

368
00:19:18,123 --> 00:19:19,384
So another nice video.

369
00:19:23,247 --> 00:19:24,928
So here you can see a guard for the moment.

370
00:19:27,651 --> 00:19:28,632
Try to move the text.

371
00:19:28,652 --> 00:19:29,632
I'm sorry for the text.

372
00:19:30,413 --> 00:19:32,095
For the moment, he's eating, but at some point,

373
00:19:32,115 --> 00:19:34,917
he's going to decide that he needs to go to the toilet.

374
00:19:36,168 --> 00:19:37,670
So it's going to navigate to the toilet.

375
00:19:38,170 --> 00:19:39,691
There's a timer for the toilet need,

376
00:19:39,731 --> 00:19:41,812
but the timer is not going to start

377
00:19:42,073 --> 00:19:43,634
as long as you don't reach the toilets,

378
00:19:43,674 --> 00:19:45,095
because obviously you don't want the guy

379
00:19:45,415 --> 00:19:48,417
to start navigating and to do a U-turn after 20 seconds

380
00:19:48,457 --> 00:19:51,339
just because his need is over.

381
00:19:51,739 --> 00:19:53,501
Just going to, it's a long pass,

382
00:19:53,561 --> 00:19:55,362
so I'm going to move.

383
00:19:55,382 --> 00:19:57,463
It's moving.

384
00:19:57,884 --> 00:19:58,904
That's really far.

385
00:20:04,608 --> 00:20:04,929
Yeah, it's.

386
00:20:06,223 --> 00:20:07,865
It's a private area of the fort.

387
00:20:09,506 --> 00:20:10,187
Am I here?

388
00:20:11,989 --> 00:20:12,830
Yeah, I think it's here.

389
00:20:12,850 --> 00:20:12,890
OK.

390
00:20:17,334 --> 00:20:18,616
So now he's arriving to the toilets.

391
00:20:18,936 --> 00:20:21,859
And if you can see, the timer is going to go down.

392
00:20:23,727 --> 00:20:25,588
Let's give him some privacy and we'll move.

393
00:20:25,928 --> 00:20:28,368
At some point, he's going to switch somewhere.

394
00:20:28,388 --> 00:20:30,289
I don't remember where, but to the night schedule.

395
00:20:30,789 --> 00:20:32,709
He goes, the night will arrive.

396
00:20:32,769 --> 00:20:35,110
Now it's a different schedule.

397
00:20:35,130 --> 00:20:37,170
He doesn't need to eat anymore.

398
00:20:38,210 --> 00:20:40,491
Obviously, everything is data-driven, by the way.

399
00:20:40,831 --> 00:20:42,791
So it's 90 seconds.

400
00:20:42,851 --> 00:20:43,912
It's very long, obviously.

401
00:20:44,252 --> 00:20:45,872
But it's just because we want you to see that.

402
00:20:49,533 --> 00:20:49,933
Yeah.

403
00:20:51,693 --> 00:20:52,593
Too many beers yesterday.

404
00:20:54,287 --> 00:20:58,090
And at some point he will fulfill his need and he will do something else like socializing.

405
00:21:06,518 --> 00:21:11,563
And it's really nice for us because what we can do is with those needs and according to

406
00:21:11,583 --> 00:21:15,506
the number of resources that you're placing, maybe here during the night you will have

407
00:21:15,546 --> 00:21:17,148
only four guards that will be active.

408
00:21:18,215 --> 00:21:20,535
But during the day, you will have seven guards

409
00:21:20,575 --> 00:21:22,956
because during the night, maybe some guards are sleeping.

410
00:21:23,016 --> 00:21:25,337
So according to the time of day, everything will change

411
00:21:25,717 --> 00:21:29,238
and we'll have different behaviors happening in this camp.

412
00:21:30,278 --> 00:21:33,119
And this will create emergent gameplay, obviously,

413
00:21:33,159 --> 00:21:35,619
because animals will have needs as well.

414
00:21:36,060 --> 00:21:37,660
And one of their needs can be to eat

415
00:21:37,920 --> 00:21:39,140
and they can eat humans.

416
00:21:39,601 --> 00:21:42,041
So on the top, you can see a hippo arriving in the camp

417
00:21:42,401 --> 00:21:43,742
and start fighting with the guards.

418
00:21:44,902 --> 00:21:45,502
And they will fight.

419
00:21:48,660 --> 00:21:50,181
And at some point another one will arrive.

420
00:21:50,201 --> 00:21:55,485
So nothing is scripted here.

421
00:21:55,545 --> 00:21:58,187
It's all imagined gameplay and these situations will happen.

422
00:21:58,768 --> 00:22:04,352
The only thing that we needed to tune actually was to disable fighting for animals in virtual

423
00:22:04,392 --> 00:22:08,495
space as there were dead bodies everywhere in the world and we wanted to avoid that.

424
00:22:12,738 --> 00:22:14,379
We have groups in the world.

425
00:22:14,659 --> 00:22:17,301
We have two types of groups in virtual space.

426
00:22:18,818 --> 00:22:19,558
It's a video.

427
00:22:20,079 --> 00:22:21,459
So the first one is the art group,

428
00:22:23,340 --> 00:22:24,421
like the bodyguard here.

429
00:22:24,821 --> 00:22:27,703
When you have an art group, the group is created at spawn time.

430
00:22:28,723 --> 00:22:30,784
And the followers will target the leader

431
00:22:30,844 --> 00:22:32,065
and always follow the leader.

432
00:22:32,085 --> 00:22:35,907
And if you kill the leader, then the group will be deleted.

433
00:22:39,341 --> 00:22:40,882
And you have the soft group.

434
00:22:41,522 --> 00:22:44,184
In this case, the groups are created at runtime.

435
00:22:44,544 --> 00:22:47,406
If you have multiple objects from the same factions that

436
00:22:47,466 --> 00:22:50,107
are navigating to the same target,

437
00:22:50,567 --> 00:22:53,709
they will automatically create a group and navigate together.

438
00:22:54,870 --> 00:22:56,130
One leader will be elected.

439
00:22:56,471 --> 00:22:58,892
But if you kill this leader, another one will be elected.

440
00:22:58,912 --> 00:23:00,913
And as soon as a group is created,

441
00:23:00,933 --> 00:23:03,775
they will try to always select the same target.

442
00:23:09,725 --> 00:23:11,525
So to summarize the Meta-AI, what it is,

443
00:23:12,146 --> 00:23:15,747
it's 50,000 static objects, 12,000 dynamic objects

444
00:23:16,247 --> 00:23:17,727
that are moving on the AI network

445
00:23:18,408 --> 00:23:20,128
in virtual real or bulk,

446
00:23:20,849 --> 00:23:23,650
and with needs that will push virtual behaviors.

447
00:23:24,110 --> 00:23:25,230
So that's a lot of data,

448
00:23:25,310 --> 00:23:27,211
and I'm going now to talk about performances

449
00:23:27,431 --> 00:23:28,771
and troubleshooting for that.

450
00:23:31,513 --> 00:23:33,074
The first thing that we need to do,

451
00:23:33,094 --> 00:23:34,255
I'm not going to play this video,

452
00:23:34,575 --> 00:23:36,155
it's during the white room,

453
00:23:36,235 --> 00:23:38,496
we are pre-rolling all the objects.

454
00:23:38,516 --> 00:23:40,357
That means that we are going to update them

455
00:23:40,377 --> 00:23:44,058
a couple of times, like 10 times with a big DT

456
00:23:44,098 --> 00:23:46,459
between 75 and 150 seconds.

457
00:23:46,919 --> 00:23:48,520
And the goal is to spread them

458
00:23:48,980 --> 00:23:51,081
and to ensure that when you're starting the game,

459
00:23:51,421 --> 00:23:53,262
everything is not at the same place

460
00:23:53,342 --> 00:23:55,523
and the world seems alive as soon as you're starting.

461
00:23:57,950 --> 00:23:58,931
Then we need to update.

462
00:23:59,471 --> 00:24:01,432
So this is one frame of the game.

463
00:24:02,072 --> 00:24:04,033
At the beginning of the frame, we are going to update

464
00:24:04,393 --> 00:24:05,934
all the groups, all the avoidance,

465
00:24:06,134 --> 00:24:07,274
and to manage the spawning.

466
00:24:08,115 --> 00:24:09,896
Then, and this is single-threaded,

467
00:24:10,636 --> 00:24:11,977
it's around one millisecond.

468
00:24:12,877 --> 00:24:14,578
In the middle of the frame, we are going to update

469
00:24:14,658 --> 00:24:16,519
all the spawn units, that's when you have a bulk

470
00:24:16,539 --> 00:24:17,379
or a real entity.

471
00:24:18,299 --> 00:24:20,320
We are going to update only the root entity,

472
00:24:20,520 --> 00:24:23,402
the root, sorry, object that will update its hierarchy.

473
00:24:24,042 --> 00:24:27,203
And it's multi-threaded, and it's seven to 10 milliseconds.

474
00:24:28,284 --> 00:24:29,508
And at the end of the frame, we're

475
00:24:29,548 --> 00:24:30,953
going to update the meta object.

476
00:24:31,902 --> 00:24:36,583
But it's going to be time-sliced because we just want them to be ticked every 15 seconds.

477
00:24:36,603 --> 00:24:42,225
So we just have a budget of 1 to 3 milliseconds single thread, and we will adapt this budget

478
00:24:42,245 --> 00:24:44,485
to ensure that they are updated every 15 seconds.

479
00:24:45,205 --> 00:24:50,907
And if you need a pass along the I-network, then we are going to create a pass request.

480
00:24:51,447 --> 00:24:53,588
And this is going to be an asynchronous task.

481
00:24:53,988 --> 00:24:58,189
It's actually going to use a CPU idle time from the processor.

482
00:25:00,573 --> 00:25:03,254
Then we need to debug that because that's a lot of data.

483
00:25:03,635 --> 00:25:04,975
So how do we debug that?

484
00:25:06,156 --> 00:25:09,257
We have some automated smoke test that we can run.

485
00:25:13,278 --> 00:25:15,519
So we can, ah, no, no, no, no, no.

486
00:25:25,177 --> 00:25:28,760
So we can, NVid is our editor and we can load a test map

487
00:25:29,040 --> 00:25:32,142
in our editor and ensure that there is no regression.

488
00:25:32,462 --> 00:25:35,384
So here we have some guys navigating, some guys fighting.

489
00:25:35,644 --> 00:25:37,706
So we can load that and ensure that nothing

490
00:25:37,726 --> 00:25:38,926
has been broken by a change.

491
00:25:44,340 --> 00:25:49,222
We are using a lot of telemetry, and we are sending a lot of data when someone is playing

492
00:25:49,282 --> 00:25:49,522
a game.

493
00:25:49,582 --> 00:25:53,523
So as soon as someone is playing the game, we are tracking everything that he's doing,

494
00:25:53,664 --> 00:25:56,385
and we can replay all this data in telemetry.

495
00:25:56,825 --> 00:26:01,727
So we can check all the time where was the player, and how many dynamic objects were

496
00:26:01,747 --> 00:26:03,748
created, how many static objects, things like that.

497
00:26:05,088 --> 00:26:07,249
So it's really useful to detect regressions.

498
00:26:09,163 --> 00:26:11,125
Every night we were doing a performance walkthrough.

499
00:26:11,145 --> 00:26:14,048
That means that we were teleporting the player every 15

500
00:26:14,388 --> 00:26:17,992
meters, loading everything, and doing a performance capture.

501
00:26:18,512 --> 00:26:20,574
But we were not only capturing the CPU.

502
00:26:25,202 --> 00:26:26,203
capturing everything.

503
00:26:26,743 --> 00:26:30,227
And after that, we can open the result in our browser,

504
00:26:30,307 --> 00:26:30,687
in a map.

505
00:26:30,868 --> 00:26:32,389
So here, that's a performance map.

506
00:26:32,750 --> 00:26:36,113
I can see the areas where we are not running at 30 FPS,

507
00:26:36,153 --> 00:26:37,635
and I can open a performance file.

508
00:26:38,135 --> 00:26:40,618
But since we are recording everything with telemetry,

509
00:26:41,239 --> 00:26:44,142
I can also check the number of dynamic objects.

510
00:26:45,630 --> 00:26:47,811
and get a heat map of all those dynamic objects

511
00:26:48,151 --> 00:26:51,133
and I can focus so I can see if an area is too populated

512
00:26:51,273 --> 00:26:54,135
or if there are not enough NPCs in this area

513
00:26:54,215 --> 00:26:55,695
or too many animals, we can track that.

514
00:26:56,116 --> 00:26:58,057
And obviously also to detect leaks.

515
00:27:02,779 --> 00:27:04,941
Finally, we have nightly reports.

516
00:27:08,743 --> 00:27:09,623
We have nightly reports.

517
00:27:10,955 --> 00:27:15,358
Every night we were doing a lot of tests, like checking if two static objects are still

518
00:27:15,398 --> 00:27:17,719
connected and if it's important for a mission.

519
00:27:18,119 --> 00:27:22,902
And every morning we could receive the report saying how many errors were created.

520
00:27:22,922 --> 00:27:27,184
And I'm not going to talk a lot about that because there was a talk yesterday from Nicola

521
00:27:27,204 --> 00:27:27,965
Ruti about that.

522
00:27:28,525 --> 00:27:32,768
And if you haven't seen it, I would suggest you to watch it on the Vault.

523
00:27:36,066 --> 00:27:40,570
Now, performances, we switched from less than 100 to 200 NPCs,

524
00:27:40,630 --> 00:27:43,213
and we needed to do that because our spawning radius is

525
00:27:43,253 --> 00:27:43,994
bigger than before.

526
00:27:45,055 --> 00:27:48,518
So we needed to optimize those NPCs, and especially

527
00:27:48,578 --> 00:27:50,840
the ones that are between 60 and 80 meters,

528
00:27:50,880 --> 00:27:53,463
because that's a change in our spawning radius.

529
00:27:53,983 --> 00:27:55,965
So we have introduced two new techs for that.

530
00:27:57,717 --> 00:28:00,817
The first one is a component LOD for load and demand.

531
00:28:01,138 --> 00:28:03,778
We already had LOD for our visual components,

532
00:28:04,198 --> 00:28:05,599
but not for every component.

533
00:28:06,039 --> 00:28:08,460
And a lot of components were doing something like saying,

534
00:28:08,740 --> 00:28:10,280
oh, if I'm too far from the player,

535
00:28:10,300 --> 00:28:12,521
maybe you don't need to tick me.

536
00:28:12,661 --> 00:28:14,261
But you know that the best optimization

537
00:28:14,441 --> 00:28:15,662
is to not call a function.

538
00:28:16,202 --> 00:28:18,323
So what we did is introduce a component LOD

539
00:28:18,403 --> 00:28:19,503
for all the components.

540
00:28:20,083 --> 00:28:20,983
And you can be in low.

541
00:28:21,665 --> 00:28:24,970
medium or high and visible or invisible.

542
00:28:25,010 --> 00:28:26,792
So that's six LODs.

543
00:28:27,413 --> 00:28:29,196
And you can decide if you're going to switch

544
00:28:29,236 --> 00:28:32,300
from one component to another according to your distance

545
00:28:33,021 --> 00:28:35,905
or if you have a budget like 10 high visible

546
00:28:36,305 --> 00:28:37,347
and you can even mix both.

547
00:28:38,519 --> 00:28:43,742
And when according to your LOD you can decide to disable completely a component or to reduce

548
00:28:43,922 --> 00:28:50,406
the update frequency or even to be notified and for example in our AI component we are

549
00:28:51,106 --> 00:28:56,429
turning off the head look at when you are in low even visible because it's not something

550
00:28:56,449 --> 00:28:58,090
that you can see when you are far from the player.

551
00:28:59,991 --> 00:29:02,672
The second take is a bulk animation.

552
00:29:04,380 --> 00:29:07,181
So we've seen that the bugs are animated,

553
00:29:07,541 --> 00:29:09,482
but the animation is not as good as the one

554
00:29:10,623 --> 00:29:11,463
from the real entity.

555
00:29:11,804 --> 00:29:13,684
But what we can do is to update the bug

556
00:29:14,165 --> 00:29:17,907
and to copy the animation from the bug on the real entity

557
00:29:18,407 --> 00:29:19,647
when they are far from the player.

558
00:29:19,667 --> 00:29:22,809
Hopefully this is going to...

559
00:29:25,150 --> 00:29:27,391
That's two videos, that's more complicated.

560
00:29:27,411 --> 00:29:27,491
Okay.

561
00:29:34,778 --> 00:29:36,439
So this one here is a real animation.

562
00:29:37,899 --> 00:29:39,599
You can see that the fingers are animated,

563
00:29:39,639 --> 00:29:41,160
that the feet are not sliding.

564
00:29:41,180 --> 00:29:43,420
So it's a good looking animation.

565
00:29:43,520 --> 00:29:46,120
And here you have the bulk animation.

566
00:29:49,861 --> 00:29:52,762
So with the bulk animation, the fingers are not animated.

567
00:29:53,502 --> 00:29:54,722
The feet are slightly sliding,

568
00:29:55,122 --> 00:29:57,922
but if you are at 80 meters or 60 meters away

569
00:29:57,982 --> 00:30:00,043
from the player, you couldn't make a difference

570
00:30:00,083 --> 00:30:01,123
between those two animations.

571
00:30:01,863 --> 00:30:02,883
I apologize, nobody.

572
00:30:03,323 --> 00:30:03,683
One of the.

573
00:30:04,391 --> 00:30:06,012
If you are playing one on top of each other,

574
00:30:06,032 --> 00:30:07,432
you could see the difference.

575
00:30:10,854 --> 00:30:12,875
Okay, so that's the Meta-AI.

576
00:30:14,055 --> 00:30:15,196
It's something quite powerful,

577
00:30:15,236 --> 00:30:17,077
but we still need to improve some things.

578
00:30:18,237 --> 00:30:20,678
First, we have two navigation services.

579
00:30:21,799 --> 00:30:24,820
One for the spawn space and along the nav mesh,

580
00:30:25,000 --> 00:30:27,741
and one in bulk or virtual along the world path.

581
00:30:28,402 --> 00:30:29,442
And what can happen is,

582
00:30:30,314 --> 00:30:33,396
You have an NPC that is quite far away from the AI network.

583
00:30:34,177 --> 00:30:36,798
And the reason for that could be that he was in a fight

584
00:30:36,898 --> 00:30:38,679
and he went far away from the AI network.

585
00:30:39,520 --> 00:30:42,022
Now, we are going to unload this cell.

586
00:30:42,042 --> 00:30:44,543
It's going to switch from real to bulk.

587
00:30:45,124 --> 00:30:46,965
And now he cannot navigate anymore on the nav mesh,

588
00:30:46,985 --> 00:30:51,168
so he will try to reach the AI network

589
00:30:51,708 --> 00:30:54,230
and do a straight line to the closest node.

590
00:30:55,360 --> 00:30:56,721
and if the player is coming back,

591
00:30:57,181 --> 00:30:59,663
well, he will respawn inside this pyramid.

592
00:31:00,303 --> 00:31:01,804
And this is actually happening in the game,

593
00:31:01,964 --> 00:31:03,145
and that's not something good.

594
00:31:03,505 --> 00:31:04,546
It was not happening a lot.

595
00:31:05,026 --> 00:31:06,607
We have a few solutions for that,

596
00:31:06,727 --> 00:31:08,208
but it was still sometimes happening.

597
00:31:11,630 --> 00:31:16,853
Also for a long time during the project we were not enforcing the density in the world

598
00:31:17,574 --> 00:31:22,056
and you could have a market with a lot of valid spots that could attract a lot of people

599
00:31:22,696 --> 00:31:27,979
but if everybody's coming it's very likely that we will have more than 200 dynamic objects

600
00:31:28,019 --> 00:31:30,561
nearby and that we cannot spawn all of them.

601
00:31:31,521 --> 00:31:33,082
So what we did is...

602
00:31:35,669 --> 00:31:40,253
to create a grid and they are all registered in a grid of 40 by 40 meters

603
00:31:40,774 --> 00:31:46,138
and in each cell you can have a maximum of 16 dynamic objects and this

604
00:31:46,218 --> 00:31:49,041
will include the ones that are inside this cell and the ones that are

605
00:31:49,081 --> 00:31:55,386
targeting an object inside this cell. And when the cell is full they will try to

606
00:31:55,446 --> 00:31:59,489
select a target that is in another cell to try to spread everything.

607
00:32:00,497 --> 00:32:02,979
It's going to be only for non-monetary NPCs,

608
00:32:03,079 --> 00:32:06,922
so not for the mission NPCs or for the merchants in the cities.

609
00:32:09,884 --> 00:32:20,751
But if you have an interior, like here I'm going in an interior,

610
00:32:20,771 --> 00:32:24,414
you have a lot of dynamic objects inside these interiors.

611
00:32:24,734 --> 00:32:27,216
And they're going to use a density, because in virtual,

612
00:32:27,256 --> 00:32:28,737
we don't really know that it's an interior.

613
00:32:29,277 --> 00:32:29,397
And...

614
00:32:30,147 --> 00:32:31,648
When you're outside, they will not be spawned,

615
00:32:31,668 --> 00:32:33,470
they will still use an entity,

616
00:32:33,490 --> 00:32:34,952
so we are kind of wasting them.

617
00:32:42,160 --> 00:32:44,682
Finally, we don't manage emotions,

618
00:32:44,762 --> 00:32:49,067
and it's possible for NPC to be part of a cinematic,

619
00:32:49,327 --> 00:32:50,188
but it doesn't know that.

620
00:32:54,022 --> 00:32:55,663
And he has taken it.

621
00:32:55,923 --> 00:32:57,925
This is one of the saddest cinematic of the game.

622
00:32:58,005 --> 00:32:59,567
It's a funeral of a little girl.

623
00:33:00,347 --> 00:33:02,409
And well, you will see what happened in the wet square.

624
00:33:02,449 --> 00:33:03,330
Anything for Ramos.

625
00:33:05,212 --> 00:33:06,593
He will pay for this.

626
00:33:07,054 --> 00:33:09,056
And all those who serve him.

627
00:33:15,341 --> 00:33:17,443
So it's something that we cannot really control.

628
00:33:23,208 --> 00:33:24,749
Finally, Quest and Meta-AI.

629
00:33:24,789 --> 00:33:26,710
So Quest are using the Meta-AI.

630
00:33:28,131 --> 00:33:31,914
First, they will acquire objects from the Meta-AI.

631
00:33:32,054 --> 00:33:36,877
It can be a specific target, like Cleopatra.

632
00:33:37,237 --> 00:33:41,020
Or it can be just a guard, level 15, or I don't know what.

633
00:33:41,400 --> 00:33:43,241
Just a specific guard if they just

634
00:33:43,281 --> 00:33:46,103
need someone to play a view or something like that,

635
00:33:46,123 --> 00:33:46,904
to play a bark.

636
00:33:48,423 --> 00:33:50,344
We have introduced new scripting operators

637
00:33:50,404 --> 00:33:52,905
and new virtual conditions, so they can push schedules

638
00:33:52,965 --> 00:33:56,387
on those dynamic objects, and they can check their position.

639
00:33:57,888 --> 00:34:00,149
We have some very specific behaviors for quests,

640
00:34:00,609 --> 00:34:02,390
like the stand still and the scripted go-to.

641
00:34:04,591 --> 00:34:06,872
But the good thing is now, mission,

642
00:34:07,152 --> 00:34:08,753
stand still is used, sorry, for cinematics,

643
00:34:08,833 --> 00:34:11,294
and scripted go-to, it's when we are navigating somewhere,

644
00:34:11,334 --> 00:34:12,754
but we want to have a dialogue happening

645
00:34:12,774 --> 00:34:14,295
at the same time, or something like that.

646
00:34:15,295 --> 00:34:17,016
But the good thing is now mission designers

647
00:34:17,076 --> 00:34:17,596
are going to.

648
00:34:18,189 --> 00:34:22,491
push goals on the NPCs instead of micro-managing their behaviors.

649
00:34:22,791 --> 00:34:29,175
So this guy will be able to react and adapt to what's going on.

650
00:34:29,635 --> 00:34:31,976
So here I have a quest.

651
00:34:33,277 --> 00:34:34,237
Here we have a rebel.

652
00:34:34,978 --> 00:34:38,980
The rebel in this mission has to go to the ruined fort and he can use a horse.

653
00:34:40,725 --> 00:34:44,946
Sophia is here to follow the rebel and she must wait for the player.

654
00:34:45,866 --> 00:34:49,307
And Bayek is here, in this quest he has to escort Sophia.

655
00:34:49,787 --> 00:34:53,007
And during this quest he's an opponent to bandits. We have bandits in the world

656
00:34:53,448 --> 00:34:55,748
and here you are an opponent of the bandits.

657
00:34:59,289 --> 00:35:00,249
Let's play that.

658
00:35:01,509 --> 00:35:03,329
Attack on a nearby encampment.

659
00:35:03,789 --> 00:35:05,330
There are more soldiers than we thought.

660
00:35:05,830 --> 00:35:07,570
You're going to cross the path of a bandit.

661
00:35:08,330 --> 00:35:09,050
How many wounded?

662
00:35:10,053 --> 00:35:16,859
Enough. That's why being close to their mind is so important.

663
00:35:16,939 --> 00:35:20,982
And the fight is going to start. So it's not something scripted,

664
00:35:21,043 --> 00:35:27,088
it's not part of the quest, it's just systemic. So everybody's fighting.

665
00:35:27,108 --> 00:35:29,670
Okay, he's dead.

666
00:35:38,080 --> 00:35:40,882
So now everybody is going to resume his goal, they know what they have to do.

667
00:35:42,082 --> 00:35:43,403
So he's going to go back on his horse,

668
00:35:43,423 --> 00:35:46,165
Sofia is going to go back because she needs to follow him.

669
00:35:46,305 --> 00:35:49,346
They're going to recompute a new path on the iNetwork,

670
00:35:49,887 --> 00:35:51,287
and they will resume what they have to do.

671
00:35:51,327 --> 00:35:52,788
So it's really good for us.

672
00:35:52,828 --> 00:35:55,710
That means that we can start a quest anywhere in the world.

673
00:35:55,750 --> 00:35:59,132
We don't have to put the mission giver at a very specific location.

674
00:35:59,152 --> 00:36:00,072
He can move around.

675
00:36:00,552 --> 00:36:02,393
It's really, really powerful for us to do that.

676
00:36:07,928 --> 00:36:09,550
And there was, during the high summits,

677
00:36:09,570 --> 00:36:13,134
there was a talk from Jean-Marie Santini about the quest.

678
00:36:13,455 --> 00:36:15,477
If you want to look at that, it will be also on the vault.

679
00:36:20,403 --> 00:36:20,603
So.

680
00:36:23,507 --> 00:36:23,587
So.

681
00:36:25,935 --> 00:36:26,795
Was that something good?

682
00:36:27,175 --> 00:36:29,577
Yes, I think it has created a lot of opportunities.

683
00:36:30,037 --> 00:36:32,638
Obviously, we had to change a lot of the code.

684
00:36:32,678 --> 00:36:33,639
It was a big change.

685
00:36:34,099 --> 00:36:36,841
And some people seem to have lost control

686
00:36:37,101 --> 00:36:39,862
about what they were doing, because before it

687
00:36:39,902 --> 00:36:42,984
was way simpler for an animator to create a station

688
00:36:43,044 --> 00:36:45,846
and to ensure that there was always somebody in the station.

689
00:36:45,866 --> 00:36:49,368
Now the NPC has to decide that he wants to go to the station.

690
00:36:50,128 --> 00:36:52,489
But we have unified a lot of the code.

691
00:36:52,609 --> 00:36:53,930
Everything is now done.

692
00:36:54,630 --> 00:36:57,372
In the dynamic object, in these behaviors,

693
00:36:57,752 --> 00:37:00,733
it's not done from something outside the NPC.

694
00:37:01,154 --> 00:37:04,015
So it was a lot of work, but at the end, I think it was good.

695
00:37:04,035 --> 00:37:07,216
And thank you for following that.

696
00:37:07,517 --> 00:37:13,099
And if you have questions, I'm happy to answer.

697
00:37:13,219 --> 00:37:13,520
Thank you.

698
00:37:31,328 --> 00:37:32,049
I have a question.

699
00:37:34,351 --> 00:37:40,915
When you're in Assassin's Creed Origins and you have the eagle flying, Bayek can be riding

700
00:37:40,975 --> 00:37:42,876
on his horse to some destination.

701
00:37:43,577 --> 00:37:47,800
If the eagle gets far enough away, does Bayek also become bulk or virtual?

702
00:37:47,820 --> 00:37:49,040
No, he's never becoming bulk.

703
00:37:49,341 --> 00:37:52,683
He's going always to stay spawned and even the horse is going to stay spawned.

704
00:37:53,143 --> 00:37:55,104
But you cannot move at this point.

705
00:37:55,164 --> 00:37:57,946
At some point he will stop moving and only the eagle will be moving.

706
00:37:58,747 --> 00:37:59,407
Okay, thank you.

707
00:38:02,499 --> 00:38:07,542
you for that excellent talk. Couple questions. Can you speak at all to how the virtual node

708
00:38:07,582 --> 00:38:11,965
network was actually, because you said it could be automatically placed. Can you say anything

709
00:38:11,985 --> 00:38:12,645
about how that was done?

710
00:38:14,246 --> 00:38:16,007
Yes, but that would be a full talk.

711
00:38:16,368 --> 00:38:20,351
Basically, if you have a road, it can be automatically generated on the road.

712
00:38:20,611 --> 00:38:25,916
You can also just create two nodes and create a link and at build time we will ensure that

713
00:38:26,096 --> 00:38:29,479
we are creating a path on the nav mesh and play some nodes.

714
00:38:30,520 --> 00:38:31,501
We can do a lot of things.

715
00:38:31,521 --> 00:38:33,683
We have some templates that we can drag and drop.

716
00:38:35,765 --> 00:38:37,627
There's plenty of ways to do that.

717
00:38:40,019 --> 00:38:44,002
Is, sorry one more question, do the bulks have any collision at all?

718
00:38:44,622 --> 00:38:48,065
They can do avoidance, they don't have collisions, but they can do avoidance.

719
00:38:48,445 --> 00:38:53,908
We don't do that between humans, but when we have carts or boats, we need them to avoid each other.

720
00:38:53,928 --> 00:38:57,070
So there is no physics, but they have collision, they have avoidance.

721
00:38:57,251 --> 00:38:58,672
Could the player like shoot an arrow at one of them?

722
00:38:59,395 --> 00:39:02,737
No, that's why we have a bigger spawning radius actually,

723
00:39:02,777 --> 00:39:04,478
because we have the Predator bow,

724
00:39:04,918 --> 00:39:07,300
and you can shoot at 80 meters with the Predator bow.

725
00:39:07,560 --> 00:39:09,381
So we need to ensure that everybody spawn,

726
00:39:09,542 --> 00:39:11,803
as you could shoot through a bulk,

727
00:39:11,843 --> 00:39:13,344
and that would not be good.

728
00:39:13,744 --> 00:39:14,265
Okay, thank you.

729
00:39:16,186 --> 00:39:17,807
He literally just asked my question, so.

730
00:39:20,243 --> 00:39:21,863
So I had two questions.

731
00:39:22,623 --> 00:39:25,984
First of all, you're using NavMesh and also network,

732
00:39:26,084 --> 00:39:27,424
like the AI network.

733
00:39:27,764 --> 00:39:29,925
Is it a performance reason that you have both?

734
00:39:30,025 --> 00:39:30,765
Like, while you move to it?

735
00:39:30,885 --> 00:39:31,785
It's a memory reason.

736
00:39:31,825 --> 00:39:33,266
There's no way we can load that.

737
00:39:33,666 --> 00:39:35,786
I think our budget for the NavMesh

738
00:39:35,846 --> 00:39:39,127
is something like 20 megabytes, and it's

739
00:39:39,207 --> 00:39:40,267
only for a couple of cells.

740
00:39:40,347 --> 00:39:42,908
If we are loading Egypt, it would be almost

741
00:39:43,068 --> 00:39:44,008
all the memory of the game.

742
00:39:44,448 --> 00:39:49,392
Okay, and my other question was, you were talking about the behavior and the needs

743
00:39:49,993 --> 00:39:54,737
and the camp that had guards and some were sleeping and some were still guarding.

744
00:39:55,458 --> 00:39:59,782
What was deciding which one was sleeping, to make sure not everybody goes to sleep?

745
00:40:01,143 --> 00:40:06,447
It's the resources. We wouldn't place 10 beds in a camp with seven guards,

746
00:40:06,868 --> 00:40:10,671
so the level designers will ensure that there is not too many resources.

747
00:40:11,732 --> 00:40:14,114
And they came to prevent that from happening.

748
00:40:14,254 --> 00:40:16,857
Thank you.

749
00:40:18,459 --> 00:40:19,280
I have one question.

750
00:40:19,320 --> 00:40:21,542
This might just be some confusion on my part.

751
00:40:21,702 --> 00:40:27,268
With the grid system that limits how many dynamic objects can

752
00:40:27,348 --> 00:40:32,514
be spawned within a given area, in combat, if

753
00:40:33,422 --> 00:40:40,909
If it's possible for like guards or whoever to kind of rush into one square on that grid,

754
00:40:41,029 --> 00:40:43,191
could that be overloaded or how does that work?

755
00:40:45,493 --> 00:40:50,177
I don't think that we would, that our fight system would attract so many people because

756
00:40:50,217 --> 00:40:54,040
the fight is already quite expensive, so we wouldn't want to have a fight with so many

757
00:40:54,060 --> 00:40:58,444
people, so I don't think that the fight will attract so many people, that many people.

758
00:41:04,567 --> 00:41:05,528
Hey, yeah, thanks.

759
00:41:05,628 --> 00:41:08,669
Great talk, by the way, despite the video things.

760
00:41:09,549 --> 00:41:11,530
I was wondering, so you said that your budget

761
00:41:11,590 --> 00:41:14,611
for real NPCs is 200.

762
00:41:15,471 --> 00:41:16,992
What's your budget for combat NPCs?

763
00:41:18,733 --> 00:41:20,693
I think it should be around 40.

764
00:41:20,833 --> 00:41:21,954
I think we have a maximum of 40.

765
00:41:22,114 --> 00:41:23,374
All right, thank you.

766
00:41:28,997 --> 00:41:30,297
Okay, thank you very much.

