1
00:00:08,564 --> 00:00:12,848
Hello everyone, as Dave said, my name is Eric Martel.

2
00:00:12,848 --> 00:00:15,550
I've been a lead AI programmer at Ubisoft Quebec

3
00:00:15,550 --> 00:00:17,332
for two and a half years.

4
00:00:17,332 --> 00:00:21,476
And well, thanks for giving me the opportunity

5
00:00:21,476 --> 00:00:24,739
to talk a bit about vehicle AI and NPC AI,

6
00:00:24,739 --> 00:00:27,261
more specifically towards the usage

7
00:00:27,261 --> 00:00:28,622
of vehicles in video games.

8
00:00:30,163 --> 00:00:33,887
So just to talk a bit about my credentials,

9
00:00:33,887 --> 00:00:37,110
I started in 2001 at a small company in Montreal

10
00:00:37,110 --> 00:00:38,652
called Mikraids.

11
00:00:38,652 --> 00:00:43,217
There I developed Cyberia, Postmortem, and Cyberia 2.

12
00:00:43,217 --> 00:00:45,419
Those are all point and click adventure games.

13
00:00:45,820 --> 00:00:50,224
Then in 2004 I was fortunate enough to join Ubisoft Montreal

14
00:00:50,224 --> 00:00:53,548
where I developed Far Cry Instincts,

15
00:00:53,548 --> 00:00:57,632
which is the port of the well-known PC game Far Cry

16
00:00:57,632 --> 00:00:59,654
on the first Xbox.

17
00:00:59,654 --> 00:01:04,840
And then I was truly blessed to work on the initial title

18
00:01:04,840 --> 00:01:06,802
of the Assassin's Creed franchise.

19
00:01:08,251 --> 00:01:12,594
In 2008, I joined ADOS Montreal where I had the opportunity

20
00:01:12,594 --> 00:01:14,776
to work on the TEEF reboot.

21
00:01:14,776 --> 00:01:19,079
And more recently, in 2013, I joined Ubisoft Quebec

22
00:01:19,079 --> 00:01:23,282
where I was able to work on Unity and more recently,

23
00:01:23,282 --> 00:01:24,463
Syndicate.

24
00:01:24,463 --> 00:01:26,545
This talk will be mostly about Syndicate.

25
00:01:28,105 --> 00:01:31,587
Also, I was fortunate to work with Matt Buckland

26
00:01:31,587 --> 00:01:34,328
on the programming game AI by example.

27
00:01:34,328 --> 00:01:36,109
I was a technical reviewer on this.

28
00:01:36,109 --> 00:01:40,332
I published in the AI game programming with some three,

29
00:01:40,332 --> 00:01:42,833
the Far Cry anchor system.

30
00:01:42,833 --> 00:01:44,113
It's basically smart objects.

31
00:01:44,113 --> 00:01:48,115
If you guys need some, it's an interesting article.

32
00:01:48,115 --> 00:01:51,097
And more recently, I published in Game AI Pro.

33
00:01:52,878 --> 00:01:55,980
a system on to build third person camera systems.

34
00:01:55,980 --> 00:02:00,342
As you might know, the Game AI books

35
00:02:00,342 --> 00:02:02,323
are now open source for the first one,

36
00:02:02,323 --> 00:02:04,365
so you can easily go check it out

37
00:02:04,365 --> 00:02:06,246
and see the articles for free.

38
00:02:06,246 --> 00:02:10,648
Back to our main topic, Assassin's Creed Syndicate.

39
00:02:12,450 --> 00:02:14,330
Assassin's Creed Syndicate can be defined

40
00:02:14,330 --> 00:02:16,090
by five core pillars.

41
00:02:16,090 --> 00:02:18,791
First, you have navigation, which includes parkour.

42
00:02:18,791 --> 00:02:21,171
I would say that Assassin's Creed

43
00:02:21,171 --> 00:02:25,072
is probably the best game in the industry.

44
00:02:25,072 --> 00:02:28,293
If you talk about parkour, the player is allowed

45
00:02:28,293 --> 00:02:32,033
to climb almost anywhere, perform many parkour tricks.

46
00:02:32,033 --> 00:02:37,014
There's also a big part of it that's about fight.

47
00:02:37,014 --> 00:02:39,755
Fight, in our case, includes assassinations.

48
00:02:39,755 --> 00:02:42,055
We support many types of assassinations.

49
00:02:43,959 --> 00:02:48,363
We have a big part of the game that's about the story.

50
00:02:48,363 --> 00:02:50,666
We try to be history relevant.

51
00:02:50,666 --> 00:02:52,949
So we take a time period and we try

52
00:02:52,949 --> 00:02:56,633
to adapt it and tell a great story

53
00:02:56,633 --> 00:02:58,315
with some historical elements.

54
00:02:59,416 --> 00:03:00,637
It's also about explorations.

55
00:03:00,637 --> 00:03:04,458
The cities are usually very huge,

56
00:03:04,458 --> 00:03:08,480
and it allows the player to explore the environment

57
00:03:08,480 --> 00:03:11,542
and reusing the navigation and parkour,

58
00:03:11,542 --> 00:03:14,943
it allows us to give a great challenge to the player.

59
00:03:14,943 --> 00:03:16,844
There's also the stealth part,

60
00:03:16,844 --> 00:03:19,706
which is basically hiding,

61
00:03:19,706 --> 00:03:22,727
and it goes again with the assassination

62
00:03:22,727 --> 00:03:24,108
by using stealth mechanics.

63
00:03:26,356 --> 00:03:29,338
The setting for our game decided by the creative direction

64
00:03:29,338 --> 00:03:31,860
was to go with Victorian London.

65
00:03:31,860 --> 00:03:37,484
We were reusing a lot of the code from Assassin's Creed Unity

66
00:03:37,484 --> 00:03:40,245
and we decided to reuse the road system

67
00:03:40,245 --> 00:03:43,588
and add sidewalks and traffic for vehicles.

68
00:03:43,588 --> 00:03:47,490
Basically, our goal was to allow to have a civilized city

69
00:03:47,490 --> 00:03:52,154
where people are following traffic rules

70
00:03:52,154 --> 00:03:53,595
and walk on sidewalks.

71
00:03:55,926 --> 00:03:59,611
We also wanted the crowd to integrate fully with vehicles,

72
00:03:59,611 --> 00:04:02,895
so as to have a living and breathing world

73
00:04:02,895 --> 00:04:06,861
where NPCs just move freely on the streets

74
00:04:06,861 --> 00:04:09,584
and NPCs from the sidewalks can also interact

75
00:04:09,584 --> 00:04:12,588
with the vehicles and use them if required.

76
00:04:14,730 --> 00:04:20,574
Luckily for us, Assassin's Creed Syndicate is the first Assassin's Creed where the time

77
00:04:20,574 --> 00:04:22,656
period is after the invention of the camera.

78
00:04:22,656 --> 00:04:27,340
So we had some footage of what it looked like in London back in the day.

79
00:04:27,340 --> 00:04:33,164
It confirmed to us that vehicles and crowd needed to blend together in order to give

80
00:04:33,164 --> 00:04:34,725
the player a great experience.

81
00:04:37,585 --> 00:04:42,647
The objectives for us were to support various types of

82
00:04:42,647 --> 00:04:47,189
carriages. If you played the game you can see that there are

83
00:04:47,189 --> 00:04:51,071
many types of carriages. Some are more for passengers, well

84
00:04:51,071 --> 00:04:54,692
for driving people around. Some are for the police,

85
00:04:54,692 --> 00:05:00,114
firefighters, etc. So they all have different number of horses,

86
00:05:00,114 --> 00:05:03,936
wheels, some have a cargo section, some have doors,

87
00:05:03,936 --> 00:05:05,697
they're all at different heights.

88
00:05:07,302 --> 00:05:09,283
They also follow the traffic rules.

89
00:05:09,283 --> 00:05:12,544
So given the road system, we were

90
00:05:12,544 --> 00:05:15,445
able to give the level designers tools

91
00:05:15,445 --> 00:05:19,527
to create lanes where the vehicles follow and stay

92
00:05:19,527 --> 00:05:21,728
on the right side of the lanes, which

93
00:05:21,728 --> 00:05:23,968
is hard for us North American.

94
00:05:23,968 --> 00:05:25,789
It's on the left side and not the right one.

95
00:05:26,995 --> 00:05:33,078
We also gave NPCs tools to navigate using vehicles.

96
00:05:33,078 --> 00:05:36,080
So any NPC, whether he's scripted or systemic,

97
00:05:36,080 --> 00:05:39,502
can just hop on a vehicle to go to his objective

98
00:05:39,502 --> 00:05:42,143
if the level designer gave him the rights to do so.

99
00:05:44,601 --> 00:05:48,303
We also wanted to integrate the fight on the vehicles

100
00:05:48,303 --> 00:05:50,265
and also using vehicles.

101
00:05:50,265 --> 00:05:53,687
Since you saw some of our pillars include navigation,

102
00:05:53,687 --> 00:05:56,209
we thought it would be interesting to allow the players

103
00:05:56,209 --> 00:05:59,992
to get on the vehicles and then fight the NPCs.

104
00:05:59,992 --> 00:06:03,514
And it's not only carriages, we also supported trains

105
00:06:03,514 --> 00:06:06,457
because we thought it would fit very well

106
00:06:06,457 --> 00:06:07,818
with the Victorian era.

107
00:06:07,818 --> 00:06:09,779
And we have boats on the Thames River.

108
00:06:12,091 --> 00:06:13,994
As for the prerequisite, like I said,

109
00:06:13,994 --> 00:06:16,357
we wanted to have a road network,

110
00:06:16,357 --> 00:06:22,344
which was edited by level designers to create,

111
00:06:22,344 --> 00:06:27,010
basically it was bound to the visual meshes of the streets.

112
00:06:27,010 --> 00:06:28,432
I'll come back to it a bit later.

113
00:06:30,421 --> 00:06:36,267
All of our vehicles are physics based, so for the first time in Assassin's Creed we

114
00:06:36,267 --> 00:06:44,396
had a very physical world where rigid bodies move around, so we had to take proper precaution

115
00:06:44,396 --> 00:06:49,121
for the NPCs to handle the handling of rigid bodies moving around.

116
00:06:51,512 --> 00:06:54,594
We also had to rework the navigation mesh system

117
00:06:54,594 --> 00:06:57,677
because we wanted to be able to detect path blocking

118
00:06:57,677 --> 00:07:00,580
whenever a vehicle would stop in an alleyway

119
00:07:00,580 --> 00:07:02,322
or in front of an objective.

120
00:07:02,322 --> 00:07:06,285
We reworked the steering system

121
00:07:06,285 --> 00:07:10,990
and we definitely had to change a bit the decision making

122
00:07:10,990 --> 00:07:12,211
to take into account vehicles.

123
00:07:13,621 --> 00:07:17,882
Lastly, we'll talk about the virtualization of NPCs,

124
00:07:17,882 --> 00:07:21,263
which is basically allowing NPCs to live for longer

125
00:07:21,263 --> 00:07:24,464
than their usual lifetime.

126
00:07:24,464 --> 00:07:27,945
In this presentation, since it's quite short,

127
00:07:27,945 --> 00:07:30,906
I'll be mostly talking about the navigation changes,

128
00:07:30,906 --> 00:07:34,207
the behavioral changes, and the virtualization.

129
00:07:34,207 --> 00:07:37,068
A lot more was required, but obviously

130
00:07:37,068 --> 00:07:40,429
with the time we have, I cannot talk about it,

131
00:07:40,429 --> 00:07:41,470
but feel free to come ask me

132
00:07:41,470 --> 00:07:43,050
if you have more specific questions.

133
00:07:44,229 --> 00:07:48,256
As for the navigation changes, it's not per se

134
00:07:48,256 --> 00:07:52,664
vehicle AI that's tackled here, but it's prerequisites

135
00:07:52,664 --> 00:07:55,709
in my opinion to have NPCs use property vehicles,

136
00:07:55,709 --> 00:07:57,913
so that's why we'll look into it.

137
00:07:59,683 --> 00:08:04,667
This is a debug display of the road network.

138
00:08:04,667 --> 00:08:07,910
If you're interested in knowing more about this system,

139
00:08:07,910 --> 00:08:10,752
there will be a talk Thursday from four to five

140
00:08:10,752 --> 00:08:13,054
called Assassin's Creed Syndicate.

141
00:08:13,054 --> 00:08:15,916
London wasn't built in one day by Damien Bastien,

142
00:08:15,916 --> 00:08:17,858
so feel free to go see it.

143
00:08:17,858 --> 00:08:19,539
He'll be explaining a bit the tools

144
00:08:19,539 --> 00:08:21,561
that we developed for level designers

145
00:08:21,561 --> 00:08:25,284
in order to build London, which is quite a big achievement.

146
00:08:27,260 --> 00:08:30,343
So going back to our vehicles,

147
00:08:30,343 --> 00:08:33,065
our vehicles are built in many parts,

148
00:08:33,065 --> 00:08:34,426
starting with the horse.

149
00:08:34,426 --> 00:08:38,949
The horses are a bit like a tractor in a Freightliner,

150
00:08:38,949 --> 00:08:42,232
so it's pulling the carriage into the direction

151
00:08:42,232 --> 00:08:44,113
that's been given by the player.

152
00:08:45,698 --> 00:08:48,182
We have various types of carriages.

153
00:08:48,182 --> 00:08:50,866
Some have beams on the side, some have doors.

154
00:08:50,866 --> 00:08:55,073
It's very varied, but it's all based on historical vehicles

155
00:08:55,073 --> 00:08:57,556
that were in London back then.

156
00:08:59,548 --> 00:09:01,849
Most of our vehicles have a joint in the middle,

157
00:09:01,849 --> 00:09:03,010
which you'll see a bit later,

158
00:09:03,010 --> 00:09:07,412
makes it a bit more complicated for steering the acers.

159
00:09:07,412 --> 00:09:08,912
In our case, it allowed the player

160
00:09:08,912 --> 00:09:12,334
to move the horse freely, laterally,

161
00:09:12,334 --> 00:09:15,515
and be able to go in whichever direction he chooses to

162
00:09:15,515 --> 00:09:20,077
without relying on wheel system like on a vehicle,

163
00:09:20,077 --> 00:09:20,857
on a car, sorry.

164
00:09:22,310 --> 00:09:26,251
And then we have two to six seats in our vehicles,

165
00:09:26,251 --> 00:09:29,452
allowing NPCs to just sit at these positions.

166
00:09:29,452 --> 00:09:32,933
We then added some bones to the meshes

167
00:09:32,933 --> 00:09:36,594
to be able to guide NPCs to specific places on the ground

168
00:09:36,594 --> 00:09:39,554
to then be able to interact and play a proper animation

169
00:09:39,554 --> 00:09:42,895
to either get on the vehicle or fight the player.

170
00:09:45,175 --> 00:09:49,096
So navigation mesh patching, what's patching?

171
00:09:49,096 --> 00:09:54,017
Basically, patching is technology where we punch a hole

172
00:09:54,017 --> 00:09:59,398
in the nav mesh using the rigid body size of the vehicle.

173
00:09:59,398 --> 00:10:03,679
This way, the triangles are altered and NPCs

174
00:10:03,679 --> 00:10:07,600
at the navigation level, at the path finding level

175
00:10:07,600 --> 00:10:10,461
are able to know whether the path is blocked or not.

176
00:10:12,874 --> 00:10:17,557
Most other games with simpler vehicles could have simply used steering behaviors to achieve that,

177
00:10:17,557 --> 00:10:23,502
but in our case, since the tractor has a joint, it was possible to create concave areas

178
00:10:23,502 --> 00:10:26,704
where NPCs could get stuck using only steering behaviors.

179
00:10:28,507 --> 00:10:32,650
Whenever a patch is applied, we go through all the NPCs

180
00:10:32,650 --> 00:10:34,871
that are in the surrounding area,

181
00:10:34,871 --> 00:10:37,453
and if they have a path that's using one of the triangle

182
00:10:37,453 --> 00:10:40,115
that's being patched, we simply cancel the path

183
00:10:40,115 --> 00:10:42,957
and ask the path finder to recompute a new path

184
00:10:42,957 --> 00:10:43,617
for that NPC.

185
00:10:44,853 --> 00:10:48,134
Here's what it looks like, it's debug display again,

186
00:10:48,134 --> 00:10:49,334
which gives you an idea.

187
00:10:49,334 --> 00:10:51,415
As soon as the vehicle will stabilize,

188
00:10:51,415 --> 00:10:54,976
you'll see that the triangles are re-computed

189
00:10:54,976 --> 00:10:59,297
and the grayer areas where NPCs are not allowed to walk.

190
00:10:59,297 --> 00:11:02,538
So if we get a better view of it,

191
00:11:02,538 --> 00:11:06,299
we start with the shape of the rigid bodies.

192
00:11:07,525 --> 00:11:11,376
We then define that whatever's outside of this is walkable,

193
00:11:11,376 --> 00:11:12,901
and then we triangulate.

194
00:11:12,901 --> 00:11:15,689
It's very simplified, but it gives you an idea.

195
00:11:18,137 --> 00:11:25,544
Since navigation mesh patching is obviously quite expensive to do, we cap the number of

196
00:11:25,544 --> 00:11:28,007
vehicles that are able to patch every frame.

197
00:11:28,007 --> 00:11:33,493
So in our case, we were satisfied with only a single vehicle, given that most of them

198
00:11:33,493 --> 00:11:37,817
are always in movement, we had great results with only patching one vehicle.

199
00:11:39,062 --> 00:11:41,504
We also prioritize them by distance.

200
00:11:41,504 --> 00:11:44,026
So obviously, whatever's closer to the player

201
00:11:44,026 --> 00:11:48,431
gets patched first, and then it disperses in the environment.

202
00:11:48,431 --> 00:11:54,757
The size of our carriages allow the player

203
00:11:54,757 --> 00:11:58,000
to step on the top of the vehicle.

204
00:11:59,192 --> 00:12:01,793
Since navigation is a big pillar in Assassin's Creed,

205
00:12:01,793 --> 00:12:03,054
we thought that it would be interesting

206
00:12:03,054 --> 00:12:04,314
to have NPCs go there as well.

207
00:12:04,314 --> 00:12:07,055
So we reused the same technology

208
00:12:07,055 --> 00:12:09,036
for navigation on the ground

209
00:12:09,036 --> 00:12:11,817
and applied it on the rooftop of vehicles.

210
00:12:11,817 --> 00:12:15,319
The same technology is used also on trains and boats,

211
00:12:15,319 --> 00:12:17,099
reusing the exact same algorithm.

212
00:12:17,099 --> 00:12:20,481
So it's symmetric navigation that's possible on the ground

213
00:12:20,481 --> 00:12:22,722
is possible on any of the vehicles.

214
00:12:24,827 --> 00:12:28,350
We also added whisker links, because we

215
00:12:28,350 --> 00:12:30,532
thought that it would be more interesting for players

216
00:12:30,532 --> 00:12:34,075
to have interactions between the dynamic navigation

217
00:12:34,075 --> 00:12:35,876
meshes and the static ones.

218
00:12:35,876 --> 00:12:40,080
So we use some cat-like whiskers surrounding the vehicles

219
00:12:40,080 --> 00:12:42,222
to find connections between a dynamic nav

220
00:12:42,222 --> 00:12:43,263
mesh and a static one.

221
00:12:45,368 --> 00:12:48,910
As soon as the vehicle patches, we run the algorithm

222
00:12:48,910 --> 00:12:51,792
and determine which whiskers should connect,

223
00:12:51,792 --> 00:12:54,654
and we create jump links using these whiskers.

224
00:12:54,654 --> 00:12:56,995
So going back to the two previous graphics,

225
00:12:56,995 --> 00:13:03,078
we can see that we can create whisker links

226
00:13:03,078 --> 00:13:06,220
on all three sides, and connect the dynamic nav mesh

227
00:13:06,220 --> 00:13:07,201
to the static one.

228
00:13:09,787 --> 00:13:12,848
Dynamic nav links were also added to have

229
00:13:12,848 --> 00:13:13,608
credible gameplay.

230
00:13:13,608 --> 00:13:18,169
These were specific to trains and boats.

231
00:13:18,169 --> 00:13:21,370
I'll explain the reason.

232
00:13:21,370 --> 00:13:24,431
Our dynamic links were meant to connect

233
00:13:24,431 --> 00:13:26,071
two moving nav meshes together

234
00:13:26,071 --> 00:13:28,112
and allow jumps from one to the other.

235
00:13:28,112 --> 00:13:30,272
The big technicality here is

236
00:13:31,414 --> 00:13:34,256
Since our scenes with carriages were so dynamic,

237
00:13:34,256 --> 00:13:37,118
we couldn't rely on a path being valid

238
00:13:37,118 --> 00:13:40,300
from the point where it was requested to the point where

239
00:13:40,300 --> 00:13:41,481
it was executed.

240
00:13:41,481 --> 00:13:46,324
So since we wanted to have the paths valid at all times,

241
00:13:46,324 --> 00:13:50,367
we only applied them on vehicles of similar velocity.

242
00:13:50,367 --> 00:13:52,688
This meant that two trains going next to each other,

243
00:13:52,688 --> 00:13:54,329
or two boats going next to each other,

244
00:13:54,329 --> 00:13:56,571
could be jumped from one to the other.

245
00:13:58,696 --> 00:14:00,876
We also modified the steering behaviors.

246
00:14:00,876 --> 00:14:06,858
For historical reasons, the steering in Assassin's Creed

247
00:14:06,858 --> 00:14:10,018
was radius-based.

248
00:14:10,018 --> 00:14:13,419
It works great for characters and for especially bipeds,

249
00:14:13,419 --> 00:14:17,040
because their width is pretty much the same as their length.

250
00:14:17,040 --> 00:14:21,801
But in our case, the carriages were much too long for it

251
00:14:21,801 --> 00:14:24,102
to work.

252
00:14:24,520 --> 00:14:28,082
To avoid paths that were really not realistic,

253
00:14:28,082 --> 00:14:29,883
we went for a different method.

254
00:14:29,883 --> 00:14:31,224
So here's an example.

255
00:14:31,224 --> 00:14:34,327
If you compute the smallest radius that

256
00:14:34,327 --> 00:14:36,328
can encompass the entire vehicle,

257
00:14:36,328 --> 00:14:38,189
you get something like this.

258
00:14:38,189 --> 00:14:40,891
And NPCs steer very far away from the vehicle,

259
00:14:40,891 --> 00:14:42,872
which doesn't really look good.

260
00:14:42,872 --> 00:14:44,213
Doesn't look realistic either.

261
00:14:45,894 --> 00:14:48,796
So we went with the convex hull steering.

262
00:14:48,796 --> 00:14:50,778
So basically from our vehicles,

263
00:14:50,778 --> 00:14:52,879
since they were not rectangular,

264
00:14:52,879 --> 00:14:55,581
we had to build some sort of envelope

265
00:14:55,581 --> 00:14:58,904
around the rigid bodies in order to allow NPCs

266
00:14:58,904 --> 00:15:03,528
to use a convex shape for dynamics avoidance.

267
00:15:03,528 --> 00:15:10,153
So yeah, we're trying to get rid of the concave shapes.

268
00:15:12,592 --> 00:15:16,253
The shape is being modified by the different type of tractors.

269
00:15:16,253 --> 00:15:20,255
We have some vehicles have one horse, some have two.

270
00:15:20,255 --> 00:15:23,217
Vehicle with two horses can lose an horse and still be valid.

271
00:15:23,217 --> 00:15:26,558
Vehicles can still be in movement,

272
00:15:26,558 --> 00:15:30,280
even though they don't have any more horses.

273
00:15:30,280 --> 00:15:31,941
So we had to adapt to these variations in runtime.

274
00:15:33,297 --> 00:15:38,620
We also add a few steering method that were used.

275
00:15:38,620 --> 00:15:43,123
In some cases to go from outside of the convex shape

276
00:15:43,123 --> 00:15:48,006
to outside, sometimes to go in and sometimes to go out.

277
00:15:48,006 --> 00:15:50,227
Here's a quick example.

278
00:15:50,227 --> 00:15:53,389
We start from the rigid bodies of the vehicle

279
00:15:53,389 --> 00:15:56,110
and then by exploring all of the edges,

280
00:15:56,110 --> 00:15:58,872
we try to find an intersection

281
00:15:58,872 --> 00:16:01,393
between the two rigid body contours.

282
00:16:02,537 --> 00:16:05,405
Once we get one, we switch the iteration of the edges

283
00:16:05,405 --> 00:16:08,452
on the other one, and we continue computing.

284
00:16:08,452 --> 00:16:11,520
This results in the contour of the vehicle.

285
00:16:12,510 --> 00:16:15,131
Given the contour, we then explore all of the edges

286
00:16:15,131 --> 00:16:17,751
in a clockwise manner.

287
00:16:17,751 --> 00:16:23,252
And whenever the projected edge on the right vector

288
00:16:23,252 --> 00:16:28,113
of the previous edge results in a negative value,

289
00:16:28,113 --> 00:16:30,774
it means that we're going outside of our shape,

290
00:16:30,774 --> 00:16:33,814
therefore creating a concave shape.

291
00:16:33,814 --> 00:16:38,655
So we pop this vertex and go back and continue the process

292
00:16:38,655 --> 00:16:41,636
until we looped to our initial point.

293
00:16:43,717 --> 00:16:48,042
The main point that we were trying to avoid

294
00:16:48,042 --> 00:16:53,328
was the drawing I showed you before with the huge radius.

295
00:16:53,328 --> 00:16:56,091
In this case, as you can see, if we do a collision check

296
00:16:56,091 --> 00:16:59,896
with the path and the concave shape,

297
00:16:59,896 --> 00:17:03,280
we can see that we can move much closer to the vehicle

298
00:17:03,280 --> 00:17:04,261
without any issue.

299
00:17:06,048 --> 00:17:10,613
If the destination were to be on the other side of the vehicle,

300
00:17:10,613 --> 00:17:13,615
we then minimize the angle of the NPC.

301
00:17:13,615 --> 00:17:16,919
We minimize the direction change,

302
00:17:16,919 --> 00:17:22,724
allowing us to compute a path going through one of the vertex.

303
00:17:23,804 --> 00:17:29,187
on the outside of the vehicle that gives the least angle change.

304
00:17:29,187 --> 00:17:34,169
Some methods could have taken into account the velocity of the vehicle, the turning,

305
00:17:34,169 --> 00:17:39,691
whatever, but in our case, since the situation was so dynamic, it proved to be good enough

306
00:17:39,691 --> 00:17:42,673
to simply go to the nearest vertex.

307
00:17:44,867 --> 00:17:48,688
Whenever an NPC is trying to interact with a moving vehicle,

308
00:17:48,688 --> 00:17:51,129
it needs to go from outside to the inside.

309
00:17:51,129 --> 00:17:54,670
So in this case, we use the outside to outside steering

310
00:17:54,670 --> 00:18:02,211
method until 2D raycast is allowed to cross the convex hull

311
00:18:02,211 --> 00:18:04,812
without intersecting with the contour, which is an orange,

312
00:18:04,812 --> 00:18:07,133
giving us a straight path that will not

313
00:18:07,133 --> 00:18:07,993
go through a collision.

314
00:18:09,796 --> 00:18:12,880
Then inside to outside is a bit the same thing.

315
00:18:12,880 --> 00:18:15,743
It's basically when an NPC is getting off a vehicle

316
00:18:15,743 --> 00:18:18,467
that's still in movement and wants to come out.

317
00:18:18,467 --> 00:18:20,689
We basically find the closest edge

318
00:18:20,689 --> 00:18:23,613
where there's no collision with the contour.

319
00:18:23,613 --> 00:18:25,395
We go in straight line and then we apply

320
00:18:25,395 --> 00:18:27,418
the outside to outside steering.

321
00:18:29,911 --> 00:18:30,931
Behavior changes.

322
00:18:30,931 --> 00:18:33,813
We'll cover some of the behavior changes,

323
00:18:33,813 --> 00:18:37,074
but obviously a lot of work was put into it

324
00:18:37,074 --> 00:18:39,715
to allow NPCs to properly support vehicles.

325
00:18:39,715 --> 00:18:41,516
So I'll try to keep it simple

326
00:18:41,516 --> 00:18:43,857
and show some interesting examples,

327
00:18:43,857 --> 00:18:45,938
but if you wanna talk more about it,

328
00:18:45,938 --> 00:18:47,959
feel free to come see me.

329
00:18:47,959 --> 00:18:49,480
First, local positions.

330
00:18:50,639 --> 00:18:53,621
Since we had a fully dynamic world,

331
00:18:53,621 --> 00:18:56,623
we had to take into account that a position

332
00:18:56,623 --> 00:19:01,767
that's computed by an NPC needed to be in local space

333
00:19:01,767 --> 00:19:03,249
to its referential.

334
00:19:03,249 --> 00:19:07,632
What I mean by that is that trains and boats

335
00:19:07,632 --> 00:19:11,095
were big enough to have an NPC perform a full search loop,

336
00:19:11,095 --> 00:19:13,377
and if they were computing positions like,

337
00:19:13,377 --> 00:19:16,419
oh, I should go search at X, Y, Z position,

338
00:19:17,795 --> 00:19:20,218
every frame the boat or the train is moving.

339
00:19:20,218 --> 00:19:23,604
So that pre-computed position wasn't valid anymore.

340
00:19:23,604 --> 00:19:28,651
So since we wanted to reuse most of the legacy

341
00:19:28,651 --> 00:19:32,417
behaviors from previous titles, we had to adjust that code.

342
00:19:33,682 --> 00:19:36,786
This code was specific to moving platforms,

343
00:19:36,786 --> 00:19:40,472
so whenever an NPC was standing on something dynamic,

344
00:19:40,472 --> 00:19:44,078
we would perform a little extra operation

345
00:19:44,078 --> 00:19:46,141
to bind the position or direction

346
00:19:46,141 --> 00:19:48,024
to the entity on which it was standing.

347
00:19:49,494 --> 00:19:53,357
We call them anchored vectors and anchored directions.

348
00:19:53,357 --> 00:19:58,940
Basically by changing the interface of most function

349
00:19:58,940 --> 00:20:02,042
calls, we were able to trap all of the cases

350
00:20:02,042 --> 00:20:05,105
where world space vector was being used

351
00:20:05,105 --> 00:20:07,006
and pass it as a local vector.

352
00:20:09,787 --> 00:20:12,789
For a combat, we had to support the combat

353
00:20:12,789 --> 00:20:17,594
throughout the game by adding new behaviors for NPCs on foot

354
00:20:17,594 --> 00:20:21,377
to fight a target that's on a vehicle

355
00:20:21,377 --> 00:20:25,141
and to implement a full combat loop on the vehicles.

356
00:20:25,141 --> 00:20:26,582
Here's an example.

357
00:20:26,582 --> 00:20:30,006
It's the takeout of a target.

358
00:20:30,006 --> 00:20:32,428
So whenever you get on a vehicle,

359
00:20:32,428 --> 00:20:35,631
an NPC is allowed to come to you and take you out.

360
00:20:38,228 --> 00:20:41,329
This is done by reusing the bones that I showed before

361
00:20:41,329 --> 00:20:42,350
on each side.

362
00:20:42,350 --> 00:20:45,951
We can do a test for navigation on each of the bones.

363
00:20:45,951 --> 00:20:48,691
So for example, in that case, if there was an obstacle

364
00:20:48,691 --> 00:20:51,412
on my right, the NPC would have been able to use

365
00:20:51,412 --> 00:20:53,733
a symmetric animation on the other side

366
00:20:53,733 --> 00:20:56,073
and interact with me and pull me out from the other side.

367
00:20:56,073 --> 00:20:59,414
This allows the player to be fighting the NPCs

368
00:20:59,414 --> 00:21:01,515
most of the times on the foot,

369
00:21:01,515 --> 00:21:04,476
where he has his full fight skills.

370
00:21:06,706 --> 00:21:11,709
then some players will simply stand on these vehicles, and since they're big enough,

371
00:21:11,709 --> 00:21:15,672
we wanted to support NPCs to be able to climb on these vehicles.

372
00:21:19,275 --> 00:21:23,157
In that case, since the surface of the vehicle is quite small,

373
00:21:23,157 --> 00:21:27,199
we had to reduce the set of fight animations

374
00:21:27,199 --> 00:21:28,660
that we were using.

375
00:21:28,660 --> 00:21:32,802
But it also allowed us to use a bit more often

376
00:21:32,802 --> 00:21:35,404
what we call the Sparta kick, where you simply

377
00:21:35,404 --> 00:21:39,746
kick an NPC off the vehicle, which looks great on trains.

378
00:21:39,746 --> 00:21:42,208
By the way, this is a debug build,

379
00:21:42,208 --> 00:21:45,490
so there might be some glitches.

380
00:21:45,490 --> 00:21:46,630
So sorry about that.

381
00:21:49,065 --> 00:21:56,710
We also allowed NPCs to take you out of the driving position and fight you on the rooftop.

382
00:21:56,710 --> 00:21:59,872
I'll get through this guy first.

383
00:21:59,872 --> 00:22:05,195
By the way, I'm not very good at the game, so you might see me get quite a lot of damage.

384
00:22:05,195 --> 00:22:06,276
I didn't go with God mode.

385
00:22:08,585 --> 00:22:14,869
So here as you can see I tried to steal the guy's vehicle and he grabbed me by the neck

386
00:22:14,869 --> 00:22:20,072
and brought me back up on the vehicle, again falling back on our fight pillar,

387
00:22:20,072 --> 00:22:21,733
where the NPC is allowed to use all of his fight moves.

388
00:22:23,866 --> 00:22:27,269
Here, we'll see an example of shooting.

389
00:22:27,269 --> 00:22:31,112
We tried to use the shooting with the same rules

390
00:22:31,112 --> 00:22:32,493
as the NPCs out on the ground.

391
00:22:32,493 --> 00:22:34,935
So basically, they don't fire too often.

392
00:22:34,935 --> 00:22:37,418
They follow specific rules as to what's

393
00:22:37,418 --> 00:22:41,441
the percentage of chances that they will hit you.

394
00:22:41,441 --> 00:22:44,564
But in our case, they were also able to shoot your horses.

395
00:22:45,259 --> 00:22:49,182
And as you can see, the shooting allows the NPC to also

396
00:22:49,182 --> 00:22:51,143
handle a target that's on the foot,

397
00:22:51,143 --> 00:22:54,606
where he'll stay on his vehicle and simply shoot me

398
00:22:54,606 --> 00:22:56,667
from there until I get far enough

399
00:22:56,667 --> 00:22:59,169
where he'll start chasing me again.

400
00:22:59,169 --> 00:23:01,411
If I stay too long on the ground next to him,

401
00:23:01,411 --> 00:23:03,352
he'll simply get off the vehicle

402
00:23:03,352 --> 00:23:04,993
and start fighting me in melee.

403
00:23:04,993 --> 00:23:09,297
The ramming is one of the most interesting

404
00:23:09,297 --> 00:23:10,798
aspect of the vehicle fight.

405
00:23:12,280 --> 00:23:20,184
Ramming is used by the player and by the NPCs, and it's also linked to damage on the vehicles.

406
00:23:20,184 --> 00:23:25,607
So, as you could see, I destroyed the vehicle of the previous guy,

407
00:23:25,607 --> 00:23:30,909
and then other NPCs are trying to come and ram me to destroy my vehicle.

408
00:23:30,909 --> 00:23:38,473
This allowed us to showcase a bit the ejection system in our game, leading to player recovery.

409
00:23:39,718 --> 00:23:42,099
Most NPCs simply die when they get ejected.

410
00:23:42,099 --> 00:23:47,740
Then, one of my favorite feature that we developed

411
00:23:47,740 --> 00:23:48,820
is the boarding.

412
00:23:48,820 --> 00:23:52,982
It basically allows an NPC to climb on his own carriage

413
00:23:52,982 --> 00:23:54,542
and jump on yours and come fight you.

414
00:23:54,542 --> 00:23:59,083
Again, in my opinion, it falls on all of the critical

415
00:23:59,083 --> 00:24:01,404
pillars that we described in the beginning.

416
00:24:01,404 --> 00:24:04,405
It's a mix of navigation, it's a mix of fight.

417
00:24:04,405 --> 00:24:06,085
Sorry about the camera there.

418
00:24:08,187 --> 00:24:10,989
We also had to add the virtualization.

419
00:24:10,989 --> 00:24:13,191
Virtualization is a process that we developed

420
00:24:13,191 --> 00:24:18,476
to allow NPCs to live a bit longer despite being unspawned.

421
00:24:18,476 --> 00:24:20,657
In our game, for most of the NPCs,

422
00:24:20,657 --> 00:24:23,520
we're using what we call the loading bubble,

423
00:24:23,520 --> 00:24:26,522
which describes the area in which NPCs are living.

424
00:24:27,923 --> 00:24:31,867
It's basically player centric, so whenever the player's

425
00:24:31,867 --> 00:24:35,210
moving, the bubble follows him, which means that if you're

426
00:24:35,210 --> 00:24:38,553
escaping at a high velocity, people that are left behind

427
00:24:38,553 --> 00:24:42,177
are likely to be unspawned.

428
00:24:42,177 --> 00:24:45,259
We had the issue where the player could be on a vehicle

429
00:24:45,259 --> 00:24:48,022
and get into conflict with an NPC on foot.

430
00:24:48,022 --> 00:24:51,885
Obviously, the NPC on foot has no way to chase you

431
00:24:51,885 --> 00:24:54,088
very fast, so he will have to use a vehicle.

432
00:24:55,278 --> 00:24:57,298
If you go full speed right away,

433
00:24:57,298 --> 00:24:59,219
he's very likely to get unspawned,

434
00:24:59,219 --> 00:25:01,259
which would result in no challenge

435
00:25:01,259 --> 00:25:05,060
because the player is simply canceling any conflict

436
00:25:05,060 --> 00:25:07,880
as soon as he unspawns the NPC.

437
00:25:07,880 --> 00:25:11,561
So NPCs were also not cheating,

438
00:25:11,561 --> 00:25:13,461
so they had to navigate to a vehicle

439
00:25:13,461 --> 00:25:15,262
and then interact with it,

440
00:25:15,262 --> 00:25:16,782
which led to a bit of time

441
00:25:16,782 --> 00:25:21,483
making them unspawn a bit too often.

442
00:25:21,483 --> 00:25:24,323
So we decided to add virtual vehicles.

443
00:25:25,851 --> 00:25:30,752
We used virtual vehicles by creating fake entities

444
00:25:30,752 --> 00:25:31,952
that were not living in the world,

445
00:25:31,952 --> 00:25:35,673
but living in a virtual space in which NPCs were grouped,

446
00:25:35,673 --> 00:25:37,454
living in these fake vehicles.

447
00:25:37,454 --> 00:25:41,014
The reason why we're grouping NPCs is we wanted to avoid,

448
00:25:41,014 --> 00:25:44,455
if you unspawn five NPCs, to have five vehicles responding

449
00:25:44,455 --> 00:25:46,256
and then chase the player.

450
00:25:46,256 --> 00:25:49,456
This way, if NPCs are sharing a faction,

451
00:25:49,456 --> 00:25:52,577
they can be grouped in a virtual vehicle

452
00:25:52,577 --> 00:25:54,658
and then only a single...

453
00:25:55,698 --> 00:25:57,760
a spawning request will be executed.

454
00:25:57,760 --> 00:26:01,484
All of the NPCs persist their health,

455
00:26:01,484 --> 00:26:03,446
their visual and the target.

456
00:26:03,446 --> 00:26:06,028
This way the player can recognize that

457
00:26:06,028 --> 00:26:08,891
the NPCs that he left behind are still

458
00:26:08,891 --> 00:26:12,214
living and breathing when they respawn.

459
00:26:12,214 --> 00:26:16,579
We also added simplified virtualized behaviors.

460
00:26:16,579 --> 00:26:18,221
In our case, for the...

461
00:26:19,323 --> 00:26:21,864
the conflict was the chase.

462
00:26:21,864 --> 00:26:24,625
Basically the NPCs are using the road network

463
00:26:24,625 --> 00:26:26,286
that you saw before.

464
00:26:26,286 --> 00:26:29,208
And this network is loaded at all times in London.

465
00:26:29,208 --> 00:26:32,009
So an NPC, even if he's really far away from the player,

466
00:26:32,009 --> 00:26:34,690
he can simply query a path from A to B

467
00:26:34,690 --> 00:26:39,593
and chase the player without even existing in the world.

468
00:26:39,593 --> 00:26:41,514
We also added a simplified search,

469
00:26:41,514 --> 00:26:45,936
which basically let the NPCs roam around the streets.

470
00:26:46,616 --> 00:26:48,717
This is not really visible for a player,

471
00:26:48,717 --> 00:26:50,017
other than on the mini-map,

472
00:26:50,017 --> 00:26:51,418
because the NPCs are not spawned,

473
00:26:51,418 --> 00:26:54,439
so you cannot see the actions that the NPCs are doing,

474
00:26:54,439 --> 00:26:58,440
but you can see basically the path that they're following.

475
00:26:58,440 --> 00:27:01,821
And you can also hire allies that will follow you

476
00:27:01,821 --> 00:27:03,281
everywhere in the map,

477
00:27:03,281 --> 00:27:06,082
and they will try to rely as much as possible

478
00:27:06,082 --> 00:27:07,203
on the road network.

479
00:27:08,952 --> 00:27:12,034
De-virtualizing, sorry about that,

480
00:27:12,034 --> 00:27:17,378
is whenever the NPCs are coming back to the loading bubble,

481
00:27:17,378 --> 00:27:18,539
they would simply respawn.

482
00:27:18,539 --> 00:27:22,421
We do a simple analysis of the traffic system

483
00:27:22,421 --> 00:27:25,003
around the player, and we try to find a spot

484
00:27:25,003 --> 00:27:27,905
that's not visible, where there's enough room

485
00:27:27,905 --> 00:27:28,926
to spawn the vehicles.

486
00:27:30,147 --> 00:27:32,710
We also combine the spawning, so all of the NPCs

487
00:27:32,710 --> 00:27:36,013
in the vehicle get spawned at the same time,

488
00:27:36,013 --> 00:27:39,917
resulting in a full entity with all of its components

489
00:27:39,917 --> 00:27:43,561
available at the same time.

490
00:27:43,561 --> 00:27:46,865
Unfortunately, this is a short talk, so I'll have to wrap up.

491
00:27:48,517 --> 00:27:51,778
In my opinion, adding vehicles in Assassin's Creed Syndicate

492
00:27:51,778 --> 00:27:54,219
was mostly a navigation problem.

493
00:27:54,219 --> 00:27:57,460
We decided to empower our existing systems

494
00:27:57,460 --> 00:27:58,320
and build on top of it.

495
00:27:58,320 --> 00:28:02,021
So we reused the fights, we reused the searches,

496
00:28:02,021 --> 00:28:04,262
and we tried to adapt all of our gameplay loops

497
00:28:04,262 --> 00:28:06,623
to the new vehicles.

498
00:28:06,623 --> 00:28:09,664
We also worked around our engine's limitations

499
00:28:09,664 --> 00:28:10,044
without

500
00:28:12,367 --> 00:28:15,349
getting rid of the baby at the same time as the bath water,

501
00:28:15,349 --> 00:28:18,950
we simply found out the specific points

502
00:28:18,950 --> 00:28:20,331
where we needed to tackle,

503
00:28:20,331 --> 00:28:24,352
and this meant that we added the virtual behaviors.

504
00:28:24,352 --> 00:28:29,094
There will not be time for questions here, unfortunately,

505
00:28:29,094 --> 00:28:31,155
but if you want to talk to me,

506
00:28:31,155 --> 00:28:32,675
there's a wrap-up room,

507
00:28:32,675 --> 00:28:35,576
which I was told is unfortunately far away,

508
00:28:35,576 --> 00:28:38,578
so if you want, just join me at the back of the,

509
00:28:38,578 --> 00:28:39,098
yeah, in the hall.

510
00:28:40,330 --> 00:28:43,774
Otherwise you can email me or talk to me on Twitter.

511
00:28:43,774 --> 00:28:47,999
And tomorrow I will be at the Ubisoft lounge

512
00:28:47,999 --> 00:28:51,203
from 11 to 12, so if you guys are looking

513
00:28:51,203 --> 00:28:53,706
for new challenges or have any questions,

514
00:28:53,706 --> 00:28:55,648
come see me, I'll gladly help you.

515
00:28:56,793 --> 00:28:59,614
And I'd like to quickly thank people in Quebec City.

516
00:28:59,614 --> 00:29:02,054
This is a very short list of the people

517
00:29:02,054 --> 00:29:03,615
who worked on the vehicles,

518
00:29:03,615 --> 00:29:05,955
but there's quite a lot of work involved

519
00:29:05,955 --> 00:29:08,276
and all of these people worked as programmers

520
00:29:08,276 --> 00:29:12,417
on the vehicle system or the AI system.

521
00:29:12,417 --> 00:29:14,798
And unfortunately I didn't have enough room

522
00:29:14,798 --> 00:29:16,478
to thank the designers, the animators,

523
00:29:16,478 --> 00:29:17,598
the mission designers.

524
00:29:17,598 --> 00:29:19,059
There's a lot of people who worked on it.

525
00:29:19,059 --> 00:29:20,859
So thanks for your time and I think my time's up.

526
00:29:20,859 --> 00:29:21,139
Thank you.

527
00:29:21,139 --> 00:29:21,459
Thank you.

528
00:29:21,459 --> 00:29:21,879
Thank you.

529
00:29:21,879 --> 00:29:22,640
Thank you.

